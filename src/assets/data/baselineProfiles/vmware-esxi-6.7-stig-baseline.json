{
  "name": "vmware-esxi-6.7-stig-baseline",
  "title": "VMware vSphere 6.7 ESXi Security Technical Implementation Guide",
  "maintainer": "VMware",
  "copyright": "VMware",
  "copyright_email": "stigs@vmware.com",
  "license": "Apache-2.0",
  "summary": "This Security Technical Implementation Guide is published as a tool to improve the security of Department of Defense (DoD) information systems. The requirements are derived from the National Institute of Standards and Technology (NIST) 800-53 and related documents. Comments or proposed revisions to this document should be sent via email to the following address: disa.stig_spt@mail.mil.",
  "version": "6.7.0 Version 1 Release 1",
  "inputs": [],
  "supports": [],
  "controls": [
    {
      "title": "The ESXi host must produce audit records containing information to\nestablish what type of events occurred.",
      "desc": "Without establishing what types of events occurred, it would be\ndifficult to establish, correlate, and investigate the events leading up to an\noutage or attack.",
      "descriptions": {
        "default": "Without establishing what types of events occurred, it would be\ndifficult to establish, correlate, and investigate the events leading up to an\noutage or attack.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \"Config.HostAgent.log.level\" value and verify it is set to\n\"info\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Config.HostAgent.log.level\n\n    If the \"Config.HostAgent.log.level\" setting is not set to \"info\", this\nis a finding.\n\n    Note: Verbose logging level is acceptable for troubleshooting purposes.",
        "fix": "From the vSphere Client, select the ESXi Host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \"Edit\", select the \"Config.HostAgent.log.level\" value, and\nconfigure it to \"info\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VMHost | Get-AdvancedSetting -Name Config.HostAgent.log.level |\nSet-AdvancedSetting -Value \"info\""
      },
      "impact": 0.3,
      "refs": [],
      "tags": {
        "severity": "low",
        "gtitle": "SRG-OS-000037-VMM-000150",
        "satisfies": [
          "SRG-OS-000037-VMM-000150",
          "SRG-OS-000063-VMM-000310"
        ],
        "gid": "V-239285",
        "rid": "SV-239285r674784_rule",
        "stig_id": "ESXI-67-000030",
        "fix_id": "F-42477r674783_fix",
        "cci": [
          "CCI-000130",
          "CCI-000171"
        ],
        "nist": [
          "AU-3",
          "AU-12 b"
        ]
      },
      "code": "control \"ESXI-67-000030\" do\n  title \"The ESXi host must produce audit records containing information to\nestablish what type of events occurred.\"\n  desc  \"Without establishing what types of events occurred, it would be\ndifficult to establish, correlate, and investigate the events leading up to an\noutage or attack.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \\\"Config.HostAgent.log.level\\\" value and verify it is set to\n\\\"info\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Config.HostAgent.log.level\n\n    If the \\\"Config.HostAgent.log.level\\\" setting is not set to \\\"info\\\", this\nis a finding.\n\n    Note: Verbose logging level is acceptable for troubleshooting purposes.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi Host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \\\"Edit\\\", select the \\\"Config.HostAgent.log.level\\\" value, and\nconfigure it to \\\"info\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VMHost | Get-AdvancedSetting -Name Config.HostAgent.log.level |\nSet-AdvancedSetting -Value \\\"info\\\"\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000037-VMM-000150'\n  tag satisfies: ['SRG-OS-000037-VMM-000150', 'SRG-OS-000063-VMM-000310']\n  tag gid: 'V-239285'\n  tag rid: 'SV-239285r674784_rule'\n  tag stig_id: 'ESXI-67-000030'\n  tag fix_id: 'F-42477r674783_fix'\n  tag cci: ['CCI-000130', 'CCI-000171']\n  tag nist: ['AU-3', 'AU-12 b']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-AdvancedSetting -Name Config.HostAgent.log.level | Select-Object -ExpandProperty Value\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should match \"info\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000030.rb",
        "line": 1
      },
      "id": "ESXI-67-000030"
    },
    {
      "title": "The virtual switch Promiscuous Mode policy must be set to reject on\nthe ESXi host.",
      "desc": "When Promiscuous Mode is enabled for a virtual switch, all virtual\nmachines connected to the Portgroup have the potential of reading all packets\nacross that network, meaning only the virtual machines connected to that\nPortgroup.\n\n    Promiscuous Mode is disabled by default on the ESXi Server, and this is the\nrecommended setting. Promiscuous Mode can be set at the vSwitch and/or the\nPortgroup level. Switch-level settings can be overridden at the Portgroup level.",
      "descriptions": {
        "default": "When Promiscuous Mode is enabled for a virtual switch, all virtual\nmachines connected to the Portgroup have the potential of reading all packets\nacross that network, meaning only the virtual machines connected to that\nPortgroup.\n\n    Promiscuous Mode is disabled by default on the ESXi Server, and this is the\nrecommended setting. Promiscuous Mode can be set at the vSwitch and/or the\nPortgroup level. Switch-level settings can be overridden at the Portgroup level.",
        "rationale": "",
        "check": "From the vSphere Client, go to Configure >> Networking >> Virtual Switches.\n\n    View the properties on each virtual switch and port group and verify that\n\"Promiscuous Mode\" is set to reject.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VirtualSwitch | Get-SecurityPolicy\n    Get-VirtualPortGroup | Get-SecurityPolicy\n\n    If the \"Promiscuous Mode\" policy is set to accept (or true, via\nPowerCLI), this is a finding.",
        "fix": "From the vSphere Client go to Configure >> Networking >> Virtual Switches.\n\n    For each virtual switch and port group, click Edit settings (dots) and\nchange \"Promiscuous Mode\" to reject.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VirtualSwitch | Get-SecurityPolicy | Set-SecurityPolicy\n-AllowPromiscuous $false\n    Get-VirtualPortGroup | Get-SecurityPolicy | Set-SecurityPolicy\n-AllowPromiscuousInherited $true"
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239315",
        "rid": "SV-239315r674874_rule",
        "stig_id": "ESXI-67-000061",
        "fix_id": "F-42507r674873_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000061\" do\n  title \"The virtual switch Promiscuous Mode policy must be set to reject on\nthe ESXi host.\"\n  desc  \"When Promiscuous Mode is enabled for a virtual switch, all virtual\nmachines connected to the Portgroup have the potential of reading all packets\nacross that network, meaning only the virtual machines connected to that\nPortgroup.\n\n    Promiscuous Mode is disabled by default on the ESXi Server, and this is the\nrecommended setting. Promiscuous Mode can be set at the vSwitch and/or the\nPortgroup level. Switch-level settings can be overridden at the Portgroup level.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Configure >> Networking >> Virtual Switches.\n\n    View the properties on each virtual switch and port group and verify that\n\\\"Promiscuous Mode\\\" is set to reject.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VirtualSwitch | Get-SecurityPolicy\n    Get-VirtualPortGroup | Get-SecurityPolicy\n\n    If the \\\"Promiscuous Mode\\\" policy is set to accept (or true, via\nPowerCLI), this is a finding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client go to Configure >> Networking >> Virtual Switches.\n\n    For each virtual switch and port group, click Edit settings (dots) and\nchange \\\"Promiscuous Mode\\\" to reject.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VirtualSwitch | Get-SecurityPolicy | Set-SecurityPolicy\n-AllowPromiscuous $false\n    Get-VirtualPortGroup | Get-SecurityPolicy | Set-SecurityPolicy\n-AllowPromiscuousInherited $true\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239315'\n  tag rid: 'SV-239315r674874_rule'\n  tag stig_id: 'ESXI-67-000061'\n  tag fix_id: 'F-42507r674873_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-VirtualSwitch | Get-SecurityPolicy | Select-Object -ExpandProperty AllowPromiscuous\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should_not match \"True\" }\n  end\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-VirtualPortGroup | Get-SecurityPolicy | Select-Object -ExpandProperty AllowPromiscuous\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should_not match \"True\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000061.rb",
        "line": 1
      },
      "id": "ESXI-67-000061"
    },
    {
      "title": "The ESXi host must enable bidirectional CHAP authentication for iSCSI\ntraffic.",
      "desc": "When enabled, vSphere performs bidirectional authentication of both\nthe iSCSI target and host. There is a potential for a MiTM attack, when not\nauthenticating both the iSCSI target and host, in which an attacker might\nimpersonate either side of the connection to steal data. Bidirectional\nauthentication mitigates this risk.",
      "descriptions": {
        "default": "When enabled, vSphere performs bidirectional authentication of both\nthe iSCSI target and host. There is a potential for a MiTM attack, when not\nauthenticating both the iSCSI target and host, in which an attacker might\nimpersonate either side of the connection to steal data. Bidirectional\nauthentication mitigates this risk.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi host and go to Configure >>\nStorage >> Storage Adapters.\n\n    Select the iSCSI adapter >> Properties >> Authentication method, view the\nCHAP configuration, and verify CHAP is required for target and host\nauthentication.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-VMHostHba | Where {$_.Type -eq \"iscsi\"} | Select\nAuthenticationProperties -ExpandProperty AuthenticationProperties\n\n    If iSCSI is not used, this is not a finding.\n\n    If iSCSI is used and CHAP is not set to \"required\" for both the target\nand host, this is a finding.\n\n    If iSCSI is used and unique CHAP secrets are not used for each host, this\nis a finding.",
        "fix": "From the vSphere Client, select the ESXi host and go to Configure >>\nStorage >> Storage Adapters.\n\n    Select the iSCSI adapter >> Properties >> Authentication and click the\n\"Edit\" button.\n\n    Set Authentication method to “Use bidirectional CHAP” and enter a unique\nsecret for each traffic flow direction.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-VMHostHba | Where {$_.Type -eq \"iscsi\"} | Set-VMHostHba\n-ChapType Required -ChapName \"chapname\" -ChapPassword \"password\"\n-MutualChapEnabled $true -MutualChapName \"mutualchapname\" -MutualChapPassword\n\"mutualpassword\""
      },
      "impact": 0.3,
      "refs": [],
      "tags": {
        "severity": "low",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239308",
        "rid": "SV-239308r674853_rule",
        "stig_id": "ESXI-67-000054",
        "fix_id": "F-42500r674852_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000054\" do\n  title \"The ESXi host must enable bidirectional CHAP authentication for iSCSI\ntraffic.\"\n  desc  \"When enabled, vSphere performs bidirectional authentication of both\nthe iSCSI target and host. There is a potential for a MiTM attack, when not\nauthenticating both the iSCSI target and host, in which an attacker might\nimpersonate either side of the connection to steal data. Bidirectional\nauthentication mitigates this risk.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi host and go to Configure >>\nStorage >> Storage Adapters.\n\n    Select the iSCSI adapter >> Properties >> Authentication method, view the\nCHAP configuration, and verify CHAP is required for target and host\nauthentication.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-VMHostHba | Where {$_.Type -eq \\\"iscsi\\\"} | Select\nAuthenticationProperties -ExpandProperty AuthenticationProperties\n\n    If iSCSI is not used, this is not a finding.\n\n    If iSCSI is used and CHAP is not set to \\\"required\\\" for both the target\nand host, this is a finding.\n\n    If iSCSI is used and unique CHAP secrets are not used for each host, this\nis a finding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi host and go to Configure >>\nStorage >> Storage Adapters.\n\n    Select the iSCSI adapter >> Properties >> Authentication and click the\n\\\"Edit\\\" button.\n\n    Set Authentication method to “Use bidirectional CHAP” and enter a unique\nsecret for each traffic flow direction.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-VMHostHba | Where {$_.Type -eq \\\"iscsi\\\"} | Set-VMHostHba\n-ChapType Required -ChapName \\\"chapname\\\" -ChapPassword \\\"password\\\"\n-MutualChapEnabled $true -MutualChapName \\\"mutualchapname\\\" -MutualChapPassword\n\\\"mutualpassword\\\"\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239308'\n  tag rid: 'SV-239308r674853_rule'\n  tag stig_id: 'ESXI-67-000054'\n  tag fix_id: 'F-42500r674852_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-VMHostHba | Where {$_.Type -eq 'iscsi'}\"\n  iscsi_hbas = powercli_command(command).stdout\n\n  if iscsi_hbas.empty?\n    describe \"\" do\n      skip \"There are no iSCSI HBAs present so this control is not applicable\"\n    end\n  end\n\n  if !iscsi_hbas.empty?\n    command1 = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-VMHostHba | Where {$_.Type -eq 'iscsi'} | Select-Object -ExpandProperty AuthenticationProperties | Select-Object -ExpandProperty MutualChapEnabled\"\n    command2 = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-VMHostHba | Where {$_.Type -eq 'iscsi'} | Select-Object -ExpandProperty AuthenticationProperties | Select-Object -ExpandProperty ChapType\"\n\n    describe powercli_command(command1) do\n      its('stdout.strip') { should cmp \"True\" }\n    end\n\n    describe powercli_command(command2) do\n      its('stdout.strip') { should cmp \"Required\" }\n    end\n\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000054.rb",
        "line": 1
      },
      "id": "ESXI-67-000054"
    },
    {
      "title": "The ESXi host must prohibit the reuse of passwords within five\niterations.",
      "desc": "If a user or root used the same password continuously or was allowed\nto change it back shortly after being forced to change it to something else, it\nwould provide a potential intruder with the opportunity to keep guessing at one\nuser's password until it was guessed correctly.",
      "descriptions": {
        "default": "If a user or root used the same password continuously or was allowed\nto change it back shortly after being forced to change it to something else, it\nwould provide a potential intruder with the opportunity to keep guessing at one\nuser's password until it was guessed correctly.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \"Security.PasswordHistory\" value and verify it is set to \"5\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.PasswordHistory\n\n    If the \"Security.PasswordHistory\" setting is not set to \"5\", this is a\nfinding.",
        "fix": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \"Security.PasswordHistory\" value and configure it to \"5\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.PasswordHistory |\nSet-AdvancedSetting -Value 5"
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000077-VMM-000440",
        "gid": "V-239287",
        "rid": "SV-239287r674790_rule",
        "stig_id": "ESXI-67-000032",
        "fix_id": "F-42479r674789_fix",
        "cci": [
          "CCI-000200"
        ],
        "nist": [
          "IA-5 (1) (e)"
        ]
      },
      "code": "control \"ESXI-67-000032\" do\n  title \"The ESXi host must prohibit the reuse of passwords within five\niterations.\"\n  desc  \"If a user or root used the same password continuously or was allowed\nto change it back shortly after being forced to change it to something else, it\nwould provide a potential intruder with the opportunity to keep guessing at one\nuser's password until it was guessed correctly.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \\\"Security.PasswordHistory\\\" value and verify it is set to \\\"5\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.PasswordHistory\n\n    If the \\\"Security.PasswordHistory\\\" setting is not set to \\\"5\\\", this is a\nfinding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \\\"Security.PasswordHistory\\\" value and configure it to \\\"5\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.PasswordHistory |\nSet-AdvancedSetting -Value 5\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000077-VMM-000440'\n  tag gid: 'V-239287'\n  tag rid: 'SV-239287r674790_rule'\n  tag stig_id: 'ESXI-67-000032'\n  tag fix_id: 'F-42479r674789_fix'\n  tag cci: ['CCI-000200']\n  tag nist: ['IA-5 (1) (e)']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-AdvancedSetting -Name Security.PasswordHistory | Select-Object -ExpandProperty Value\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should match \"5\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000032.rb",
        "line": 1
      },
      "id": "ESXI-67-000032"
    },
    {
      "title": "The ESXi host SSH daemon must not allow host-based authentication.",
      "desc": "SSH trust relationships mean a compromise on one host can allow an\nattacker to move trivially to other hosts. SSH's cryptographic host-based\nauthentication is more secure than \".rhosts\" authentication, since hosts are\ncryptographically authenticated. However, it is not recommended that hosts\nunilaterally trust one another, even within an organization.",
      "descriptions": {
        "default": "SSH trust relationships mean a compromise on one host can allow an\nattacker to move trivially to other hosts. SSH's cryptographic host-based\nauthentication is more secure than \".rhosts\" authentication, since hosts are\ncryptographically authenticated. However, it is not recommended that hosts\nunilaterally trust one another, even within an organization.",
        "rationale": "",
        "check": "From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \"^HostbasedAuthentication\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly\n\"HostbasedAuthentication no\", this is a finding.",
        "fix": "From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \"/etc/ssh/sshd_config\":\n\n    Add or correct the following line in \"/etc/ssh/sshd_config\":\n\n    HostbasedAuthentication no"
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239269",
        "rid": "SV-239269r674736_rule",
        "stig_id": "ESXI-67-000013",
        "fix_id": "F-42461r674735_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000013\" do\n  title 'The ESXi host SSH daemon must not allow host-based authentication.'\n  desc  \"SSH trust relationships mean a compromise on one host can allow an\nattacker to move trivially to other hosts. SSH's cryptographic host-based\nauthentication is more secure than \\\".rhosts\\\" authentication, since hosts are\ncryptographically authenticated. However, it is not recommended that hosts\nunilaterally trust one another, even within an organization.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \\\"^HostbasedAuthentication\\\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly\n\\\"HostbasedAuthentication no\\\", this is a finding.\n  \"\n  desc  'fix', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    Add or correct the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    HostbasedAuthentication no\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239269'\n  tag rid: 'SV-239269r674736_rule'\n  tag stig_id: 'ESXI-67-000013'\n  tag fix_id: 'F-42461r674735_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"$vmhost = Get-VMHost -Name #{input('vmhostName')}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.software.vib.list.Invoke() | Where {$_.Name -eq '#{input('dodStigVibRootEnabled')}' -or $_.Name -eq '#{input('dodStigVibRootDisabled')}'}\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should_not cmp \"\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000013.rb",
        "line": 1
      },
      "id": "ESXI-67-000013"
    },
    {
      "title": "The ESXi host must use Active Directory for local user authentication.",
      "desc": "Join ESXi hosts to an Active Directory (AD) domain to eliminate the\nneed to create and maintain multiple local user accounts. Using AD for user\nauthentication simplifies the ESXi host configuration, ensures password\ncomplexity and reuse policies are enforced, and reduces the risk of security\nbreaches and unauthorized access.\n\n    Note: If the AD group \"ESX Admins\" (default) exists, then all users and\ngroups that are assigned as members to this group will have full administrative\naccess to all ESXi hosts the domain.",
      "descriptions": {
        "default": "Join ESXi hosts to an Active Directory (AD) domain to eliminate the\nneed to create and maintain multiple local user accounts. Using AD for user\nauthentication simplifies the ESXi host configuration, ensures password\ncomplexity and reuse policies are enforced, and reduces the risk of security\nbreaches and unauthorized access.\n\n    Note: If the AD group \"ESX Admins\" (default) exists, then all users and\ngroups that are assigned as members to this group will have full administrative\naccess to all ESXi hosts the domain.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Authentication Services.\n\n    Verify the \"Directory Services Type\" is set to \"Active Directory\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-VMHostAuthentication\n\n    For systems that do not use Active Directory and have no local user\naccounts, other than root and/or vpxuser, this is Not Applicable.\n\n    For systems that do not use Active Directory and do have local user\naccounts, other than root and/or vpxuser, this is a finding.\n\n    If the \"Directory Services Type\" is not set to \"Active Directory\", this\nis a finding.",
        "fix": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Authentication Services.\n\n    Click \"Join Domain\" and enter the AD domain to join. Select the \"Using\ncredentials” radio button, enter the credentials of an account with permissions\nto join machines to AD (use UPN naming – user@domain), and then click \"OK\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-VMHostAuthentication | Set-VMHostAuthentication\n-JoinDomain -Domain \"domain name\" -User \"username\" -Password \"password\""
      },
      "impact": 0.3,
      "refs": [],
      "tags": {
        "severity": "low",
        "gtitle": "SRG-OS-000104-VMM-000500",
        "satisfies": [
          "SRG-OS-000104-VMM-000500",
          "SRG-OS-000109-VMM-000550",
          "SRG-OS-000112-VMM-000560",
          "SRG-OS-000113-VMM-000570"
        ],
        "gid": "V-239292",
        "rid": "SV-239292r674805_rule",
        "stig_id": "ESXI-67-000037",
        "fix_id": "F-42484r674804_fix",
        "cci": [
          "CCI-000764",
          "CCI-000770",
          "CCI-001941",
          "CCI-001942"
        ],
        "nist": [
          "IA-2",
          "IA-2 (5)",
          "IA-2 (8)",
          "IA-2 (9)"
        ]
      },
      "code": "control \"ESXI-67-000037\" do\n  title 'The ESXi host must use Active Directory for local user authentication.'\n  desc  \"Join ESXi hosts to an Active Directory (AD) domain to eliminate the\nneed to create and maintain multiple local user accounts. Using AD for user\nauthentication simplifies the ESXi host configuration, ensures password\ncomplexity and reuse policies are enforced, and reduces the risk of security\nbreaches and unauthorized access.\n\n    Note: If the AD group \\\"ESX Admins\\\" (default) exists, then all users and\ngroups that are assigned as members to this group will have full administrative\naccess to all ESXi hosts the domain.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Authentication Services.\n\n    Verify the \\\"Directory Services Type\\\" is set to \\\"Active Directory\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-VMHostAuthentication\n\n    For systems that do not use Active Directory and have no local user\naccounts, other than root and/or vpxuser, this is Not Applicable.\n\n    For systems that do not use Active Directory and do have local user\naccounts, other than root and/or vpxuser, this is a finding.\n\n    If the \\\"Directory Services Type\\\" is not set to \\\"Active Directory\\\", this\nis a finding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Authentication Services.\n\n    Click \\\"Join Domain\\\" and enter the AD domain to join. Select the \\\"Using\ncredentials” radio button, enter the credentials of an account with permissions\nto join machines to AD (use UPN naming – user@domain), and then click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-VMHostAuthentication | Set-VMHostAuthentication\n-JoinDomain -Domain \\\"domain name\\\" -User \\\"username\\\" -Password \\\"password\\\"\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000104-VMM-000500'\n  tag satisfies: ['SRG-OS-000104-VMM-000500', 'SRG-OS-000109-VMM-000550',\n'SRG-OS-000112-VMM-000560', 'SRG-OS-000113-VMM-000570']\n  tag gid: 'V-239292'\n  tag rid: 'SV-239292r674805_rule'\n  tag stig_id: 'ESXI-67-000037'\n  tag fix_id: 'F-42484r674804_fix'\n  tag cci: ['CCI-000764', 'CCI-000770', 'CCI-001941', 'CCI-001942']\n  tag nist: ['IA-2', 'IA-2 (5)', 'IA-2 (8)', 'IA-2 (9)']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-VMHostAuthentication | Select-Object -ExpandProperty DomainMembershipStatus\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should be_in [\"Joined\",\"Ok\"] }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000037.rb",
        "line": 1
      },
      "id": "ESXI-67-000037"
    },
    {
      "title": "The ESXi host SSH daemon must set a timeout count on idle sessions.",
      "desc": "Setting a timeout ensures that a user login will be terminated as soon\nas the \"ClientAliveCountMax\" is reached.",
      "descriptions": {
        "default": "Setting a timeout ensures that a user login will be terminated as soon\nas the \"ClientAliveCountMax\" is reached.",
        "rationale": "",
        "check": "From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \"^ClientAliveCountMax\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \"ClientAliveCountMax\n3\", this is a finding.",
        "fix": "From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \"/etc/ssh/sshd_config\":\n\n    ClientAliveCountMax 3"
      },
      "impact": 0.3,
      "refs": [],
      "tags": {
        "severity": "low",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239281",
        "rid": "SV-239281r674772_rule",
        "stig_id": "ESXI-67-000026",
        "fix_id": "F-42473r674771_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000026\" do\n  title 'The ESXi host SSH daemon must set a timeout count on idle sessions.'\n  desc  \"Setting a timeout ensures that a user login will be terminated as soon\nas the \\\"ClientAliveCountMax\\\" is reached.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \\\"^ClientAliveCountMax\\\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \\\"ClientAliveCountMax\n3\\\", this is a finding.\n  \"\n  desc  'fix', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    ClientAliveCountMax 3\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239281'\n  tag rid: 'SV-239281r674772_rule'\n  tag stig_id: 'ESXI-67-000026'\n  tag fix_id: 'F-42473r674771_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"$vmhost = Get-VMHost -Name #{input('vmhostName')}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.software.vib.list.Invoke() | Where {$_.Name -eq '#{input('dodStigVibRootEnabled')}' -or $_.Name -eq '#{input('dodStigVibRootDisabled')}'}\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should_not cmp \"\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000026.rb",
        "line": 1
      },
      "id": "ESXI-67-000026"
    },
    {
      "title": "The ESXi host SSH daemon must not allow authentication using an empty\npassword.",
      "desc": "Configuring this setting for the SSH daemon provides additional\nassurance that remote logon via SSH will require a password, even in the event\nof misconfiguration elsewhere.",
      "descriptions": {
        "default": "Configuring this setting for the SSH daemon provides additional\nassurance that remote logon via SSH will require a password, even in the event\nof misconfiguration elsewhere.",
        "rationale": "",
        "check": "From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \"^PermitEmptyPasswords\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \"PermitEmptyPasswords\nno\", this is a finding.",
        "fix": "From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \"/etc/ssh/sshd_config\":\n\n    PermitEmptyPasswords no"
      },
      "impact": 0.7,
      "refs": [],
      "tags": {
        "severity": "high",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239271",
        "rid": "SV-239271r674742_rule",
        "stig_id": "ESXI-67-000015",
        "fix_id": "F-42463r674741_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000015\" do\n  title \"The ESXi host SSH daemon must not allow authentication using an empty\npassword.\"\n  desc  \"Configuring this setting for the SSH daemon provides additional\nassurance that remote logon via SSH will require a password, even in the event\nof misconfiguration elsewhere.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \\\"^PermitEmptyPasswords\\\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \\\"PermitEmptyPasswords\nno\\\", this is a finding.\n  \"\n  desc  'fix', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    PermitEmptyPasswords no\n  \"\n  impact 0.7\n  tag severity: 'high'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239271'\n  tag rid: 'SV-239271r674742_rule'\n  tag stig_id: 'ESXI-67-000015'\n  tag fix_id: 'F-42463r674741_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"$vmhost = Get-VMHost -Name #{input('vmhostName')}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.software.vib.list.Invoke() | Where {$_.Name -eq '#{input('dodStigVibRootEnabled')}' -or $_.Name -eq '#{input('dodStigVibRootDisabled')}'}\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should_not cmp \"\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000015.rb",
        "line": 1
      },
      "id": "ESXI-67-000015"
    },
    {
      "title": "The ESXi host SSH daemon must not permit root logins.",
      "desc": "Permitting direct root login reduces auditable information about who\nran privileged commands on the system and also allows direct attack attempts on\nroot's password.",
      "descriptions": {
        "default": "Permitting direct root login reduces auditable information about who\nran privileged commands on the system and also allows direct attack attempts on\nroot's password.",
        "rationale": "",
        "check": "From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \"^PermitRootLogin\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \"PermitRootLogin no\",\nthis is a finding.",
        "fix": "From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \"/etc/ssh/sshd_config\":\n\n    Add or correct the following line in \"/etc/ssh/sshd_config\":\n\n    PermitRootLogin no"
      },
      "impact": 0.3,
      "refs": [],
      "tags": {
        "severity": "low",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239270",
        "rid": "SV-239270r674739_rule",
        "stig_id": "ESXI-67-000014",
        "fix_id": "F-42462r674738_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000014\" do\n  title 'The ESXi host SSH daemon must not permit root logins.'\n  desc  \"Permitting direct root login reduces auditable information about who\nran privileged commands on the system and also allows direct attack attempts on\nroot's password.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \\\"^PermitRootLogin\\\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \\\"PermitRootLogin no\\\",\nthis is a finding.\n  \"\n  desc  'fix', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    Add or correct the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    PermitRootLogin no\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239270'\n  tag rid: 'SV-239270r674739_rule'\n  tag stig_id: 'ESXI-67-000014'\n  tag fix_id: 'F-42462r674738_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"$vmhost = Get-VMHost -Name #{input('vmhostName')}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.software.vib.list.Invoke() | Where {$_.Name -eq '#{input('dodStigVibRootEnabled')}' -or $_.Name -eq '#{input('dodStigVibRootDisabled')}'}\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should_not cmp \"\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000014.rb",
        "line": 1
      },
      "id": "ESXI-67-000014"
    },
    {
      "title": "The ESXi host SSH daemon must limit connections to a single session.",
      "desc": "The SSH protocol has the ability to provide multiple sessions over a\nsingle connection without reauthentication. A compromised client could use this\nfeature to establish additional sessions to a system without consent or\nknowledge of the user.",
      "descriptions": {
        "default": "The SSH protocol has the ability to provide multiple sessions over a\nsingle connection without reauthentication. A compromised client could use this\nfeature to establish additional sessions to a system without consent or\nknowledge of the user.",
        "rationale": "",
        "check": "From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \"^MaxSessions\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \"MaxSessions 1\", this\nis a finding.",
        "fix": "From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \"/etc/ssh/sshd_config\":\n\n    MaxSessions 1"
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239283",
        "rid": "SV-239283r674778_rule",
        "stig_id": "ESXI-67-000028",
        "fix_id": "F-42475r674777_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000028\" do\n  title 'The ESXi host SSH daemon must limit connections to a single session.'\n  desc  \"The SSH protocol has the ability to provide multiple sessions over a\nsingle connection without reauthentication. A compromised client could use this\nfeature to establish additional sessions to a system without consent or\nknowledge of the user.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \\\"^MaxSessions\\\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \\\"MaxSessions 1\\\", this\nis a finding.\n  \"\n  desc  'fix', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    MaxSessions 1\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239283'\n  tag rid: 'SV-239283r674778_rule'\n  tag stig_id: 'ESXI-67-000028'\n  tag fix_id: 'F-42475r674777_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"$vmhost = Get-VMHost -Name #{input('vmhostName')}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.software.vib.list.Invoke() | Where {$_.Name -eq '#{input('dodStigVibRootEnabled')}' -or $_.Name -eq '#{input('dodStigVibRootDisabled')}'}\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should_not cmp \"\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000028.rb",
        "line": 1
      },
      "id": "ESXI-67-000028"
    },
    {
      "title": "The ESXi host SSH daemon must not permit user environment settings.",
      "desc": "SSH environment options potentially allow users to bypass access\nrestriction in some configurations. Users must not be able to present\nenvironment options to the SSH daemon.",
      "descriptions": {
        "default": "SSH environment options potentially allow users to bypass access\nrestriction in some configurations. Users must not be able to present\nenvironment options to the SSH daemon.",
        "rationale": "",
        "check": "From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \"^PermitUserEnvironment\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \"PermitUserEnvironment\nno\", this is a finding.",
        "fix": "From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \"/etc/ssh/sshd_config\":\n\n    PermitUserEnvironment no"
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239272",
        "rid": "SV-239272r674745_rule",
        "stig_id": "ESXI-67-000016",
        "fix_id": "F-42464r674744_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000016\" do\n  title 'The ESXi host SSH daemon must not permit user environment settings.'\n  desc  \"SSH environment options potentially allow users to bypass access\nrestriction in some configurations. Users must not be able to present\nenvironment options to the SSH daemon.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \\\"^PermitUserEnvironment\\\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \\\"PermitUserEnvironment\nno\\\", this is a finding.\n  \"\n  desc  'fix', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    PermitUserEnvironment no\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239272'\n  tag rid: 'SV-239272r674745_rule'\n  tag stig_id: 'ESXI-67-000016'\n  tag fix_id: 'F-42464r674744_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"$vmhost = Get-VMHost -Name #{input('vmhostName')}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.software.vib.list.Invoke() | Where {$_.Name -eq '#{input('dodStigVibRootEnabled')}' -or $_.Name -eq '#{input('dodStigVibRootDisabled')}'}\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should_not cmp \"\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000016.rb",
        "line": 1
      },
      "id": "ESXI-67-000016"
    },
    {
      "title": "For the ESXi host, all port groups must not be configured to VLAN\nvalues reserved by upstream physical switches.",
      "desc": "Certain physical switches reserve certain VLAN IDs for internal\npurposes and often disallow traffic configured to these values. For example,\nCisco Catalyst switches typically reserve VLANs 1001-1024 and 4094, while Nexus\nswitches typically reserve 3968-4047 and 4094. Check the documentation for the\nspecific switch. Using a reserved VLAN might result in a denial of service on\nthe network.",
      "descriptions": {
        "default": "Certain physical switches reserve certain VLAN IDs for internal\npurposes and often disallow traffic configured to these values. For example,\nCisco Catalyst switches typically reserve VLANs 1001-1024 and 4094, while Nexus\nswitches typically reserve 3968-4047 and 4094. Check the documentation for the\nspecific switch. Using a reserved VLAN might result in a denial of service on\nthe network.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi host and go to Configure >>\nNetworking >> Virtual switches. For each virtual switch, review the port group\nVLAN tags and verify they are not set to a reserved VLAN ID.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VirtualPortGroup | Select Name, VLanId\n\n    If any port group is configured with a reserved VLAN ID, this is a finding.",
        "fix": "From the vSphere Client, select the ESXi host and go to Configure >>\nNetworking >> Virtual switches.\n\n    Highlight a port group where VLAN ID is set to a reserved value and click\n\"Edit\" settings (dots).\n\n    Change the VLAN ID to an appropriate VLAN and click \"OK\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VirtualPortGroup -Name \"portgroup name\" | Set-VirtualPortGroup\n-VLanId \"New VLAN#\""
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239319",
        "rid": "SV-239319r674886_rule",
        "stig_id": "ESXI-67-000065",
        "fix_id": "F-42511r674885_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000065\" do\n  title \"For the ESXi host, all port groups must not be configured to VLAN\nvalues reserved by upstream physical switches.\"\n  desc  \"Certain physical switches reserve certain VLAN IDs for internal\npurposes and often disallow traffic configured to these values. For example,\nCisco Catalyst switches typically reserve VLANs 1001-1024 and 4094, while Nexus\nswitches typically reserve 3968-4047 and 4094. Check the documentation for the\nspecific switch. Using a reserved VLAN might result in a denial of service on\nthe network.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi host and go to Configure >>\nNetworking >> Virtual switches. For each virtual switch, review the port group\nVLAN tags and verify they are not set to a reserved VLAN ID.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VirtualPortGroup | Select Name, VLanId\n\n    If any port group is configured with a reserved VLAN ID, this is a finding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi host and go to Configure >>\nNetworking >> Virtual switches.\n\n    Highlight a port group where VLAN ID is set to a reserved value and click\n\\\"Edit\\\" settings (dots).\n\n    Change the VLAN ID to an appropriate VLAN and click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VirtualPortGroup -Name \\\"portgroup name\\\" | Set-VirtualPortGroup\n-VLanId \\\"New VLAN#\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239319'\n  tag rid: 'SV-239319r674886_rule'\n  tag stig_id: 'ESXI-67-000065'\n  tag fix_id: 'F-42511r674885_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vlanlist= [\"1001\",\"1024\",\"3968\",\"4047\",\"4094\"]\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-VirtualPortGroup | Select-Object -ExpandProperty VlanId\"\n  result = powercli_command(command).stdout.split(\"\\r\\n\")\n  describe result do\n    it { should_not be_in vlanlist }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000065.rb",
        "line": 1
      },
      "id": "ESXI-67-000065"
    },
    {
      "title": "The ESXi host SSH daemon must not allow compression or must only allow\ncompression after successful authentication.",
      "desc": "If compression is allowed in an SSH connection prior to\nauthentication, vulnerabilities in the compression software could result in\ncompromise of the system from an unauthenticated connection, potentially with\nroot privileges.",
      "descriptions": {
        "default": "If compression is allowed in an SSH connection prior to\nauthentication, vulnerabilities in the compression software could result in\ncompromise of the system from an unauthenticated connection, potentially with\nroot privileges.",
        "rationale": "",
        "check": "From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \"^Compression\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \"Compression no\", this\nis a finding.",
        "fix": "From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \"/etc/ssh/sshd_config\":\n\n    Compression no"
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239276",
        "rid": "SV-239276r674757_rule",
        "stig_id": "ESXI-67-000021",
        "fix_id": "F-42468r674756_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000021\" do\n  title \"The ESXi host SSH daemon must not allow compression or must only allow\ncompression after successful authentication.\"\n  desc  \"If compression is allowed in an SSH connection prior to\nauthentication, vulnerabilities in the compression software could result in\ncompromise of the system from an unauthenticated connection, potentially with\nroot privileges.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \\\"^Compression\\\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \\\"Compression no\\\", this\nis a finding.\n  \"\n  desc  'fix', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    Compression no\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239276'\n  tag rid: 'SV-239276r674757_rule'\n  tag stig_id: 'ESXI-67-000021'\n  tag fix_id: 'F-42468r674756_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"$vmhost = Get-VMHost -Name #{input('vmhostName')}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.software.vib.list.Invoke() | Where {$_.Name -eq '#{input('dodStigVibRootEnabled')}' -or $_.Name -eq '#{input('dodStigVibRootDisabled')}'}\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should_not cmp \"\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000021.rb",
        "line": 1
      },
      "id": "ESXI-67-000021"
    },
    {
      "title": "ESXi hosts using Host Profiles and/or Auto Deploy must use the vSphere\nAuthentication Proxy to protect passwords when adding themselves to Active\nDirectory.",
      "desc": "If a host is configured to join an Active Directory domain using Host\nProfiles and/or Auto Deploy, the Active Directory credentials are saved in the\nprofile and are transmitted over the network. To avoid having to save Active\nDirectory credentials in the Host Profile and to avoid transmitting Active\nDirectory credentials over the network, use the vSphere Authentication Proxy.",
      "descriptions": {
        "default": "If a host is configured to join an Active Directory domain using Host\nProfiles and/or Auto Deploy, the Active Directory credentials are saved in the\nprofile and are transmitted over the network. To avoid having to save Active\nDirectory credentials in the Host Profile and to avoid transmitting Active\nDirectory credentials over the network, use the vSphere Authentication Proxy.",
        "rationale": "",
        "check": "From the vSphere Client, go to Home >> Host Profiles and select a Host\nProfile to edit.\n\n    View the settings under Security and Services >> Security Settings >>\nAuthentication Configuration >> Active Directory Configuration >> Join Domain\nMethod.\n\n    Verify the method used to join hosts to a domain is set to \"Use vSphere\nAuthentication Proxy to add the host to domain\".\n\n    or\n\n    From a PowerCLI command prompt while connected to vCenter, run the\nfollowing command:\n\n    Get-VMHost | Select Name, ` @{N=\"HostProfile\";E={$_ |\nGet-VMHostProfile}}, ` @{N=\"JoinADEnabled\";E={($_ |\nGet-VmHostProfile).ExtensionData.Config.ApplyProfile.Authentication.ActiveDirectory.Enabled}},\n` @{N=\"JoinDomainMethod\";E={(($_ |\nGet-VMHostProfile).ExtensionData.Config.ApplyProfile.Authentication.ActiveDirectory\n| Select -ExpandProperty Policy | Where {$_.Id -eq\n\"JoinDomainMethodPolicy\"}).Policyoption.Id}}\n\n    Verify that if \"JoinADEnabled\" is \"True\", \"JoinDomainMethod\" is\n\"FixedCAMConfigOption\".\n\n    If not using Host Profiles to join active directory, this is not a finding.",
        "fix": "From the vSphere Client, go to Home >> Host Profiles and select a Host\nProfile to edit.\n\n    View the settings under Security and Services >> Security Settings >>\nAuthentication Configuration >> Active Directory Configuration >> Join Domain\nMethod.\n\n    Set the method used to join hosts to a domain to \"Use vSphere\nAuthentication Proxy to add the host to domain\" and provide the IP address of\nthe vSphere Authentication Proxy server."
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000104-VMM-000500",
        "satisfies": [
          "SRG-OS-000104-VMM-000500",
          "SRG-OS-000109-VMM-000550",
          "SRG-OS-000112-VMM-000560",
          "SRG-OS-000113-VMM-000570"
        ],
        "gid": "V-239293",
        "rid": "SV-239293r674808_rule",
        "stig_id": "ESXI-67-000038",
        "fix_id": "F-42485r674807_fix",
        "cci": [
          "CCI-000764",
          "CCI-000770",
          "CCI-001941",
          "CCI-001942"
        ],
        "nist": [
          "IA-2",
          "IA-2 (5)",
          "IA-2 (8)",
          "IA-2 (9)"
        ]
      },
      "code": "control \"ESXI-67-000038\" do\n  title \"ESXi hosts using Host Profiles and/or Auto Deploy must use the vSphere\nAuthentication Proxy to protect passwords when adding themselves to Active\nDirectory.\"\n  desc  \"If a host is configured to join an Active Directory domain using Host\nProfiles and/or Auto Deploy, the Active Directory credentials are saved in the\nprofile and are transmitted over the network. To avoid having to save Active\nDirectory credentials in the Host Profile and to avoid transmitting Active\nDirectory credentials over the network, use the vSphere Authentication Proxy.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Home >> Host Profiles and select a Host\nProfile to edit.\n\n    View the settings under Security and Services >> Security Settings >>\nAuthentication Configuration >> Active Directory Configuration >> Join Domain\nMethod.\n\n    Verify the method used to join hosts to a domain is set to \\\"Use vSphere\nAuthentication Proxy to add the host to domain\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to vCenter, run the\nfollowing command:\n\n    Get-VMHost | Select Name, ` @{N=\\\"HostProfile\\\";E={$_ |\nGet-VMHostProfile}}, ` @{N=\\\"JoinADEnabled\\\";E={($_ |\nGet-VmHostProfile).ExtensionData.Config.ApplyProfile.Authentication.ActiveDirectory.Enabled}},\n` @{N=\\\"JoinDomainMethod\\\";E={(($_ |\nGet-VMHostProfile).ExtensionData.Config.ApplyProfile.Authentication.ActiveDirectory\n| Select -ExpandProperty Policy | Where {$_.Id -eq\n\\\"JoinDomainMethodPolicy\\\"}).Policyoption.Id}}\n\n    Verify that if \\\"JoinADEnabled\\\" is \\\"True\\\", \\\"JoinDomainMethod\\\" is\n\\\"FixedCAMConfigOption\\\".\n\n    If not using Host Profiles to join active directory, this is not a finding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, go to Home >> Host Profiles and select a Host\nProfile to edit.\n\n    View the settings under Security and Services >> Security Settings >>\nAuthentication Configuration >> Active Directory Configuration >> Join Domain\nMethod.\n\n    Set the method used to join hosts to a domain to \\\"Use vSphere\nAuthentication Proxy to add the host to domain\\\" and provide the IP address of\nthe vSphere Authentication Proxy server.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000104-VMM-000500'\n  tag satisfies: ['SRG-OS-000104-VMM-000500', 'SRG-OS-000109-VMM-000550',\n'SRG-OS-000112-VMM-000560', 'SRG-OS-000113-VMM-000570']\n  tag gid: 'V-239293'\n  tag rid: 'SV-239293r674808_rule'\n  tag stig_id: 'ESXI-67-000038'\n  tag fix_id: 'F-42485r674807_fix'\n  tag cci: ['CCI-000764', 'CCI-000770', 'CCI-001941', 'CCI-001942']\n  tag nist: ['IA-2', 'IA-2 (5)', 'IA-2 (8)', 'IA-2 (9)']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-VMHostProfile\"\n  hostprofile = powercli_command(command).stdout\n\n  if hostprofile.empty?\n    describe \"\" do\n      skip \"There are no attached host profiles to this host so this control is not applicable\"\n    end\n  end\n\n  if !hostprofile.empty?\n    command1 = \"(Get-VMHost -Name #{input('vmhostName')} | Get-VMHostProfile).ExtensionData.Config.ApplyProfile.Authentication.ActiveDirectory.Enabled\"\n    adEnabled = powercli_command(command1).stdout.strip\n\n    if adEnabled.match?(\"True\")\n      command2 = \"(Get-VMHost -Name #{input('vmhostName')} | Get-VMHostProfile).ExtensionData.Config.ApplyProfile.Authentication.ActiveDirectory | Select-Object -ExpandProperty Policy | Where {$_.Id -eq 'JoinDomainMethodPolicy'} | Select-Object -ExpandProperty PolicyOption | Select-Object -ExpandProperty Id\"\n      describe powercli_command(command2) do\n        its('stdout.strip') { should cmp \"FixedCAMConfigOption\" }\n      end\n    end\n\n    if adEnabled.match?(\"False\")\n      describe \"\" do\n        skip \"Active Directory is not enabled on this host so this control is not applicable\"\n      end\n    end\n\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000038.rb",
        "line": 1
      },
      "id": "ESXI-67-000038"
    },
    {
      "title": "The ESXi host must protect the confidentiality and integrity of\ntransmitted information by protecting ESXi management traffic.",
      "desc": "The vSphere management network provides access to the vSphere\nmanagement interface on each component. Services running on the management\ninterface provide an opportunity for an attacker to gain privileged access to\nthe systems. Any remote attack most likely would begin with gaining entry to\nthis network.",
      "descriptions": {
        "default": "The vSphere management network provides access to the vSphere\nmanagement interface on each component. Services running on the management\ninterface provide an opportunity for an attacker to gain privileged access to\nthe systems. Any remote attack most likely would begin with gaining entry to\nthis network.",
        "rationale": "",
        "check": "Verify the Management VMkernel port group is on a dedicated VLAN, which can\nbe on a common standard or distributed virtual switch as long as the Management\nVLAN is not shared by any other function and is not accessible to anything\nother than management-related functions such as vCenter.\n\n    The check for this will be unique per environment.\n\n    From the vSphere Client, select the ESXi host and go to Configure >>\nNetworking.\n\n    Review the VLAN associated with the Management VMkernel and verify it is\ndedicated for that purpose and is logically separated from other functions.\n\n    If the network segment is accessible, except to networks where other\nmanagement-related entities such as vCenter are located, this is a finding.",
        "fix": "From the vSphere Client, select the ESXi host and go to Configure >>\nNetworking >> VMkernel adapters.\n\n    Select the Management VMkernel and click \"Edit\".\n\n    On the Port properties tab, uncheck everything but \"Management.”\n\n    On the IP Settings tab, enter the appropriate IP address and subnet\ninformation and click \"OK\".\n\n    Set the appropriate VLAN ID >> Configure >> Networking >> Virtual switches.\n\n    Select the Management portgroup and click \"Edit\".\n\n    On the properties tab, enter the appropriate VLAN ID and click \"OK\"."
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000423-VMM-001700",
        "gid": "V-239304",
        "rid": "SV-239304r674841_rule",
        "stig_id": "ESXI-67-000049",
        "fix_id": "F-42496r674840_fix",
        "cci": [
          "CCI-002418"
        ],
        "nist": [
          "SC-8"
        ]
      },
      "code": "control \"ESXI-67-000049\" do\n  title \"The ESXi host must protect the confidentiality and integrity of\ntransmitted information by protecting ESXi management traffic.\"\n  desc  \"The vSphere management network provides access to the vSphere\nmanagement interface on each component. Services running on the management\ninterface provide an opportunity for an attacker to gain privileged access to\nthe systems. Any remote attack most likely would begin with gaining entry to\nthis network.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    Verify the Management VMkernel port group is on a dedicated VLAN, which can\nbe on a common standard or distributed virtual switch as long as the Management\nVLAN is not shared by any other function and is not accessible to anything\nother than management-related functions such as vCenter.\n\n    The check for this will be unique per environment.\n\n    From the vSphere Client, select the ESXi host and go to Configure >>\nNetworking.\n\n    Review the VLAN associated with the Management VMkernel and verify it is\ndedicated for that purpose and is logically separated from other functions.\n\n    If the network segment is accessible, except to networks where other\nmanagement-related entities such as vCenter are located, this is a finding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi host and go to Configure >>\nNetworking >> VMkernel adapters.\n\n    Select the Management VMkernel and click \\\"Edit\\\".\n\n    On the Port properties tab, uncheck everything but \\\"Management.”\n\n    On the IP Settings tab, enter the appropriate IP address and subnet\ninformation and click \\\"OK\\\".\n\n    Set the appropriate VLAN ID >> Configure >> Networking >> Virtual switches.\n\n    Select the Management portgroup and click \\\"Edit\\\".\n\n    On the properties tab, enter the appropriate VLAN ID and click \\\"OK\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000423-VMM-001700'\n  tag gid: 'V-239304'\n  tag rid: 'SV-239304r674841_rule'\n  tag stig_id: 'ESXI-67-000049'\n  tag fix_id: 'F-42496r674840_fix'\n  tag cci: ['CCI-002418']\n  tag nist: ['SC-8']\n\n  describe \"This check is a manual or policy based check\" do\n    skip \"This must be reviewed manually\"\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000049.rb",
        "line": 1
      },
      "id": "ESXI-67-000049"
    },
    {
      "title": "The ESXi host must configure the firewall to block network traffic by\ndefault.",
      "desc": "In addition to service-specific firewall rules, ESXi has a default\nfirewall rule policy to allow or deny incoming and outgoing traffic. Reduce the\nrisk of attack by making sure this is set to deny incoming and outgoing\ntraffic.",
      "descriptions": {
        "default": "In addition to service-specific firewall rules, ESXi has a default\nfirewall rule policy to allow or deny incoming and outgoing traffic. Reduce the\nrisk of attack by making sure this is set to deny incoming and outgoing\ntraffic.",
        "rationale": "",
        "check": "From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHostFirewallDefaultPolicy\n\n    If the Incoming or Outgoing policies are \"True\", this is a finding.",
        "fix": "From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHostFirewallDefaultPolicy | Set-VMHostFirewallDefaultPolicy\n-AllowIncoming $false -AllowOutgoing $false"
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239311",
        "rid": "SV-239311r674862_rule",
        "stig_id": "ESXI-67-000057",
        "fix_id": "F-42503r674861_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000057\" do\n  title \"The ESXi host must configure the firewall to block network traffic by\ndefault.\"\n  desc  \"In addition to service-specific firewall rules, ESXi has a default\nfirewall rule policy to allow or deny incoming and outgoing traffic. Reduce the\nrisk of attack by making sure this is set to deny incoming and outgoing\ntraffic.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHostFirewallDefaultPolicy\n\n    If the Incoming or Outgoing policies are \\\"True\\\", this is a finding.\n  \"\n  desc  'fix', \"\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHostFirewallDefaultPolicy | Set-VMHostFirewallDefaultPolicy\n-AllowIncoming $false -AllowOutgoing $false\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239311'\n  tag rid: 'SV-239311r674862_rule'\n  tag stig_id: 'ESXI-67-000057'\n  tag fix_id: 'F-42503r674861_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-VMHostFirewallDefaultPolicy\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should_not match \"True\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000057.rb",
        "line": 1
      },
      "id": "ESXI-67-000057"
    },
    {
      "title": "The ESXi host must have all security patches and updates installed.",
      "desc": "Installing software updates is a fundamental mitigation against the\nexploitation of publicly known vulnerabilities.",
      "descriptions": {
        "default": "Installing software updates is a fundamental mitigation against the\nexploitation of publicly known vulnerabilities.",
        "rationale": "",
        "check": "If vCenter Update Manager is used on the network, it can be used to scan\nall hosts for missing patches.\n\n    From the vSphere Client, go to Hosts and Clusters >> Updates.\n\n    Check under \"Attached Baselines\" and verify that a compliance check has\nbeen run.\n\n    If vCenter Update Manager is not used, host compliance status must be\ndetermined manually by the build number.\n\n    VMware KB 1014508 can be used to correlate patches with build numbers.\n\n    If the ESXi host does not have the latest patches, this is a finding.\n\n    If the ESXi host is not on a supported release, this is a finding.\n\n    VMware also publishes Advisories on security patches and offers a way to\nsubscribe to email alerts for them.\n\n    Go to: https://www.vmware.com/support/policies/security_response",
        "fix": "If vCenter Update Manager is used on the network, hosts can be remediated\nfrom the vSphere Web Client.\n\n    From the vSphere Client, go to Hosts and Clusters >> Updates.\n\n    Check under \"Attached Baselines\". If there are no baselines attached,\nselect the drop-down \"Attach >> Attach Baseline or Baseline Group\". Select\n\"attach\" and select the type of patches.\n\n    Click on Check Compliance to check Host(s) Compliance.\n\n    To manually remediate a host, the patch file must be copied locally and the\nfollowing command run from an SSH session connected to the ESXi host or from\nthe ESXi shell:\n\n    esxcli software vib update -d <path to offline patch bundle.zip>"
      },
      "impact": 0.7,
      "refs": [],
      "tags": {
        "severity": "high",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239325",
        "rid": "SV-239325r674904_rule",
        "stig_id": "ESXI-67-000072",
        "fix_id": "F-42517r674903_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000072\" do\n  title 'The ESXi host must have all security patches and updates installed.'\n  desc  \"Installing software updates is a fundamental mitigation against the\nexploitation of publicly known vulnerabilities.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    If vCenter Update Manager is used on the network, it can be used to scan\nall hosts for missing patches.\n\n    From the vSphere Client, go to Hosts and Clusters >> Updates.\n\n    Check under \\\"Attached Baselines\\\" and verify that a compliance check has\nbeen run.\n\n    If vCenter Update Manager is not used, host compliance status must be\ndetermined manually by the build number.\n\n    VMware KB 1014508 can be used to correlate patches with build numbers.\n\n    If the ESXi host does not have the latest patches, this is a finding.\n\n    If the ESXi host is not on a supported release, this is a finding.\n\n    VMware also publishes Advisories on security patches and offers a way to\nsubscribe to email alerts for them.\n\n    Go to: https://www.vmware.com/support/policies/security_response\n  \"\n  desc  'fix', \"\n    If vCenter Update Manager is used on the network, hosts can be remediated\nfrom the vSphere Web Client.\n\n    From the vSphere Client, go to Hosts and Clusters >> Updates.\n\n    Check under \\\"Attached Baselines\\\". If there are no baselines attached,\nselect the drop-down \\\"Attach >> Attach Baseline or Baseline Group\\\". Select\n\\\"attach\\\" and select the type of patches.\n\n    Click on Check Compliance to check Host(s) Compliance.\n\n    To manually remediate a host, the patch file must be copied locally and the\nfollowing command run from an SSH session connected to the ESXi host or from\nthe ESXi shell:\n\n    esxcli software vib update -d <path to offline patch bundle.zip>\n  \"\n  impact 0.7\n  tag severity: 'high'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239325'\n  tag rid: 'SV-239325r674904_rule'\n  tag stig_id: 'ESXI-67-000072'\n  tag fix_id: 'F-42517r674903_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}).ExtensionData.Config.Product.build\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp \"#{input('esxiBuildNumber')}\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000072.rb",
        "line": 1
      },
      "id": "ESXI-67-000072"
    },
    {
      "title": "The ESXi host must configure NTP time synchronization.",
      "desc": "To ensure the accuracy of the system clock, it must be synchronized\nwith an authoritative time source within DoD. Many system functions, including\ntime-based logon and activity restrictions, automated reports, system logs, and\naudit records, depend on an accurate system clock. If there is no confidence in\nthe correctness of the system clock, time-based functions may not operate as\nintended and records may be of diminished value.",
      "descriptions": {
        "default": "To ensure the accuracy of the system clock, it must be synchronized\nwith an authoritative time source within DoD. Many system functions, including\ntime-based logon and activity restrictions, automated reports, system logs, and\naudit records, depend on an accurate system clock. If there is no confidence in\nthe correctness of the system clock, time-based functions may not operate as\nintended and records may be of diminished value.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Time Configuration.\n\n    Click \"Edit\" to verify the configured NTP servers and service startup\npolicy.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-VMHostNTPServer\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \"NTP Daemon\"}\n\n    If the NTP service is not configured with authoritative DoD time sources or\nthe service does not have a \"Policy\" of \"on\" or is stopped, this is a\nfinding.",
        "fix": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Time Configuration.\n\n    Click \"Edit\" to configure the NTP service to start and stop with the host\nand with authoritative DoD time sources.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    $NTPServers = \"ntpserver1\",\"ntpserver2\"\n    Get-VMHost | Add-VMHostNTPServer $NTPServers\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \"NTP Daemon\"} |\nSet-VMHostService -Policy On\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \"NTP Daemon\"} |\nStart-VMHostService"
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000355-VMM-001330",
        "satisfies": [
          "SRG-OS-000355-VMM-001330",
          "SRG-OS-000356-VMM-001340"
        ],
        "gid": "V-239301",
        "rid": "SV-239301r674832_rule",
        "stig_id": "ESXI-67-000046",
        "fix_id": "F-42493r674831_fix",
        "cci": [
          "CCI-001891",
          "CCI-002046"
        ],
        "nist": [
          "AU-8 (1) (a)",
          "AU-8 (1) (b)"
        ]
      },
      "code": "control \"ESXI-67-000046\" do\n  title 'The ESXi host must configure NTP time synchronization.'\n  desc  \"To ensure the accuracy of the system clock, it must be synchronized\nwith an authoritative time source within DoD. Many system functions, including\ntime-based logon and activity restrictions, automated reports, system logs, and\naudit records, depend on an accurate system clock. If there is no confidence in\nthe correctness of the system clock, time-based functions may not operate as\nintended and records may be of diminished value.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Time Configuration.\n\n    Click \\\"Edit\\\" to verify the configured NTP servers and service startup\npolicy.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-VMHostNTPServer\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"NTP Daemon\\\"}\n\n    If the NTP service is not configured with authoritative DoD time sources or\nthe service does not have a \\\"Policy\\\" of \\\"on\\\" or is stopped, this is a\nfinding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Time Configuration.\n\n    Click \\\"Edit\\\" to configure the NTP service to start and stop with the host\nand with authoritative DoD time sources.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    $NTPServers = \\\"ntpserver1\\\",\\\"ntpserver2\\\"\n    Get-VMHost | Add-VMHostNTPServer $NTPServers\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"NTP Daemon\\\"} |\nSet-VMHostService -Policy On\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"NTP Daemon\\\"} |\nStart-VMHostService\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000355-VMM-001330'\n  tag satisfies: ['SRG-OS-000355-VMM-001330', 'SRG-OS-000356-VMM-001340']\n  tag gid: 'V-239301'\n  tag rid: 'SV-239301r674832_rule'\n  tag stig_id: 'ESXI-67-000046'\n  tag fix_id: 'F-42493r674831_fix'\n  tag cci: ['CCI-001891', 'CCI-002046']\n  tag nist: ['AU-8 (1) (a)', 'AU-8 (1) (b)']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-VMHostService | Where {$_.Label -eq 'NTP Daemon'} | Select-Object -ExpandProperty Policy\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp \"on\" }\n  end\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-VMHostService | Where {$_.Label -eq 'NTP Daemon'} | Select-Object -ExpandProperty Running\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp \"true\" }\n  end\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-VMHostNTPServer\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should match \"#{input('ntpServer1')}\" }\n    its('stdout.strip') { should match \"#{input('ntpServer2')}\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000046.rb",
        "line": 1
      },
      "id": "ESXI-67-000046"
    },
    {
      "title": "The ESXi host must prevent unintended use of the dvFilter network\nAPIs.",
      "desc": "If the organization is not using products that use the dvfilter\nnetwork API, the host should not be configured to send network information to a\nVM.\n\n    If the API is enabled, an attacker might attempt to connect a VM to it,\npotentially providing access to the network of other VMs on the host. If the\norganization is using a product that uses this API, verify that the host has\nbeen configured correctly. If the organization is not using such a product,\nensure the setting is blank.",
      "descriptions": {
        "default": "If the organization is not using products that use the dvfilter\nnetwork API, the host should not be configured to send network information to a\nVM.\n\n    If the API is enabled, an attacker might attempt to connect a VM to it,\npotentially providing access to the network of other VMs on the host. If the\norganization is using a product that uses this API, verify that the host has\nbeen configured correctly. If the organization is not using such a product,\nensure the setting is blank.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \"Net.DVFilterBindIpAddress\" value and verify the value is\nblank or the correct IP address of a security appliance if in use.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Net.DVFilterBindIpAddress\n\n    If the \"Net.DVFilterBindIpAddress\" is not blank and security appliances\nare not in use on the host, this is a finding.",
        "fix": "From the vSphere Client, select the ESXi Host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \"Edit\", select the \"Net.DVFilterBindIpAddress\" value, and remove\nany incorrect addresses.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Net.DVFilterBindIpAddress |\nSet-AdvancedSetting -Value \"\""
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239316",
        "rid": "SV-239316r674877_rule",
        "stig_id": "ESXI-67-000062",
        "fix_id": "F-42508r674876_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000062\" do\n  title \"The ESXi host must prevent unintended use of the dvFilter network\nAPIs.\"\n  desc  \"If the organization is not using products that use the dvfilter\nnetwork API, the host should not be configured to send network information to a\nVM.\n\n    If the API is enabled, an attacker might attempt to connect a VM to it,\npotentially providing access to the network of other VMs on the host. If the\norganization is using a product that uses this API, verify that the host has\nbeen configured correctly. If the organization is not using such a product,\nensure the setting is blank.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \\\"Net.DVFilterBindIpAddress\\\" value and verify the value is\nblank or the correct IP address of a security appliance if in use.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Net.DVFilterBindIpAddress\n\n    If the \\\"Net.DVFilterBindIpAddress\\\" is not blank and security appliances\nare not in use on the host, this is a finding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi Host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \\\"Edit\\\", select the \\\"Net.DVFilterBindIpAddress\\\" value, and remove\nany incorrect addresses.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Net.DVFilterBindIpAddress |\nSet-AdvancedSetting -Value \\\"\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239316'\n  tag rid: 'SV-239316r674877_rule'\n  tag stig_id: 'ESXI-67-000062'\n  tag fix_id: 'F-42508r674876_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-AdvancedSetting -Name Net.DVFilterBindIpAddress | Select-Object -ExpandProperty Value\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp \"\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000062.rb",
        "line": 1
      },
      "id": "ESXI-67-000062"
    },
    {
      "title": "The ESXi host must disable the Managed Object Browser (MOB).",
      "desc": "The MOB provides a way to explore the object model used by the\nVMkernel to manage the host and enables configurations to be changed as well.\nThis interface is meant to be used primarily for debugging the vSphere SDK, but\nbecause there are no access controls it could also be used as a method to\nobtain information about a host being targeted for unauthorized access.",
      "descriptions": {
        "default": "The MOB provides a way to explore the object model used by the\nVMkernel to manage the host and enables configurations to be changed as well.\nThis interface is meant to be used primarily for debugging the vSphere SDK, but\nbecause there are no access controls it could also be used as a method to\nobtain information about a host being targeted for unauthorized access.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi Host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \"Config.HostAgent.plugins.solo.enableMob\" value and verify it\nis set to \"false\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name\nConfig.HostAgent.plugins.solo.enableMob\n\n    If the \"Config.HostAgent.plugins.solo.enableMob\" setting is not set to\n\"false\", this is a finding.",
        "fix": "From the vSphere Client, select the ESXi Host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \"Edit\" and select the \"Config.HostAgent.plugins.solo.enableMob\"\nvalue and configure it to \"false\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VMHost | Get-AdvancedSetting -Name\nConfig.HostAgent.plugins.solo.enableMob | Set-AdvancedSetting -Value false"
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000095-VMM-000480",
        "gid": "V-239289",
        "rid": "SV-239289r674796_rule",
        "stig_id": "ESXI-67-000034",
        "fix_id": "F-42481r674795_fix",
        "cci": [
          "CCI-000381"
        ],
        "nist": [
          "CM-7 a"
        ]
      },
      "code": "control \"ESXI-67-000034\" do\n  title 'The ESXi host must disable the Managed Object Browser (MOB).'\n  desc  \"The MOB provides a way to explore the object model used by the\nVMkernel to manage the host and enables configurations to be changed as well.\nThis interface is meant to be used primarily for debugging the vSphere SDK, but\nbecause there are no access controls it could also be used as a method to\nobtain information about a host being targeted for unauthorized access.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi Host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \\\"Config.HostAgent.plugins.solo.enableMob\\\" value and verify it\nis set to \\\"false\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name\nConfig.HostAgent.plugins.solo.enableMob\n\n    If the \\\"Config.HostAgent.plugins.solo.enableMob\\\" setting is not set to\n\\\"false\\\", this is a finding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi Host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \\\"Edit\\\" and select the \\\"Config.HostAgent.plugins.solo.enableMob\\\"\nvalue and configure it to \\\"false\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VMHost | Get-AdvancedSetting -Name\nConfig.HostAgent.plugins.solo.enableMob | Set-AdvancedSetting -Value false\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000095-VMM-000480'\n  tag gid: 'V-239289'\n  tag rid: 'SV-239289r674796_rule'\n  tag stig_id: 'ESXI-67-000034'\n  tag fix_id: 'F-42481r674795_fix'\n  tag cci: ['CCI-000381']\n  tag nist: ['CM-7 a']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-AdvancedSetting -Name Config.HostAgent.plugins.solo.enableMob | Select-Object -ExpandProperty Value\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp \"false\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000034.rb",
        "line": 1
      },
      "id": "ESXI-67-000034"
    },
    {
      "title": "All ESXi host-connected physical switch ports must be configured with\nspanning tree disabled.",
      "desc": "Since VMware virtual switches do not support STP, the ESXi\nhost-connected physical switch ports must have portfast configured if spanning\ntree is enabled to avoid loops within the physical switch network. If these are\nnot set, potential performance and connectivity issues might arise.",
      "descriptions": {
        "default": "Since VMware virtual switches do not support STP, the ESXi\nhost-connected physical switch ports must have portfast configured if spanning\ntree is enabled to avoid loops within the physical switch network. If these are\nnot set, potential performance and connectivity issues might arise.",
        "rationale": "",
        "check": "Note that this check refers to an entity outside the physical scope of the\nESXi server system. The configuration of upstream physical switches must be\ndocumented to ensure that spanning tree protocol is disabled and/or portfast is\nconfigured for all physical ports connected to ESXi hosts.\n\n    Inspect the documentation and verify that the documentation is updated\naccording to an organization-defined frequency and/or whenever modifications\nare made to either ESXi hosts or the upstream physical switches.\n\n    Alternatively, log in to the physical switch and verify that spanning tree\nprotocol is disabled and/or portfast is configured for all physical ports\nconnected to ESXi hosts.\n\n    If the physical switch's spanning tree protocol is not disabled or portfast\nis not configured for all physical ports connected to ESXi hosts, this is a\nfinding.",
        "fix": "Note that this check refers to an entity outside the scope of the ESXi\nserver system.\n\n    Document the upstream physical switch configuration for spanning tree\nprotocol disablement and/or portfast configuration for all physical ports\nconnected to ESXi hosts.\n\n    Log in to the physical switch(es) and disable spanning tree protocol and/or\nconfigure portfast for all physical ports connected to ESXi hosts.\n\n    Update the documentation on an organization defined frequency or whenever\nmodifications are made to either ESXi hosts or the upstream physical switches."
      },
      "impact": 0.3,
      "refs": [],
      "tags": {
        "severity": "low",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239321",
        "rid": "SV-239321r674892_rule",
        "stig_id": "ESXI-67-000067",
        "fix_id": "F-42513r674891_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000067\" do\n  title \"All ESXi host-connected physical switch ports must be configured with\nspanning tree disabled.\"\n  desc  \"Since VMware virtual switches do not support STP, the ESXi\nhost-connected physical switch ports must have portfast configured if spanning\ntree is enabled to avoid loops within the physical switch network. If these are\nnot set, potential performance and connectivity issues might arise.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    Note that this check refers to an entity outside the physical scope of the\nESXi server system. The configuration of upstream physical switches must be\ndocumented to ensure that spanning tree protocol is disabled and/or portfast is\nconfigured for all physical ports connected to ESXi hosts.\n\n    Inspect the documentation and verify that the documentation is updated\naccording to an organization-defined frequency and/or whenever modifications\nare made to either ESXi hosts or the upstream physical switches.\n\n    Alternatively, log in to the physical switch and verify that spanning tree\nprotocol is disabled and/or portfast is configured for all physical ports\nconnected to ESXi hosts.\n\n    If the physical switch's spanning tree protocol is not disabled or portfast\nis not configured for all physical ports connected to ESXi hosts, this is a\nfinding.\n  \"\n  desc  'fix', \"\n    Note that this check refers to an entity outside the scope of the ESXi\nserver system.\n\n    Document the upstream physical switch configuration for spanning tree\nprotocol disablement and/or portfast configuration for all physical ports\nconnected to ESXi hosts.\n\n    Log in to the physical switch(es) and disable spanning tree protocol and/or\nconfigure portfast for all physical ports connected to ESXi hosts.\n\n    Update the documentation on an organization defined frequency or whenever\nmodifications are made to either ESXi hosts or the upstream physical switches.\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239321'\n  tag rid: 'SV-239321r674892_rule'\n  tag stig_id: 'ESXI-67-000067'\n  tag fix_id: 'F-42513r674891_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe \"This check is a manual or policy based check\" do\n    skip \"This must be reviewed manually\"\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000067.rb",
        "line": 1
      },
      "id": "ESXI-67-000067"
    },
    {
      "title": "The ESXi host must configure the firewall to restrict access to\nservices running on the host.",
      "desc": "Unrestricted access to services running on an ESXi host can expose a\nhost to outside attacks and unauthorized access. Reduce the risk by configuring\nthe ESXi firewall to only allow access from authorized networks.",
      "descriptions": {
        "default": "Unrestricted access to services running on an ESXi host can expose a\nhost to outside attacks and unauthorized access. Reduce the risk by configuring\nthe ESXi firewall to only allow access from authorized networks.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Firewall.\n\n    Under the \"Firewall\" section, click \"Edit\".\n\n    For each enabled service, click \"Firewall\" and review the allowed IPs.\n\n    Check this for incoming and outgoing connections.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-VMHostFirewallException | Where {$_.Enabled -eq $true} |\nSelect\nName,Enabled,@{N=\"AllIPEnabled\";E={$_.ExtensionData.AllowedHosts.AllIP}}\n\n    If for an enabled service \"Allow connections from any IP address\" is\nselected, this is a finding.",
        "fix": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Firewall.\n\n    Under the \"Firewall\" section, click \"Edit\".\n\n    For each enabled service, uncheck the check box to “Allow connections from\nany IP address” and input the site-specific network(s) required.\n\n    Configure this for incoming and outgoing connections.\n\n    The following example formats are acceptable:\n\n    192.168.0.0/24\n    192.168.1.2, 2001::1/64\n    fd3e:29a6:0a81:e478::/64\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    $esxcli = Get-EsxCli -v2\n    #This disables the allow all rule for the target service. We are targeting\nthe sshServer service in this example.\n    $arguments = $esxcli.network.firewall.ruleset.set.CreateArgs()\n    $arguments.rulesetid = \"sshServer\"\n    $arguments.allowedall = $false\n    $esxcli.network.firewall.ruleset.set.Invoke($arguments)\n\n    #Next add the allowed IPs for the service. Note doing the \"vSphere Web\nClient\" service this way may disable access but may be done through vCenter or\nthrough the console.\n    $arguments = $esxcli.network.firewall.ruleset.allowedip.add.CreateArgs()\n    $arguments.rulesetid = \"sshServer\"\n    $arguments.ipaddress = \"10.0.0.0/8\"\n    $esxcli.network.firewall.ruleset.allowedip.add.Invoke($arguments)\n\n    This must be done for each enabled service."
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239310",
        "rid": "SV-239310r674859_rule",
        "stig_id": "ESXI-67-000056",
        "fix_id": "F-42502r674858_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000056\" do\n  title \"The ESXi host must configure the firewall to restrict access to\nservices running on the host.\"\n  desc  \"Unrestricted access to services running on an ESXi host can expose a\nhost to outside attacks and unauthorized access. Reduce the risk by configuring\nthe ESXi firewall to only allow access from authorized networks.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Firewall.\n\n    Under the \\\"Firewall\\\" section, click \\\"Edit\\\".\n\n    For each enabled service, click \\\"Firewall\\\" and review the allowed IPs.\n\n    Check this for incoming and outgoing connections.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-VMHostFirewallException | Where {$_.Enabled -eq $true} |\nSelect\nName,Enabled,@{N=\\\"AllIPEnabled\\\";E={$_.ExtensionData.AllowedHosts.AllIP}}\n\n    If for an enabled service \\\"Allow connections from any IP address\\\" is\nselected, this is a finding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Firewall.\n\n    Under the \\\"Firewall\\\" section, click \\\"Edit\\\".\n\n    For each enabled service, uncheck the check box to “Allow connections from\nany IP address” and input the site-specific network(s) required.\n\n    Configure this for incoming and outgoing connections.\n\n    The following example formats are acceptable:\n\n    192.168.0.0/24\n    192.168.1.2, 2001::1/64\n    fd3e:29a6:0a81:e478::/64\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    $esxcli = Get-EsxCli -v2\n    #This disables the allow all rule for the target service. We are targeting\nthe sshServer service in this example.\n    $arguments = $esxcli.network.firewall.ruleset.set.CreateArgs()\n    $arguments.rulesetid = \\\"sshServer\\\"\n    $arguments.allowedall = $false\n    $esxcli.network.firewall.ruleset.set.Invoke($arguments)\n\n    #Next add the allowed IPs for the service. Note doing the \\\"vSphere Web\nClient\\\" service this way may disable access but may be done through vCenter or\nthrough the console.\n    $arguments = $esxcli.network.firewall.ruleset.allowedip.add.CreateArgs()\n    $arguments.rulesetid = \\\"sshServer\\\"\n    $arguments.ipaddress = \\\"10.0.0.0/8\\\"\n    $esxcli.network.firewall.ruleset.allowedip.add.Invoke($arguments)\n\n    This must be done for each enabled service.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239310'\n  tag rid: 'SV-239310r674859_rule'\n  tag stig_id: 'ESXI-67-000056'\n  tag fix_id: 'F-42502r674858_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')} | Get-VMHostFirewallException | Where {$_.Enabled -eq $true}).ExtensionData.AllowedHosts.AllIP\"\n  powercli_command(command).stdout.split(\"\\r\\n\").each do | result |\n    describe result do\n      it { should_not cmp \"True\" }\n    end\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000056.rb",
        "line": 1
      },
      "id": "ESXI-67-000056"
    },
    {
      "title": "The ESXi host must enable BPDU filter on the host to prevent being\nlocked out of physical switch ports with Portfast and BPDU Guard enabled.",
      "desc": "BPDU Guard and Portfast are commonly enabled on the physical switch to\nwhich the ESXi host is directly connected to reduce the STP convergence delay.\n\n    If a BPDU packet is sent from a virtual machine on the ESXi host to the\nphysical switch so configured, a cascading lockout of all the uplink interfaces\nfrom the ESXi host can occur. To prevent this type of lockout, BPDU Filter can\nbe enabled on the ESXi host to drop any BPDU packets being sent to the physical\nswitch.\n\n    The caveat is that certain SSL VPNs that use Windows bridging capability\ncan legitimately generate BPDU packets. The administrator should verify that\nthere are no legitimate BPDU packets generated by virtual machines on the ESXi\nhost prior to enabling BPDU Filter. If BPDU Filter is enabled in this\nsituation, enabling Reject Forged Transmits on the virtual switch port group\nadds protection against Spanning Tree loops.",
      "descriptions": {
        "default": "BPDU Guard and Portfast are commonly enabled on the physical switch to\nwhich the ESXi host is directly connected to reduce the STP convergence delay.\n\n    If a BPDU packet is sent from a virtual machine on the ESXi host to the\nphysical switch so configured, a cascading lockout of all the uplink interfaces\nfrom the ESXi host can occur. To prevent this type of lockout, BPDU Filter can\nbe enabled on the ESXi host to drop any BPDU packets being sent to the physical\nswitch.\n\n    The caveat is that certain SSL VPNs that use Windows bridging capability\ncan legitimately generate BPDU packets. The administrator should verify that\nthere are no legitimate BPDU packets generated by virtual machines on the ESXi\nhost prior to enabling BPDU Filter. If BPDU Filter is enabled in this\nsituation, enabling Reject Forged Transmits on the virtual switch port group\nadds protection against Spanning Tree loops.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \"Net.BlockGuestBPDU\" value and verify it is set to \"1\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Net.BlockGuestBPDU\n\n    If the \"Net.BlockGuestBPDU\" setting is not set to \"1\", this is a\nfinding.",
        "fix": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \"Edit\", select the \"Net.BlockGuestBPDU\" value, and configure it\nto \"1\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VMHost | Get-AdvancedSetting -Name Net.BlockGuestBPDU |\nSet-AdvancedSetting -Value 1"
      },
      "impact": 0.3,
      "refs": [],
      "tags": {
        "severity": "low",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239312",
        "rid": "SV-239312r674865_rule",
        "stig_id": "ESXI-67-000058",
        "fix_id": "F-42504r674864_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000058\" do\n  title \"The ESXi host must enable BPDU filter on the host to prevent being\nlocked out of physical switch ports with Portfast and BPDU Guard enabled.\"\n  desc  \"BPDU Guard and Portfast are commonly enabled on the physical switch to\nwhich the ESXi host is directly connected to reduce the STP convergence delay.\n\n    If a BPDU packet is sent from a virtual machine on the ESXi host to the\nphysical switch so configured, a cascading lockout of all the uplink interfaces\nfrom the ESXi host can occur. To prevent this type of lockout, BPDU Filter can\nbe enabled on the ESXi host to drop any BPDU packets being sent to the physical\nswitch.\n\n    The caveat is that certain SSL VPNs that use Windows bridging capability\ncan legitimately generate BPDU packets. The administrator should verify that\nthere are no legitimate BPDU packets generated by virtual machines on the ESXi\nhost prior to enabling BPDU Filter. If BPDU Filter is enabled in this\nsituation, enabling Reject Forged Transmits on the virtual switch port group\nadds protection against Spanning Tree loops.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \\\"Net.BlockGuestBPDU\\\" value and verify it is set to \\\"1\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Net.BlockGuestBPDU\n\n    If the \\\"Net.BlockGuestBPDU\\\" setting is not set to \\\"1\\\", this is a\nfinding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \\\"Edit\\\", select the \\\"Net.BlockGuestBPDU\\\" value, and configure it\nto \\\"1\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VMHost | Get-AdvancedSetting -Name Net.BlockGuestBPDU |\nSet-AdvancedSetting -Value 1\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239312'\n  tag rid: 'SV-239312r674865_rule'\n  tag stig_id: 'ESXI-67-000058'\n  tag fix_id: 'F-42504r674864_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-AdvancedSetting -Name Net.BlockGuestBPDU | Select-Object -ExpandProperty Value\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp \"1\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000058.rb",
        "line": 1
      },
      "id": "ESXI-67-000058"
    },
    {
      "title": "The ESXi host SSH daemon must not permit GSSAPI authentication.",
      "desc": "GSSAPI authentication is used to provide additional authentication\nmechanisms to applications. Allowing GSSAPI authentication through SSH exposes\nthe system’s GSSAPI to remote hosts, increasing the attack surface of the\nsystem.",
      "descriptions": {
        "default": "GSSAPI authentication is used to provide additional authentication\nmechanisms to applications. Allowing GSSAPI authentication through SSH exposes\nthe system’s GSSAPI to remote hosts, increasing the attack surface of the\nsystem.",
        "rationale": "",
        "check": "From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \"^GSSAPIAuthentication\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \"GSSAPIAuthentication\nno\", this is a finding.",
        "fix": "From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \"/etc/ssh/sshd_config\":\n\n    GSSAPIAuthentication no"
      },
      "impact": 0.3,
      "refs": [],
      "tags": {
        "severity": "low",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239273",
        "rid": "SV-239273r674748_rule",
        "stig_id": "ESXI-67-000018",
        "fix_id": "F-42465r674747_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000018\" do\n  title 'The ESXi host SSH daemon must not permit GSSAPI authentication.'\n  desc  \"GSSAPI authentication is used to provide additional authentication\nmechanisms to applications. Allowing GSSAPI authentication through SSH exposes\nthe system’s GSSAPI to remote hosts, increasing the attack surface of the\nsystem.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \\\"^GSSAPIAuthentication\\\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \\\"GSSAPIAuthentication\nno\\\", this is a finding.\n  \"\n  desc  'fix', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    GSSAPIAuthentication no\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239273'\n  tag rid: 'SV-239273r674748_rule'\n  tag stig_id: 'ESXI-67-000018'\n  tag fix_id: 'F-42465r674747_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"$vmhost = Get-VMHost -Name #{input('vmhostName')}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.software.vib.list.Invoke() | Where {$_.Name -eq '#{input('dodStigVibRootEnabled')}' -or $_.Name -eq '#{input('dodStigVibRootDisabled')}'}\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should_not cmp \"\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000018.rb",
        "line": 1
      },
      "id": "ESXI-67-000018"
    },
    {
      "title": "The ESXi host must enforce the unlock timeout of 15 minutes after a\nuser account is locked out.",
      "desc": "By enforcing a reasonable unlock timeout after multiple failed logon\nattempts, the risk of unauthorized access via user password guessing, otherwise\nknown as brute forcing, is reduced. Users must wait for the timeout period to\nelapse before subsequent logon attempts are allowed.",
      "descriptions": {
        "default": "By enforcing a reasonable unlock timeout after multiple failed logon\nattempts, the risk of unauthorized access via user password guessing, otherwise\nknown as brute forcing, is reduced. Users must wait for the timeout period to\nelapse before subsequent logon attempts are allowed.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \"Security.AccountUnlockTime\" value and verify it is set to\n\"900\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.AccountUnlockTime\n\n    If the \"Security.AccountUnlockTime\" is set to a value other than \"900\",\nthis is a finding.",
        "fix": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \"Edit\" and select the \"Security.AccountUnlockTime\" value and\nconfigure it to \"900\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.AccountUnlockTime |\nSet-AdvancedSetting -Value 900"
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000329-VMM-001180",
        "gid": "V-239263",
        "rid": "SV-239263r674718_rule",
        "stig_id": "ESXI-67-000006",
        "fix_id": "F-42455r674717_fix",
        "cci": [
          "CCI-002238"
        ],
        "nist": [
          "AC-7 b"
        ]
      },
      "code": "control \"ESXI-67-000006\" do\n  title \"The ESXi host must enforce the unlock timeout of 15 minutes after a\nuser account is locked out.\"\n  desc  \"By enforcing a reasonable unlock timeout after multiple failed logon\nattempts, the risk of unauthorized access via user password guessing, otherwise\nknown as brute forcing, is reduced. Users must wait for the timeout period to\nelapse before subsequent logon attempts are allowed.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \\\"Security.AccountUnlockTime\\\" value and verify it is set to\n\\\"900\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.AccountUnlockTime\n\n    If the \\\"Security.AccountUnlockTime\\\" is set to a value other than \\\"900\\\",\nthis is a finding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \\\"Edit\\\" and select the \\\"Security.AccountUnlockTime\\\" value and\nconfigure it to \\\"900\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.AccountUnlockTime |\nSet-AdvancedSetting -Value 900\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000329-VMM-001180'\n  tag gid: 'V-239263'\n  tag rid: 'SV-239263r674718_rule'\n  tag stig_id: 'ESXI-67-000006'\n  tag fix_id: 'F-42455r674717_fix'\n  tag cci: ['CCI-002238']\n  tag nist: ['AC-7 b']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-AdvancedSetting -Name Security.AccountUnlockTime | Select-Object -ExpandProperty Value\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp \"900\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000006.rb",
        "line": 1
      },
      "id": "ESXI-67-000006"
    },
    {
      "title": "The ESXi host must use DoD-approved certificates.",
      "desc": "The default self-signed, VMware Certificate Authority-issued host\ncertificate must be replaced with a DoD-approved certificate when the host will\nbe accessed directly, such as during a VM console connection.\n\n    The use of a DoD certificate on the host assures clients that the service\nthey are connecting to is legitimate and properly secured.",
      "descriptions": {
        "default": "The default self-signed, VMware Certificate Authority-issued host\ncertificate must be replaced with a DoD-approved certificate when the host will\nbe accessed directly, such as during a VM console connection.\n\n    The use of a DoD certificate on the host assures clients that the service\nthey are connecting to is legitimate and properly secured.",
        "rationale": "",
        "check": "From the vSphere Web Client, select the host and click Configure >> System\n>> Certificate.\n\n    If the issuer is not a DoD-approved certificate authority, this is a\nfinding.\n\n    If the host will never be accessed directly (VM console connections bypass\nvCenter), this is not a finding.",
        "fix": "Obtain a DoD-issued certificate and private key for the host following the\nrequirements below:\n\n    Key size: 2048 bits or more (PEM encoded)\n\n    Key format: PEM; VMware supports PKCS8 and PKCS1 (RSA keys)\n    x509 version 3\n\n    SubjectAltName must contain DNS Name=<machine_FQDN>\n\n    CRT (Base-64) format\n\n    Contains the following Key Usages: Digital Signature, Non Repudiation, Key\nEncipherment\n\n    Start time of one day before the current time.\n\n    CN (and SubjectAltName) set to the host name (or IP address) that the ESXi\nhost has in the vCenter Server inventory.\n\n    Put the host into maintenance mode.\n\n    Temporarily enable SSH on the host. SCP the new certificate and key to\n/tmp. SSH to the host. Back up the existing certificate and key:\n\n    mv /etc/vmware/ssl/rui.crt /etc/vmware/ssl/rui.crt.bak\n    mv /etc/vmware/ssl/rui.key /etc/vmware/ssl/rui.key.bak\n\n    Copy the new certificate and key to /etc/vmware/ssl/ and rename them to\nrui.crt and rui.key respectively. Restart management agents to implement the\nnew certificate:\n\n    services.sh restart\n\n    From the vSphere Web Client, select the vCenter Server and click Configure\n>> System >> Advanced Settings.\n\n    Find the \"vpxd.certmgmt value\" and set it to \"custom\"."
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239328",
        "rid": "SV-239328r674913_rule",
        "stig_id": "ESXI-67-000078",
        "fix_id": "F-42520r674912_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000078\" do\n  title 'The ESXi host must use DoD-approved certificates.'\n  desc  \"The default self-signed, VMware Certificate Authority-issued host\ncertificate must be replaced with a DoD-approved certificate when the host will\nbe accessed directly, such as during a VM console connection.\n\n    The use of a DoD certificate on the host assures clients that the service\nthey are connecting to is legitimate and properly secured.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Web Client, select the host and click Configure >> System\n>> Certificate.\n\n    If the issuer is not a DoD-approved certificate authority, this is a\nfinding.\n\n    If the host will never be accessed directly (VM console connections bypass\nvCenter), this is not a finding.\n  \"\n  desc  'fix', \"\n    Obtain a DoD-issued certificate and private key for the host following the\nrequirements below:\n\n    Key size: 2048 bits or more (PEM encoded)\n\n    Key format: PEM; VMware supports PKCS8 and PKCS1 (RSA keys)\n    x509 version 3\n\n    SubjectAltName must contain DNS Name=<machine_FQDN>\n\n    CRT (Base-64) format\n\n    Contains the following Key Usages: Digital Signature, Non Repudiation, Key\nEncipherment\n\n    Start time of one day before the current time.\n\n    CN (and SubjectAltName) set to the host name (or IP address) that the ESXi\nhost has in the vCenter Server inventory.\n\n    Put the host into maintenance mode.\n\n    Temporarily enable SSH on the host. SCP the new certificate and key to\n/tmp. SSH to the host. Back up the existing certificate and key:\n\n    mv /etc/vmware/ssl/rui.crt /etc/vmware/ssl/rui.crt.bak\n    mv /etc/vmware/ssl/rui.key /etc/vmware/ssl/rui.key.bak\n\n    Copy the new certificate and key to /etc/vmware/ssl/ and rename them to\nrui.crt and rui.key respectively. Restart management agents to implement the\nnew certificate:\n\n    services.sh restart\n\n    From the vSphere Web Client, select the vCenter Server and click Configure\n>> System >> Advanced Settings.\n\n    Find the \\\"vpxd.certmgmt value\\\" and set it to \\\"custom\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239328'\n  tag rid: 'SV-239328r674913_rule'\n  tag stig_id: 'ESXI-67-000078'\n  tag fix_id: 'F-42520r674912_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe ssl_certificate(host: \"#{input('vmhostName')}\", port: 443) do\n    its('issuer') { should match \"O=U.S. Government\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000078.rb",
        "line": 1
      },
      "id": "ESXI-67-000078"
    },
    {
      "title": "The ESXi host must use multifactor authentication for local DCUI\naccess to privileged accounts.",
      "desc": "To ensure accountability and prevent unauthenticated access,\nprivileged users must utilize multifactor authentication to prevent potential\nmisuse and compromise of the system.\n\n    Note: This feature requires an existing PKI and AD integration.",
      "descriptions": {
        "default": "To ensure accountability and prevent unauthenticated access,\nprivileged users must utilize multifactor authentication to prevent potential\nmisuse and compromise of the system.\n\n    Note: This feature requires an existing PKI and AD integration.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi Host and go to Configure >> System\n>> Authentication Services and view the Smart Card Authentication status.\n\n    If \"Smart Card Mode\" is \"Disabled\", this is a finding.\n\n    For environments that do have PKI or AD available, this is Not Applicable.",
        "fix": "The following are prerequisites to configuration of smart card\nauthentication for the ESXi DCUI:\n\n    - Active Directory domain that supports smart card authentication, smart\ncard readers, and smart cards;\n    - ESXi joined to an Active Directory domain; and\n    - Trusted certificates for root and intermediary certificate authorities.\n\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Authentication Services, click \"Edit\", and check the \"Enable Smart Card\nAuthentication\" checkbox.\n\n    At the \"Certificates\" tab, click the green plus sign to import trusted\ncertificate authority certificates and click \"OK\"."
      },
      "impact": 0.3,
      "refs": [],
      "tags": {
        "severity": "low",
        "gtitle": "SRG-OS-000107-VMM-000530",
        "satisfies": [
          "SRG-OS-000107-VMM-000530",
          "SRG-OS-000376-VMM-001520",
          "SRG-OS-000377-VMM-001530",
          "SRG-OS-000403-VMM-001640"
        ],
        "gid": "V-239295",
        "rid": "SV-239295r674814_rule",
        "stig_id": "ESXI-67-000040",
        "fix_id": "F-42487r674813_fix",
        "cci": [
          "CCI-000767",
          "CCI-001953",
          "CCI-001954",
          "CCI-002470"
        ],
        "nist": [
          "IA-2 (3)",
          "IA-2 (12)",
          "IA-2 (12)",
          "SC-23 (5)"
        ]
      },
      "code": "control \"ESXI-67-000040\" do\n  title \"The ESXi host must use multifactor authentication for local DCUI\naccess to privileged accounts.\"\n  desc  \"To ensure accountability and prevent unauthenticated access,\nprivileged users must utilize multifactor authentication to prevent potential\nmisuse and compromise of the system.\n\n    Note: This feature requires an existing PKI and AD integration.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi Host and go to Configure >> System\n>> Authentication Services and view the Smart Card Authentication status.\n\n    If \\\"Smart Card Mode\\\" is \\\"Disabled\\\", this is a finding.\n\n    For environments that do have PKI or AD available, this is Not Applicable.\n  \"\n  desc  'fix', \"\n    The following are prerequisites to configuration of smart card\nauthentication for the ESXi DCUI:\n\n    - Active Directory domain that supports smart card authentication, smart\ncard readers, and smart cards;\n    - ESXi joined to an Active Directory domain; and\n    - Trusted certificates for root and intermediary certificate authorities.\n\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Authentication Services, click \\\"Edit\\\", and check the \\\"Enable Smart Card\nAuthentication\\\" checkbox.\n\n    At the \\\"Certificates\\\" tab, click the green plus sign to import trusted\ncertificate authority certificates and click \\\"OK\\\".\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000107-VMM-000530'\n  tag satisfies: ['SRG-OS-000107-VMM-000530', 'SRG-OS-000376-VMM-001520',\n'SRG-OS-000377-VMM-001530', 'SRG-OS-000403-VMM-001640']\n  tag gid: 'V-239295'\n  tag rid: 'SV-239295r674814_rule'\n  tag stig_id: 'ESXI-67-000040'\n  tag fix_id: 'F-42487r674813_fix'\n  tag cci: ['CCI-000767', 'CCI-001953', 'CCI-001954', 'CCI-002470']\n  tag nist: ['IA-2 (3)', 'IA-2 (12)', 'IA-2 (12)', 'SC-23 (5)']\n\n  describe \"This check is a manual or policy based check\" do\n    skip \"This must be reviewed manually\"\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000040.rb",
        "line": 1
      },
      "id": "ESXI-67-000040"
    },
    {
      "title": "The ESXi host SSH daemon must ignore .rhosts files.",
      "desc": "SSH trust relationships mean a compromise on one host can allow an\nattacker to move trivially to other hosts. SSH can emulate the behavior of the\nobsolete rsh command in allowing users to enable insecure access to their\naccounts via \".rhosts\" files.",
      "descriptions": {
        "default": "SSH trust relationships mean a compromise on one host can allow an\nattacker to move trivially to other hosts. SSH can emulate the behavior of the\nobsolete rsh command in allowing users to enable insecure access to their\naccounts via \".rhosts\" files.",
        "rationale": "",
        "check": "From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \"^IgnoreRhosts\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \"IgnoreRhosts yes\",\nthis is a finding.",
        "fix": "From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \"/etc/ssh/sshd_config\":\n\n    Add or correct the following line in \"/etc/ssh/sshd_config\":\n\n    IgnoreRhosts yes"
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000107-VMM-000530",
        "gid": "V-239268",
        "rid": "SV-239268r674733_rule",
        "stig_id": "ESXI-67-000012",
        "fix_id": "F-42460r674732_fix",
        "cci": [
          "CCI-000767"
        ],
        "nist": [
          "IA-2 (3)"
        ]
      },
      "code": "control \"ESXI-67-000012\" do\n  title 'The ESXi host SSH daemon must ignore .rhosts files.'\n  desc  \"SSH trust relationships mean a compromise on one host can allow an\nattacker to move trivially to other hosts. SSH can emulate the behavior of the\nobsolete rsh command in allowing users to enable insecure access to their\naccounts via \\\".rhosts\\\" files.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \\\"^IgnoreRhosts\\\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \\\"IgnoreRhosts yes\\\",\nthis is a finding.\n  \"\n  desc  'fix', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    Add or correct the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    IgnoreRhosts yes\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000107-VMM-000530'\n  tag gid: 'V-239268'\n  tag rid: 'SV-239268r674733_rule'\n  tag stig_id: 'ESXI-67-000012'\n  tag fix_id: 'F-42460r674732_fix'\n  tag cci: ['CCI-000767']\n  tag nist: ['IA-2 (3)']\n\n  command = \"$vmhost = Get-VMHost -Name #{input('vmhostName')}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.software.vib.list.Invoke() | Where {$_.Name -eq '#{input('dodStigVibRootEnabled')}' -or $_.Name -eq '#{input('dodStigVibRootDisabled')}'}\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should_not cmp \"\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000012.rb",
        "line": 1
      },
      "id": "ESXI-67-000012"
    },
    {
      "title": "The ESXi host must verify the exception users list for Lockdown Mode.",
      "desc": "In vSphere, users can be added to the Exception Users list from the\nvSphere Web Client. These users do not lose their permissions when the host\nenters Lockdown Mode.\n\n    Before adding service accounts such as a backup agent to the Exception\nUsers list, verify that the list of users who are exempted from losing\npermissions is legitimate and as needed per the environment. Users who do not\nrequire special permissions should not be exempted from Lockdown Mode.",
      "descriptions": {
        "default": "In vSphere, users can be added to the Exception Users list from the\nvSphere Web Client. These users do not lose their permissions when the host\nenters Lockdown Mode.\n\n    Before adding service accounts such as a backup agent to the Exception\nUsers list, verify that the list of users who are exempted from losing\npermissions is legitimate and as needed per the environment. Users who do not\nrequire special permissions should not be exempted from Lockdown Mode.",
        "rationale": "",
        "check": "For environments that do not use vCenter server to manage ESXi, this is Not\nApplicable.\n\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Security Profile.\n\n    Under Lockdown Mode, review the Exception Users list.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing script:\n\n    $vmhost = Get-VMHost | Get-View\n    $lockdown = Get-View $vmhost.ConfigManager.HostAccessManager\n    $lockdown.QueryLockdownExceptions()\n\n    If the Exception Users list contains accounts that do not require special\npermissions, this is a finding.\n\n    Note: This list is not intended for system administrator accounts but for\nspecial circumstances such as a service account.",
        "fix": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Security Profile.\n\n    Under \"Lockdown Mode\", click \"Edit\" and remove unnecessary users from\nthe exceptions list."
      },
      "impact": 0.3,
      "refs": [],
      "tags": {
        "severity": "low",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239260",
        "rid": "SV-239260r674709_rule",
        "stig_id": "ESXI-67-000003",
        "fix_id": "F-42452r674708_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000003\" do\n  title 'The ESXi host must verify the exception users list for Lockdown Mode.'\n  desc  \"In vSphere, users can be added to the Exception Users list from the\nvSphere Web Client. These users do not lose their permissions when the host\nenters Lockdown Mode.\n\n    Before adding service accounts such as a backup agent to the Exception\nUsers list, verify that the list of users who are exempted from losing\npermissions is legitimate and as needed per the environment. Users who do not\nrequire special permissions should not be exempted from Lockdown Mode.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For environments that do not use vCenter server to manage ESXi, this is Not\nApplicable.\n\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Security Profile.\n\n    Under Lockdown Mode, review the Exception Users list.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing script:\n\n    $vmhost = Get-VMHost | Get-View\n    $lockdown = Get-View $vmhost.ConfigManager.HostAccessManager\n    $lockdown.QueryLockdownExceptions()\n\n    If the Exception Users list contains accounts that do not require special\npermissions, this is a finding.\n\n    Note: This list is not intended for system administrator accounts but for\nspecial circumstances such as a service account.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Security Profile.\n\n    Under \\\"Lockdown Mode\\\", click \\\"Edit\\\" and remove unnecessary users from\nthe exceptions list.\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239260'\n  tag rid: 'SV-239260r674709_rule'\n  tag stig_id: 'ESXI-67-000003'\n  tag fix_id: 'F-42452r674708_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"$vmhost = Get-VMHost -Name #{input('vmhostName')} | Get-View; (Get-View $vmhost.ConfigManager.HostAccessManager).QueryLockdownExceptions()\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp \"#{input('exceptionUsers')}\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000003.rb",
        "line": 1
      },
      "id": "ESXI-67-000003"
    },
    {
      "title": "The ESXi host must enable Secure Boot.",
      "desc": "Secure Boot is a protocol of UEFI firmware that ensures the integrity\nof the boot process from hardware up through to the OS. Secure Boot for ESXi\nrequires support from the firmware and requires that all ESXi kernel modules,\ndrivers, and vSphere Installation Bundles (VIBs) be signed by VMware or a\npartner subordinate.",
      "descriptions": {
        "default": "Secure Boot is a protocol of UEFI firmware that ensures the integrity\nof the boot process from hardware up through to the OS. Secure Boot for ESXi\nrequires support from the firmware and requires that all ESXi kernel modules,\ndrivers, and vSphere Installation Bundles (VIBs) be signed by VMware or a\npartner subordinate.",
        "rationale": "",
        "check": "Temporarily enable SSH, connect to the ESXi host, and run the following\ncommand:\n\n    /usr/lib/vmware/secureboot/bin/secureBoot.py -s\n\n    If the output is not \"Enabled\", this is a finding.",
        "fix": "Temporarily enable SSH, connect to the ESXi host, and run the following\ncommand:\n\n    /usr/lib/vmware/secureboot/bin/secureBoot.py -c\n\n    If the output indicates that Secure Boot cannot be enabled, correct the\ndiscrepancies and try again. If the discrepancies cannot be rectified, this\nfinding is downgraded to a CAT III.\n\n    Consult vendor documentation and boot the host into BIOS setup mode. Enable\nUEFI boot mode and Secure Boot. Restart the host.\n\n    Temporarily enable SSH, connect to the ESXi host, and run the following\ncommand to verify that Secure Boot is enabled:\n\n    /usr/lib/vmware/secureboot/bin/secureBoot.py -s"
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239327",
        "rid": "SV-239327r674910_rule",
        "stig_id": "ESXI-67-000076",
        "fix_id": "F-42519r674909_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000076\" do\n  title 'The ESXi host must enable Secure Boot.'\n  desc  \"Secure Boot is a protocol of UEFI firmware that ensures the integrity\nof the boot process from hardware up through to the OS. Secure Boot for ESXi\nrequires support from the firmware and requires that all ESXi kernel modules,\ndrivers, and vSphere Installation Bundles (VIBs) be signed by VMware or a\npartner subordinate.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    Temporarily enable SSH, connect to the ESXi host, and run the following\ncommand:\n\n    /usr/lib/vmware/secureboot/bin/secureBoot.py -s\n\n    If the output is not \\\"Enabled\\\", this is a finding.\n  \"\n  desc  'fix', \"\n    Temporarily enable SSH, connect to the ESXi host, and run the following\ncommand:\n\n    /usr/lib/vmware/secureboot/bin/secureBoot.py -c\n\n    If the output indicates that Secure Boot cannot be enabled, correct the\ndiscrepancies and try again. If the discrepancies cannot be rectified, this\nfinding is downgraded to a CAT III.\n\n    Consult vendor documentation and boot the host into BIOS setup mode. Enable\nUEFI boot mode and Secure Boot. Restart the host.\n\n    Temporarily enable SSH, connect to the ESXi host, and run the following\ncommand to verify that Secure Boot is enabled:\n\n    /usr/lib/vmware/secureboot/bin/secureBoot.py -s\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239327'\n  tag rid: 'SV-239327r674910_rule'\n  tag stig_id: 'ESXI-67-000076'\n  tag fix_id: 'F-42519r674909_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe \"This check is a manual or policy based check\" do\n    skip \"This must be reviewed manually\"\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000076.rb",
        "line": 1
      },
      "id": "ESXI-67-000076"
    },
    {
      "title": "The ESXi host must protect the confidentiality and integrity of\ntransmitted information by isolating vMotion traffic.",
      "desc": "While encrypted vMotion is available now, vMotion traffic should still\nbe sequestered from other traffic to further protect it from attack. This\nnetwork must be only be accessible to other ESXi hosts preventing outside\naccess to the network.",
      "descriptions": {
        "default": "While encrypted vMotion is available now, vMotion traffic should still\nbe sequestered from other traffic to further protect it from attack. This\nnetwork must be only be accessible to other ESXi hosts preventing outside\naccess to the network.",
        "rationale": "",
        "check": "Verify the vMotion VMKernel port group is in a dedicated VLAN, which can be\non a common standard or distributed virtual switch as long as the vMotion VLAN\nis not shared by any other function and is not routed to anything but ESXi\nhosts.\n\n    For environments that do not use vCenter server to manage ESXi, this is Not\nApplicable.\n\n    The check for this will be unique per environment.\n\n    From the vSphere Client, select the ESXi host and go to Configuration >>\nNetworking.\n\n    Review the VLAN associated with the vMotion VMkernel(s) and verify it is\ndedicated for that purpose and logically separated from other functions.\n\n    If long distance or cross-vCenter vMotion is used, the vMotion network can\nbe routable but must be accessible to only the intended ESXi hosts.\n\n    If the vMotion port group is not on an isolated VLAN and/or is routable to\nsystems other than ESXi hosts, this is a finding.",
        "fix": "Configuration of the vMotion VMkernel will be unique to each environment.\n\n    As an example, to modify the IP address and VLAN information to the correct\nnetwork on a distributed switch, do the following:\n\n    From the vSphere Client, go to Networking >> Select a distributed switch >>\nSelect a port group >> Configure >> Settings >> Edit >> VLAN.\n\n    Change the \"VLAN Type\" to \"VLAN\" and change the \"VLAN ID\" to a\nnetwork allocated and dedicated to vMotion traffic exclusively."
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000423-VMM-001700",
        "gid": "V-239303",
        "rid": "SV-239303r674838_rule",
        "stig_id": "ESXI-67-000048",
        "fix_id": "F-42495r674837_fix",
        "cci": [
          "CCI-002418"
        ],
        "nist": [
          "SC-8"
        ]
      },
      "code": "control \"ESXI-67-000048\" do\n  title \"The ESXi host must protect the confidentiality and integrity of\ntransmitted information by isolating vMotion traffic.\"\n  desc  \"While encrypted vMotion is available now, vMotion traffic should still\nbe sequestered from other traffic to further protect it from attack. This\nnetwork must be only be accessible to other ESXi hosts preventing outside\naccess to the network.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    Verify the vMotion VMKernel port group is in a dedicated VLAN, which can be\non a common standard or distributed virtual switch as long as the vMotion VLAN\nis not shared by any other function and is not routed to anything but ESXi\nhosts.\n\n    For environments that do not use vCenter server to manage ESXi, this is Not\nApplicable.\n\n    The check for this will be unique per environment.\n\n    From the vSphere Client, select the ESXi host and go to Configuration >>\nNetworking.\n\n    Review the VLAN associated with the vMotion VMkernel(s) and verify it is\ndedicated for that purpose and logically separated from other functions.\n\n    If long distance or cross-vCenter vMotion is used, the vMotion network can\nbe routable but must be accessible to only the intended ESXi hosts.\n\n    If the vMotion port group is not on an isolated VLAN and/or is routable to\nsystems other than ESXi hosts, this is a finding.\n  \"\n  desc  'fix', \"\n    Configuration of the vMotion VMkernel will be unique to each environment.\n\n    As an example, to modify the IP address and VLAN information to the correct\nnetwork on a distributed switch, do the following:\n\n    From the vSphere Client, go to Networking >> Select a distributed switch >>\nSelect a port group >> Configure >> Settings >> Edit >> VLAN.\n\n    Change the \\\"VLAN Type\\\" to \\\"VLAN\\\" and change the \\\"VLAN ID\\\" to a\nnetwork allocated and dedicated to vMotion traffic exclusively.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000423-VMM-001700'\n  tag gid: 'V-239303'\n  tag rid: 'SV-239303r674838_rule'\n  tag stig_id: 'ESXI-67-000048'\n  tag fix_id: 'F-42495r674837_fix'\n  tag cci: ['CCI-002418']\n  tag nist: ['SC-8']\n\n  describe \"This check is a manual or policy based check\" do\n    skip \"This must be reviewed manually\"\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000048.rb",
        "line": 1
      },
      "id": "ESXI-67-000048"
    },
    {
      "title": "All ESXi host-connected virtual switch VLANs must be fully documented\nand have only the required VLANs.",
      "desc": "When defining a physical switch port for trunk mode, only specified\nVLANs must be configured on the VLAN trunk link. The risk with not fully\ndocumenting all VLANs on the vSwitch is that it is possible that a physical\ntrunk port might be configured without needed VLANs, or with unneeded VLANs.\nThis could enable an administrator to either accidentally or maliciously\nconnect a VM to an unauthorized VLAN.",
      "descriptions": {
        "default": "When defining a physical switch port for trunk mode, only specified\nVLANs must be configured on the VLAN trunk link. The risk with not fully\ndocumenting all VLANs on the vSwitch is that it is possible that a physical\ntrunk port might be configured without needed VLANs, or with unneeded VLANs.\nThis could enable an administrator to either accidentally or maliciously\nconnect a VM to an unauthorized VLAN.",
        "rationale": "",
        "check": "Note that this check refers to an entity outside the physical scope of the\nESXi server system. The configuration of upstream physical switches must be\ndocumented to ensure that unneeded VLANs are configured for all physical ports\nconnected to ESXi hosts.\n\n    Inspect the documentation and verify that the documentation is updated\naccording to an organization-defined frequency and/or whenever modifications\nare made to either ESXi hosts or the upstream physical switches.\n\n    Alternatively, log in to the physical switch and verify that only needed\nVLANs are configured for all physical ports connected to ESXi hosts.\n\n    If the physical switch's configuration is trunked VLANs that are not used\nby ESXi for all physical ports connected to ESXi hosts, this is a finding.",
        "fix": "Note that this check refers to an entity outside the scope of the ESXi\nserver system.\n\n    Remove any VLANs trunked across physical ports connected to ESXi hosts that\nare not in use."
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239322",
        "rid": "SV-239322r674895_rule",
        "stig_id": "ESXI-67-000068",
        "fix_id": "F-42514r674894_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000068\" do\n  title \"All ESXi host-connected virtual switch VLANs must be fully documented\nand have only the required VLANs.\"\n  desc  \"When defining a physical switch port for trunk mode, only specified\nVLANs must be configured on the VLAN trunk link. The risk with not fully\ndocumenting all VLANs on the vSwitch is that it is possible that a physical\ntrunk port might be configured without needed VLANs, or with unneeded VLANs.\nThis could enable an administrator to either accidentally or maliciously\nconnect a VM to an unauthorized VLAN.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    Note that this check refers to an entity outside the physical scope of the\nESXi server system. The configuration of upstream physical switches must be\ndocumented to ensure that unneeded VLANs are configured for all physical ports\nconnected to ESXi hosts.\n\n    Inspect the documentation and verify that the documentation is updated\naccording to an organization-defined frequency and/or whenever modifications\nare made to either ESXi hosts or the upstream physical switches.\n\n    Alternatively, log in to the physical switch and verify that only needed\nVLANs are configured for all physical ports connected to ESXi hosts.\n\n    If the physical switch's configuration is trunked VLANs that are not used\nby ESXi for all physical ports connected to ESXi hosts, this is a finding.\n  \"\n  desc  'fix', \"\n    Note that this check refers to an entity outside the scope of the ESXi\nserver system.\n\n    Remove any VLANs trunked across physical ports connected to ESXi hosts that\nare not in use.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239322'\n  tag rid: 'SV-239322r674895_rule'\n  tag stig_id: 'ESXI-67-000068'\n  tag fix_id: 'F-42514r674894_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe \"This check is a manual or policy based check\" do\n    skip \"This must be reviewed manually\"\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000068.rb",
        "line": 1
      },
      "id": "ESXI-67-000068"
    },
    {
      "title": "The ESXi host must not suppress warnings that the local or remote\nshell sessions are enabled.",
      "desc": "Warnings that local or remote shell sessions are enabled alert\nadministrators to activity that they may not be aware of and need to\ninvestigate.",
      "descriptions": {
        "default": "Warnings that local or remote shell sessions are enabled alert\nadministrators to activity that they may not be aware of and need to\ninvestigate.",
        "rationale": "",
        "check": "From the vSphere Web Client, select the host and click Configure >> System\n>> Advanced System Settings.\n\n    Find the \"UserVars.SuppressShellWarning\" value and verify that it is set\nto the following:\n\n    0\n\n    If the value is not set as above or does not exist, this is a finding.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.SuppressShellWarning\n\n    If the value returned is not \"0\" or the setting does not exist, this is a\nfinding.",
        "fix": "From the vSphere Web Client, select the host and click Configure >> System\n>> Advanced System Settings.\n\n    Find the \"UserVars.SuppressShellWarning\" value and set it to the\nfollowing:\n\n    0\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.SuppressShellWarning |\nSet-AdvancedSetting -Value \"0\""
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239329",
        "rid": "SV-239329r674916_rule",
        "stig_id": "ESXI-67-000079",
        "fix_id": "F-42521r674915_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000079\" do\n  title \"The ESXi host must not suppress warnings that the local or remote\nshell sessions are enabled.\"\n  desc  \"Warnings that local or remote shell sessions are enabled alert\nadministrators to activity that they may not be aware of and need to\ninvestigate.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Web Client, select the host and click Configure >> System\n>> Advanced System Settings.\n\n    Find the \\\"UserVars.SuppressShellWarning\\\" value and verify that it is set\nto the following:\n\n    0\n\n    If the value is not set as above or does not exist, this is a finding.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.SuppressShellWarning\n\n    If the value returned is not \\\"0\\\" or the setting does not exist, this is a\nfinding.\n  \"\n  desc  'fix', \"\n    From the vSphere Web Client, select the host and click Configure >> System\n>> Advanced System Settings.\n\n    Find the \\\"UserVars.SuppressShellWarning\\\" value and set it to the\nfollowing:\n\n    0\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.SuppressShellWarning |\nSet-AdvancedSetting -Value \\\"0\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239329'\n  tag rid: 'SV-239329r674916_rule'\n  tag stig_id: 'ESXI-67-000079'\n  tag fix_id: 'F-42521r674915_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-AdvancedSetting -Name UserVars.SuppressShellWarning | Select-Object -ExpandProperty Value\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp \"0\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000079.rb",
        "line": 1
      },
      "id": "ESXI-67-000079"
    },
    {
      "title": "The ESXi host SSH daemon must not permit tunnels.",
      "desc": "OpenSSH has the ability to create network tunnels (layer 2 and layer\n3) over an SSH connection. This function can provide similar convenience to a\nVirtual Private Network (VPN) with the similar risk of providing a path to\ncircumvent firewalls and network Access Control Lists (ACLs).",
      "descriptions": {
        "default": "OpenSSH has the ability to create network tunnels (layer 2 and layer\n3) over an SSH connection. This function can provide similar convenience to a\nVirtual Private Network (VPN) with the similar risk of providing a path to\ncircumvent firewalls and network Access Control Lists (ACLs).",
        "rationale": "",
        "check": "From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \"^PermitTunnel\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \"PermitTunnel no\",\nthis is a finding.",
        "fix": "From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \"/etc/ssh/sshd_config\":\n\n    PermitTunnel no"
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239280",
        "rid": "SV-239280r674769_rule",
        "stig_id": "ESXI-67-000025",
        "fix_id": "F-42472r674768_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000025\" do\n  title 'The ESXi host SSH daemon must not permit tunnels.'\n  desc  \"OpenSSH has the ability to create network tunnels (layer 2 and layer\n3) over an SSH connection. This function can provide similar convenience to a\nVirtual Private Network (VPN) with the similar risk of providing a path to\ncircumvent firewalls and network Access Control Lists (ACLs).\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \\\"^PermitTunnel\\\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \\\"PermitTunnel no\\\",\nthis is a finding.\n  \"\n  desc  'fix', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    PermitTunnel no\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239280'\n  tag rid: 'SV-239280r674769_rule'\n  tag stig_id: 'ESXI-67-000025'\n  tag fix_id: 'F-42472r674768_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"$vmhost = Get-VMHost -Name #{input('vmhostName')}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.software.vib.list.Invoke() | Where {$_.Name -eq '#{input('dodStigVibRootEnabled')}' -or $_.Name -eq '#{input('dodStigVibRootDisabled')}'}\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should_not cmp \"\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000025.rb",
        "line": 1
      },
      "id": "ESXI-67-000025"
    },
    {
      "title": "The ESXi host SSH daemon must use DoD-approved encryption to protect\nthe confidentiality of remote access sessions.",
      "desc": "Approved algorithms should impart some level of confidence in their\nimplementation. Limit the ciphers to algorithms that are FIPS approved. Counter\n(CTR) mode is also preferred over cipher-block chaining (CBC) mode.",
      "descriptions": {
        "default": "Approved algorithms should impart some level of confidence in their\nimplementation. Limit the ciphers to algorithms that are FIPS approved. Counter\n(CTR) mode is also preferred over cipher-block chaining (CBC) mode.",
        "rationale": "",
        "check": "To verify that only FIPS-approved ciphers are in use, run the following\ncommand from an SSH session connected to the ESXi host, or from the ESXi shell:\n\n    # grep -i \"^FipsMode\" /etc/ssh/sshd_config\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    $esxcli = Get-EsxCli -v2\n    $esxcli.system.security.fips140.ssh.get.invoke()\n\n    If there is no output or the output is not exactly \"FipsMode yes\" over\nSSH, or enabled is not \"true\" over PowerCLI, this is a finding.",
        "fix": "Limit the ciphers to FIPS-approved algorithms.\n\n    From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \"/etc/ssh/sshd_config\":\n\n    FipsMode yes\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    $esxcli = Get-EsxCli -v2\n    $arguments = $esxcli.system.security.fips140.ssh.set.CreateArgs()\n    $arguments.enable = $true\n    $esxcli.system.security.fips140.ssh.set.Invoke($arguments)"
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000033-VMM-000140",
        "gid": "V-239267",
        "rid": "SV-239267r674730_rule",
        "stig_id": "ESXI-67-000010",
        "fix_id": "F-42459r674729_fix",
        "cci": [
          "CCI-000068"
        ],
        "nist": [
          "AC-17 (2)"
        ]
      },
      "code": "control \"ESXI-67-000010\" do\n  title \"The ESXi host SSH daemon must use DoD-approved encryption to protect\nthe confidentiality of remote access sessions.\"\n  desc  \"Approved algorithms should impart some level of confidence in their\nimplementation. Limit the ciphers to algorithms that are FIPS approved. Counter\n(CTR) mode is also preferred over cipher-block chaining (CBC) mode.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    To verify that only FIPS-approved ciphers are in use, run the following\ncommand from an SSH session connected to the ESXi host, or from the ESXi shell:\n\n    # grep -i \\\"^FipsMode\\\" /etc/ssh/sshd_config\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    $esxcli = Get-EsxCli -v2\n    $esxcli.system.security.fips140.ssh.get.invoke()\n\n    If there is no output or the output is not exactly \\\"FipsMode yes\\\" over\nSSH, or enabled is not \\\"true\\\" over PowerCLI, this is a finding.\n  \"\n  desc  'fix', \"\n    Limit the ciphers to FIPS-approved algorithms.\n\n    From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    FipsMode yes\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    $esxcli = Get-EsxCli -v2\n    $arguments = $esxcli.system.security.fips140.ssh.set.CreateArgs()\n    $arguments.enable = $true\n    $esxcli.system.security.fips140.ssh.set.Invoke($arguments)\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000033-VMM-000140'\n  tag gid: 'V-239267'\n  tag rid: 'SV-239267r674730_rule'\n  tag stig_id: 'ESXI-67-000010'\n  tag fix_id: 'F-42459r674729_fix'\n  tag cci: ['CCI-000068']\n  tag nist: ['AC-17 (2)']\n\n  command = \"$vmhost = Get-VMHost -Name #{input('vmhostName')}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.security.fips140.ssh.get.invoke() | Select-Object -ExpandProperty Enabled\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp \"true\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000010.rb",
        "line": 1
      },
      "id": "ESXI-67-000010"
    },
    {
      "title": "The ESXi host must display the Standard Mandatory DoD Notice and\nConsent Banner before granting access to the system via the DCUI.",
      "desc": "Failure to display the DoD logon banner prior to a logon attempt will\nnegate legal proceedings resulting from unauthorized access to system resources.",
      "descriptions": {
        "default": "Failure to display the DoD logon banner prior to a logon attempt will\nnegate legal proceedings resulting from unauthorized access to system resources.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \"Annotations.WelcomeMessage\" value and verify it contains the\nDoD logon banner to follow.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Annotations.WelcomeMessage\n\n    Check for either of the following logon banners based on the character\nlimitations imposed by the system. An exact match of the text is required. If\none of these banners is not displayed, this is a finding.\n\n    You are accessing a U.S. Government (USG) Information System (IS) that is\nprovided for USG-authorized use only.\n\n    By using this IS (which includes any device attached to this IS), you\nconsent to the following conditions:\n\n    -The USG routinely intercepts and monitors communications on this IS for\npurposes including, but not limited to, penetration testing, COMSEC monitoring,\nnetwork operations and defense, personnel misconduct (PM), law enforcement\n(LE), and counterintelligence (CI) investigations.\n\n    -At any time, the USG may inspect and seize data stored on this IS.\n\n    -Communications using, or data stored on, this IS are not private, are\nsubject to routine monitoring, interception, and search, and may be disclosed\nor used for any USG-authorized purpose.\n\n    -This IS includes security measures (e.g., authentication and access\ncontrols) to protect USG interests- -not for your personal benefit or privacy.\n\n    -Notwithstanding the above, using this IS does not constitute consent to\nPM, LE or CI investigative searching or monitoring of the content of privileged\ncommunications, or work product, related to personal representation or services\nby attorneys, psychotherapists, or clergy, and their assistants. Such\ncommunications and work product are private and confidential. See User\nAgreement for details.\n\n    OR\n\n    I've read & consent to terms in IS user agreem't.\n\n    If the DCUI logon screen does not display the DoD logon banner, this is a\nfinding.",
        "fix": "From a PowerCLI command prompt while connected to the ESXi host, copy the\nfollowing contents into a script(.ps1 file) and run to set the DCUI screen to\ndisplay the DoD logon banner:\n\n    <script begin>\n\n    $value = @\"\n    {bgcolor:black} {/color}{align:left}{bgcolor:black}{color:yellow}{hostname}\n, {ip}{/color}{/bgcolor}{/align}\n    {bgcolor:black}\n{/color}{align:left}{bgcolor:black}{color:yellow}{esxproduct}\n{esxversion}{/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:black}{color:yellow}{memory}\nRAM{/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:black}{color:white}\n{/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}\n\n                               {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  You are\naccessing a U.S. Government (USG) Information System (IS) that is provided for\nUSG-authorized use only. By      {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  using\nthis IS (which includes any device attached to this IS), you consent to the\nfollowing conditions:                 {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}\n\n                               {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -\nThe USG routinely intercepts and monitors communications on this IS for\npurposes including, but not limited     {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}\nto, penetration testing, COMSEC monitoring, network operations and defense,\npersonnel misconduct (PM), law      {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}\nenforcement (LE), and counterintelligence (CI) investigations.\n                                {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}\n\n                               {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -\nAt any time, the USG may inspect and seize data stored on this IS.\n                                {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}\n\n                               {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -\nCommunications using, or data stored on, this IS are not private, are subject\nto routine monitoring,            {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}\ninterception, and search, and may be disclosed or used for any USG-authorized\npurpose.                          {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}\n\n                               {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -\nThis IS includes security measures (e.g., authentication and access controls)\nto protect USG interests--not     {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}\nfor your personal benefit or privacy.\n                                {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}\n\n                               {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -\nNotwithstanding the above, using this IS does not constitute consent to PM, LE\nor CI investigative searching    {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}\nor monitoring of the content of privileged communications, or work product,\nrelated to personal representation  {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}\nor services by attorneys, psychotherapists, or clergy, and their assistants.\nSuch communications and work       {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}\nproduct are private and confidential. See User Agreement for details.\n                                {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}\n\n                               {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{align:left}{bgcolor:dark-grey}{color:white}  <F2>\nAccept Conditions and Customize System / View Logs{/align}{align:right}<F12>\nAccept Conditions and Shut Down/Restart  {bgcolor:black}\n{/color}{/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    \"@\n\n    Get-VMHost | Get-AdvancedSetting -Name Annotations.WelcomeMessage |\nSet-AdvancedSetting -Value $value\n\n    <script end>"
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000023-VMM-000060",
        "satisfies": [
          "SRG-OS-000023-VMM-000060",
          "SRG-OS-000024-VMM-000070"
        ],
        "gid": "V-239264",
        "rid": "SV-239264r674721_rule",
        "stig_id": "ESXI-67-000007",
        "fix_id": "F-42456r674720_fix",
        "cci": [
          "CCI-000048",
          "CCI-000050"
        ],
        "nist": [
          "AC-8 a",
          "AC-8 b"
        ]
      },
      "code": "control \"ESXI-67-000007\" do\n  title \"The ESXi host must display the Standard Mandatory DoD Notice and\nConsent Banner before granting access to the system via the DCUI.\"\n  desc  \"Failure to display the DoD logon banner prior to a logon attempt will\nnegate legal proceedings resulting from unauthorized access to system resources.\n\n\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \\\"Annotations.WelcomeMessage\\\" value and verify it contains the\nDoD logon banner to follow.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Annotations.WelcomeMessage\n\n    Check for either of the following logon banners based on the character\nlimitations imposed by the system. An exact match of the text is required. If\none of these banners is not displayed, this is a finding.\n\n    You are accessing a U.S. Government (USG) Information System (IS) that is\nprovided for USG-authorized use only.\n\n    By using this IS (which includes any device attached to this IS), you\nconsent to the following conditions:\n\n    -The USG routinely intercepts and monitors communications on this IS for\npurposes including, but not limited to, penetration testing, COMSEC monitoring,\nnetwork operations and defense, personnel misconduct (PM), law enforcement\n(LE), and counterintelligence (CI) investigations.\n\n    -At any time, the USG may inspect and seize data stored on this IS.\n\n    -Communications using, or data stored on, this IS are not private, are\nsubject to routine monitoring, interception, and search, and may be disclosed\nor used for any USG-authorized purpose.\n\n    -This IS includes security measures (e.g., authentication and access\ncontrols) to protect USG interests- -not for your personal benefit or privacy.\n\n    -Notwithstanding the above, using this IS does not constitute consent to\nPM, LE or CI investigative searching or monitoring of the content of privileged\ncommunications, or work product, related to personal representation or services\nby attorneys, psychotherapists, or clergy, and their assistants. Such\ncommunications and work product are private and confidential. See User\nAgreement for details.\n\n    OR\n\n    I've read & consent to terms in IS user agreem't.\n\n    If the DCUI logon screen does not display the DoD logon banner, this is a\nfinding.\n  \"\n  desc  'fix', \"\n    From a PowerCLI command prompt while connected to the ESXi host, copy the\nfollowing contents into a script(.ps1 file) and run to set the DCUI screen to\ndisplay the DoD logon banner:\n\n    <script begin>\n\n    $value = @\\\"\n    {bgcolor:black} {/color}{align:left}{bgcolor:black}{color:yellow}{hostname}\n, {ip}{/color}{/bgcolor}{/align}\n    {bgcolor:black}\n{/color}{align:left}{bgcolor:black}{color:yellow}{esxproduct}\n{esxversion}{/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:black}{color:yellow}{memory}\nRAM{/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:black}{color:white}\n{/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}\n\n                               {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  You are\naccessing a U.S. Government (USG) Information System (IS) that is provided for\nUSG-authorized use only. By      {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  using\nthis IS (which includes any device attached to this IS), you consent to the\nfollowing conditions:                 {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}\n\n                               {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -\nThe USG routinely intercepts and monitors communications on this IS for\npurposes including, but not limited     {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}\nto, penetration testing, COMSEC monitoring, network operations and defense,\npersonnel misconduct (PM), law      {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}\nenforcement (LE), and counterintelligence (CI) investigations.\n                                {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}\n\n                               {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -\nAt any time, the USG may inspect and seize data stored on this IS.\n                                {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}\n\n                               {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -\nCommunications using, or data stored on, this IS are not private, are subject\nto routine monitoring,            {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}\ninterception, and search, and may be disclosed or used for any USG-authorized\npurpose.                          {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}\n\n                               {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -\nThis IS includes security measures (e.g., authentication and access controls)\nto protect USG interests--not     {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}\nfor your personal benefit or privacy.\n                                {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}\n\n                               {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -\nNotwithstanding the above, using this IS does not constitute consent to PM, LE\nor CI investigative searching    {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}\nor monitoring of the content of privileged communications, or work product,\nrelated to personal representation  {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}\nor services by attorneys, psychotherapists, or clergy, and their assistants.\nSuch communications and work       {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}\nproduct are private and confidential. See User Agreement for details.\n                                {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}\n\n                               {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    {bgcolor:black} {/color}{align:left}{bgcolor:dark-grey}{color:white}  <F2>\nAccept Conditions and Customize System / View Logs{/align}{align:right}<F12>\nAccept Conditions and Shut Down/Restart  {bgcolor:black}\n{/color}{/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}\n\n                      {/color}{/bgcolor}\n    \\\"@\n\n    Get-VMHost | Get-AdvancedSetting -Name Annotations.WelcomeMessage |\nSet-AdvancedSetting -Value $value\n\n    <script end>\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000023-VMM-000060'\n  tag satisfies: ['SRG-OS-000023-VMM-000060', 'SRG-OS-000024-VMM-000070']\n  tag gid: 'V-239264'\n  tag rid: 'SV-239264r674721_rule'\n  tag stig_id: 'ESXI-67-000007'\n  tag fix_id: 'F-42456r674720_fix'\n  tag cci: ['CCI-000048', 'CCI-000050']\n  tag nist: ['AC-8 a', 'AC-8 b']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-AdvancedSetting -Name Annotations.WelcomeMessage | Select-Object -ExpandProperty Value\"\n  \n  describe.one do\n    describe powercli_command(command) do\n      its('stdout.strip') { should match \"You are accessing a U.S. Government\" }\n    end\n    describe powercli_command(command) do\n    its('stdout.strip') { should match \"I've read & consent to terms in IS user agreem't\" }\n    end\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000007.rb",
        "line": 1
      },
      "id": "ESXI-67-000007"
    },
    {
      "title": "The ESXi host SSH daemon must be configured to not allow X11\nforwarding.",
      "desc": "X11 forwarding over SSH allows for the secure remote execution of\nX11-based applications. This feature can increase the attack surface of an SSH\nconnection.",
      "descriptions": {
        "default": "X11 forwarding over SSH allows for the secure remote execution of\nX11-based applications. This feature can increase the attack surface of an SSH\nconnection.",
        "rationale": "",
        "check": "From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \"^X11Forwarding\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \"X11Forwarding no\",\nthis is a finding.",
        "fix": "From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \"/etc/ssh/sshd_config\":\n\n    X11Forwarding no"
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239278",
        "rid": "SV-239278r674763_rule",
        "stig_id": "ESXI-67-000023",
        "fix_id": "F-42470r674762_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000023\" do\n  title \"The ESXi host SSH daemon must be configured to not allow X11\nforwarding.\"\n  desc  \"X11 forwarding over SSH allows for the secure remote execution of\nX11-based applications. This feature can increase the attack surface of an SSH\nconnection.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \\\"^X11Forwarding\\\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \\\"X11Forwarding no\\\",\nthis is a finding.\n  \"\n  desc  'fix', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    X11Forwarding no\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239278'\n  tag rid: 'SV-239278r674763_rule'\n  tag stig_id: 'ESXI-67-000023'\n  tag fix_id: 'F-42470r674762_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"$vmhost = Get-VMHost -Name #{input('vmhostName')}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.software.vib.list.Invoke() | Where {$_.Name -eq '#{input('dodStigVibRootEnabled')}' -or $_.Name -eq '#{input('dodStigVibRootDisabled')}'}\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should_not cmp \"\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000023.rb",
        "line": 1
      },
      "id": "ESXI-67-000023"
    },
    {
      "title": "The ESXi host SSH daemon must set a timeout interval on idle sessions.",
      "desc": "Automatically logging out idle users guards against compromises via\nhijacked administrative sessions.",
      "descriptions": {
        "default": "Automatically logging out idle users guards against compromises via\nhijacked administrative sessions.",
        "rationale": "",
        "check": "From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \"^ClientAliveInterval\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \"ClientAliveInterval\n200\", this is a finding.",
        "fix": "From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \"/etc/ssh/sshd_config\":\n\n    ClientAliveInterval 200"
      },
      "impact": 0.3,
      "refs": [],
      "tags": {
        "severity": "low",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239282",
        "rid": "SV-239282r674775_rule",
        "stig_id": "ESXI-67-000027",
        "fix_id": "F-42474r674774_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000027\" do\n  title 'The ESXi host SSH daemon must set a timeout interval on idle sessions.'\n  desc  \"Automatically logging out idle users guards against compromises via\nhijacked administrative sessions.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \\\"^ClientAliveInterval\\\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \\\"ClientAliveInterval\n200\\\", this is a finding.\n  \"\n  desc  'fix', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    ClientAliveInterval 200\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239282'\n  tag rid: 'SV-239282r674775_rule'\n  tag stig_id: 'ESXI-67-000027'\n  tag fix_id: 'F-42474r674774_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"$vmhost = Get-VMHost -Name #{input('vmhostName')}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.software.vib.list.Invoke() | Where {$_.Name -eq '#{input('dodStigVibRootEnabled')}' -or $_.Name -eq '#{input('dodStigVibRootDisabled')}'}\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should_not cmp \"\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000027.rb",
        "line": 1
      },
      "id": "ESXI-67-000027"
    },
    {
      "title": "The ESXi host SSH daemon must not accept environment variables from\nthe client.",
      "desc": "Environment variables can be used to change the behavior of remote\nsessions and should be limited. Locale environment variables specify the\nlanguage, character set, and other features modifying the operation of software\nto match the user's preferences.",
      "descriptions": {
        "default": "Environment variables can be used to change the behavior of remote\nsessions and should be limited. Locale environment variables specify the\nlanguage, character set, and other features modifying the operation of software\nto match the user's preferences.",
        "rationale": "",
        "check": "From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \"^AcceptEnv\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \"AcceptEnv\", this is a\nfinding.",
        "fix": "From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \"/etc/ssh/sshd_config\":\n\n    AcceptEnv"
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239279",
        "rid": "SV-239279r674766_rule",
        "stig_id": "ESXI-67-000024",
        "fix_id": "F-42471r674765_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000024\" do\n  title \"The ESXi host SSH daemon must not accept environment variables from\nthe client.\"\n  desc  \"Environment variables can be used to change the behavior of remote\nsessions and should be limited. Locale environment variables specify the\nlanguage, character set, and other features modifying the operation of software\nto match the user's preferences.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \\\"^AcceptEnv\\\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \\\"AcceptEnv\\\", this is a\nfinding.\n  \"\n  desc  'fix', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    AcceptEnv\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239279'\n  tag rid: 'SV-239279r674766_rule'\n  tag stig_id: 'ESXI-67-000024'\n  tag fix_id: 'F-42471r674765_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"$vmhost = Get-VMHost -Name #{input('vmhostName')}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.software.vib.list.Invoke() | Where {$_.Name -eq '#{input('dodStigVibRootEnabled')}' -or $_.Name -eq '#{input('dodStigVibRootDisabled')}'}\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should_not cmp \"\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000024.rb",
        "line": 1
      },
      "id": "ESXI-67-000024"
    },
    {
      "title": "The password hashes stored on the ESXi host must have been generated\nusing a FIPS 140-2 approved cryptographic hashing algorithm.",
      "desc": "Systems must employ cryptographic hashes for passwords using the SHA-2\nfamily of algorithms or FIPS 140-2 approved successors. The use of unapproved\nalgorithms may result in weak password hashes more vulnerable to compromise.",
      "descriptions": {
        "default": "Systems must employ cryptographic hashes for passwords using the SHA-2\nfamily of algorithms or FIPS 140-2 approved successors. The use of unapproved\nalgorithms may result in weak password hashes more vulnerable to compromise.",
        "rationale": "",
        "check": "From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \"^password\" /etc/pam.d/passwd | grep sufficient\n\n    If sha512 is not listed, this is a finding.",
        "fix": "From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in “/etc/pam.d/passwd”:\n\n    password sufficient /lib/security/$ISA/pam_unix.so use_authtok nullok\nshadow sha512 remember=5"
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239288",
        "rid": "SV-239288r674793_rule",
        "stig_id": "ESXI-67-000033",
        "fix_id": "F-42480r674792_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000033\" do\n  title \"The password hashes stored on the ESXi host must have been generated\nusing a FIPS 140-2 approved cryptographic hashing algorithm.\"\n  desc  \"Systems must employ cryptographic hashes for passwords using the SHA-2\nfamily of algorithms or FIPS 140-2 approved successors. The use of unapproved\nalgorithms may result in weak password hashes more vulnerable to compromise.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \\\"^password\\\" /etc/pam.d/passwd | grep sufficient\n\n    If sha512 is not listed, this is a finding.\n  \"\n  desc  'fix', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in “/etc/pam.d/passwd”:\n\n    password sufficient /lib/security/$ISA/pam_unix.so use_authtok nullok\nshadow sha512 remember=5\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239288'\n  tag rid: 'SV-239288r674793_rule'\n  tag stig_id: 'ESXI-67-000033'\n  tag fix_id: 'F-42480r674792_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"$vmhost = Get-VMHost -Name #{input('vmhostName')}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.software.vib.list.Invoke() | Where {$_.Name -eq '#{input('dodStigVibRootEnabled')}' -or $_.Name -eq '#{input('dodStigVibRootDisabled')}'}\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should_not cmp \"\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000033.rb",
        "line": 1
      },
      "id": "ESXI-67-000033"
    },
    {
      "title": "Access to the ESXi host must be limited by enabling Lockdown Mode.",
      "desc": "Enabling Lockdown Mode disables direct access to an ESXi host,\nrequiring the host to be managed remotely from vCenter Server. This is done to\nensure the roles and access controls implemented in vCenter are always enforced\nand users cannot bypass them by logging on to a host directly. By forcing all\ninteraction to occur through vCenter Server, the risk of someone inadvertently\nattaining elevated privileges or performing tasks that are not properly audited\nis greatly reduced.",
      "descriptions": {
        "default": "Enabling Lockdown Mode disables direct access to an ESXi host,\nrequiring the host to be managed remotely from vCenter Server. This is done to\nensure the roles and access controls implemented in vCenter are always enforced\nand users cannot bypass them by logging on to a host directly. By forcing all\ninteraction to occur through vCenter Server, the risk of someone inadvertently\nattaining elevated privileges or performing tasks that are not properly audited\nis greatly reduced.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Security Profile.\n\n    Scroll down to \"Lockdown Mode\" and verify it is enabled (\"Normal\" or\n\"Strict\").\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Select\nName,@{N=\"Lockdown\";E={$_.Extensiondata.Config.LockdownMode}}\n\n    If Lockdown Mode is disabled, this is a finding.\n\n    For environments that do not use vCenter server to manage ESXi, this is Not\nApplicable.",
        "fix": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Security Profile.\n\n    Click \"Edit\" in \"Lockdown Mode\" and enable (\"Normal\" or \"Strict\").\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    $level = \"lockdownNormal\" OR \"lockdownStrict\"\n    $vmhost = Get-VMHost -Name <hostname> | Get-View\n    $lockdown = Get-View $vmhost.ConfigManager.HostAccessManager\n    $lockdown.ChangeLockdownMode($level)\n\n    Note: In Strict Lockdown Mode, the DCUI service is stopped. If the\nconnection to vCenter Server is lost and the vSphere Client is no longer\navailable, the ESXi host becomes inaccessible."
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000027-VMM-000080",
        "satisfies": [
          "SRG-OS-000027-VMM-000080",
          "SRG-OS-000123-VMM-000620"
        ],
        "gid": "V-239258",
        "rid": "SV-239258r674703_rule",
        "stig_id": "ESXI-67-000001",
        "fix_id": "F-42450r674702_fix",
        "cci": [
          "CCI-000054",
          "CCI-001682"
        ],
        "nist": [
          "AC-10",
          "AC-2 (2)"
        ]
      },
      "code": "control \"ESXI-67-000001\" do\n  title 'Access to the ESXi host must be limited by enabling Lockdown Mode.'\n  desc  \"Enabling Lockdown Mode disables direct access to an ESXi host,\nrequiring the host to be managed remotely from vCenter Server. This is done to\nensure the roles and access controls implemented in vCenter are always enforced\nand users cannot bypass them by logging on to a host directly. By forcing all\ninteraction to occur through vCenter Server, the risk of someone inadvertently\nattaining elevated privileges or performing tasks that are not properly audited\nis greatly reduced.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Security Profile.\n\n    Scroll down to \\\"Lockdown Mode\\\" and verify it is enabled (\\\"Normal\\\" or\n\\\"Strict\\\").\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Select\nName,@{N=\\\"Lockdown\\\";E={$_.Extensiondata.Config.LockdownMode}}\n\n    If Lockdown Mode is disabled, this is a finding.\n\n    For environments that do not use vCenter server to manage ESXi, this is Not\nApplicable.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Security Profile.\n\n    Click \\\"Edit\\\" in \\\"Lockdown Mode\\\" and enable (\\\"Normal\\\" or \\\"Strict\\\").\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    $level = \\\"lockdownNormal\\\" OR \\\"lockdownStrict\\\"\n    $vmhost = Get-VMHost -Name <hostname> | Get-View\n    $lockdown = Get-View $vmhost.ConfigManager.HostAccessManager\n    $lockdown.ChangeLockdownMode($level)\n\n    Note: In Strict Lockdown Mode, the DCUI service is stopped. If the\nconnection to vCenter Server is lost and the vSphere Client is no longer\navailable, the ESXi host becomes inaccessible.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000027-VMM-000080'\n  tag satisfies: ['SRG-OS-000027-VMM-000080', 'SRG-OS-000123-VMM-000620']\n  tag gid: 'V-239258'\n  tag rid: 'SV-239258r674703_rule'\n  tag stig_id: 'ESXI-67-000001'\n  tag fix_id: 'F-42450r674702_fix'\n  tag cci: ['CCI-000054', 'CCI-001682']\n  tag nist: ['AC-10', 'AC-2 (2)']\n\n  list = [\"Normal\",\"Strict\"]\n  command = \"(Get-VMHost -Name #{input('vmhostName')}).Extensiondata.Config.LockdownMode\"\n  describe powercli_command(command) do\n    its ('stdout.strip') { should be_in list }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000001.rb",
        "line": 1
      },
      "id": "ESXI-67-000001"
    },
    {
      "title": "The ESXi host SSH daemon must not permit Kerberos authentication.",
      "desc": "Kerberos authentication for SSH is often implemented using GSSAPI. If\nKerberos is enabled through SSH, the SSH daemon provides a means of access to\nthe system's Kerberos implementation. Vulnerabilities in the system's Kerberos\nimplementation may then be subject to exploitation. To reduce the attack\nsurface of the system, the Kerberos authentication mechanism within SSH must be\ndisabled for systems.",
      "descriptions": {
        "default": "Kerberos authentication for SSH is often implemented using GSSAPI. If\nKerberos is enabled through SSH, the SSH daemon provides a means of access to\nthe system's Kerberos implementation. Vulnerabilities in the system's Kerberos\nimplementation may then be subject to exploitation. To reduce the attack\nsurface of the system, the Kerberos authentication mechanism within SSH must be\ndisabled for systems.",
        "rationale": "",
        "check": "From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \"^KerberosAuthentication\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \"KerberosAuthentication\nno\", this is a finding.",
        "fix": "From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \"/etc/ssh/sshd_config\":\n\n    KerberosAuthentication no"
      },
      "impact": 0.3,
      "refs": [],
      "tags": {
        "severity": "low",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239274",
        "rid": "SV-239274r674751_rule",
        "stig_id": "ESXI-67-000019",
        "fix_id": "F-42466r674750_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000019\" do\n  title 'The ESXi host SSH daemon must not permit Kerberos authentication.'\n  desc  \"Kerberos authentication for SSH is often implemented using GSSAPI. If\nKerberos is enabled through SSH, the SSH daemon provides a means of access to\nthe system's Kerberos implementation. Vulnerabilities in the system's Kerberos\nimplementation may then be subject to exploitation. To reduce the attack\nsurface of the system, the Kerberos authentication mechanism within SSH must be\ndisabled for systems.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \\\"^KerberosAuthentication\\\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \\\"KerberosAuthentication\nno\\\", this is a finding.\n  \"\n  desc  'fix', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    KerberosAuthentication no\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239274'\n  tag rid: 'SV-239274r674751_rule'\n  tag stig_id: 'ESXI-67-000019'\n  tag fix_id: 'F-42466r674750_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"$vmhost = Get-VMHost -Name #{input('vmhostName')}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.software.vib.list.Invoke() | Where {$_.Name -eq '#{input('dodStigVibRootEnabled')}' -or $_.Name -eq '#{input('dodStigVibRootDisabled')}'}\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should_not cmp \"\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000019.rb",
        "line": 1
      },
      "id": "ESXI-67-000019"
    },
    {
      "title": "The virtual switch MAC Address Change policy must be set to reject on\nthe ESXi host.",
      "desc": "If the virtual machine operating system changes the MAC address, it\ncan send frames with an impersonated source MAC address at any time. This\nallows it to stage malicious attacks on the devices in a network by\nimpersonating a network adaptor authorized by the receiving network.\n\n    This will prevent VMs from changing their effective MAC address. It will\naffect applications that require this functionality, how a layer 2 bridge will\noperate, and applications that require a specific MAC address for licensing.\nReject MAC Changes can be set at the vSwitch and/or the Portgroup level.\nSwitch-level settings can be overridden at the Portgroup level.",
      "descriptions": {
        "default": "If the virtual machine operating system changes the MAC address, it\ncan send frames with an impersonated source MAC address at any time. This\nallows it to stage malicious attacks on the devices in a network by\nimpersonating a network adaptor authorized by the receiving network.\n\n    This will prevent VMs from changing their effective MAC address. It will\naffect applications that require this functionality, how a layer 2 bridge will\noperate, and applications that require a specific MAC address for licensing.\nReject MAC Changes can be set at the vSwitch and/or the Portgroup level.\nSwitch-level settings can be overridden at the Portgroup level.",
        "rationale": "",
        "check": "From the vSphere Client, go to Configure >> Networking >> Virtual Switches.\n\n    View the properties on each virtual switch and port group and verify \"MAC\nAddress Changes\" is set to reject.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VirtualSwitch | Get-SecurityPolicy\n    Get-VirtualPortGroup | Get-SecurityPolicy\n\n    If the \"MAC Address Changes\" policy is set to accept (or true, via\nPowerCLI), this is a finding.",
        "fix": "From the vSphere Client, go to Configure >> Networking >> Virtual Switches.\n\n    For each virtual switch and port group, click Edit settings (dots) and\nchange \"MAC Address Changes\" to reject.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VirtualSwitch | Get-SecurityPolicy | Set-SecurityPolicy -MacChanges\n$false\n    Get-VirtualPortGroup | Get-SecurityPolicy | Set-SecurityPolicy\n-MacChangesInherited $true"
      },
      "impact": 0.7,
      "refs": [],
      "tags": {
        "severity": "high",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239314",
        "rid": "SV-239314r674871_rule",
        "stig_id": "ESXI-67-000060",
        "fix_id": "F-42506r674870_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000060\" do\n  title \"The virtual switch MAC Address Change policy must be set to reject on\nthe ESXi host.\"\n  desc  \"If the virtual machine operating system changes the MAC address, it\ncan send frames with an impersonated source MAC address at any time. This\nallows it to stage malicious attacks on the devices in a network by\nimpersonating a network adaptor authorized by the receiving network.\n\n    This will prevent VMs from changing their effective MAC address. It will\naffect applications that require this functionality, how a layer 2 bridge will\noperate, and applications that require a specific MAC address for licensing.\nReject MAC Changes can be set at the vSwitch and/or the Portgroup level.\nSwitch-level settings can be overridden at the Portgroup level.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Configure >> Networking >> Virtual Switches.\n\n    View the properties on each virtual switch and port group and verify \\\"MAC\nAddress Changes\\\" is set to reject.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VirtualSwitch | Get-SecurityPolicy\n    Get-VirtualPortGroup | Get-SecurityPolicy\n\n    If the \\\"MAC Address Changes\\\" policy is set to accept (or true, via\nPowerCLI), this is a finding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, go to Configure >> Networking >> Virtual Switches.\n\n    For each virtual switch and port group, click Edit settings (dots) and\nchange \\\"MAC Address Changes\\\" to reject.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VirtualSwitch | Get-SecurityPolicy | Set-SecurityPolicy -MacChanges\n$false\n    Get-VirtualPortGroup | Get-SecurityPolicy | Set-SecurityPolicy\n-MacChangesInherited $true\n  \"\n  impact 0.7\n  tag severity: 'high'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239314'\n  tag rid: 'SV-239314r674871_rule'\n  tag stig_id: 'ESXI-67-000060'\n  tag fix_id: 'F-42506r674870_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-VirtualSwitch | Get-SecurityPolicy | Select-Object -ExpandProperty MacChanges\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should_not match \"True\" }\n  end\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-VirtualPortGroup | Get-SecurityPolicy | Select-Object -ExpandProperty MacChanges\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should_not match \"True\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000060.rb",
        "line": 1
      },
      "id": "ESXI-67-000060"
    },
    {
      "title": "The ESXi host must be configured to disable nonessential capabilities\nby disabling SSH.",
      "desc": "The ESXi Shell is an interactive command line interface (CLI)\navailable at the ESXi server console. The ESXi shell provides temporary access\nto commands essential for server maintenance. Intended primarily for use in\nbreak-fix scenarios, the ESXi shell is well suited for checking and modifying\nconfiguration details, not always generally accessible, using the vSphere\nClient.\n\n    The ESXi shell is accessible remotely using SSH by users with the\nAdministrator role. Under normal operating conditions, SSH access to the host\nmust be disabled as is the default. As with the ESXi shell, SSH is also\nintended only for temporary use during break-fix scenarios. SSH must therefore\nbe disabled under normal operating conditions and must only be enabled for\ndiagnostics or troubleshooting. Remote access to the host must therefore be\nlimited to the vSphere Client or Host Client at all other times.",
      "descriptions": {
        "default": "The ESXi Shell is an interactive command line interface (CLI)\navailable at the ESXi server console. The ESXi shell provides temporary access\nto commands essential for server maintenance. Intended primarily for use in\nbreak-fix scenarios, the ESXi shell is well suited for checking and modifying\nconfiguration details, not always generally accessible, using the vSphere\nClient.\n\n    The ESXi shell is accessible remotely using SSH by users with the\nAdministrator role. Under normal operating conditions, SSH access to the host\nmust be disabled as is the default. As with the ESXi shell, SSH is also\nintended only for temporary use during break-fix scenarios. SSH must therefore\nbe disabled under normal operating conditions and must only be enabled for\ndiagnostics or troubleshooting. Remote access to the host must therefore be\nlimited to the vSphere Client or Host Client at all other times.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Services.\n\n    Under \"Services\", select \"Edit\", view the \"SSH\" service, and verify\nit is stopped.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \"SSH\"}\n\n    If the ESXi SSH service is running, this is a finding.",
        "fix": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Services.\n\n    Under \"Services\", select \"SSH\" service and click the \"Stop\" button to\nstop the service. Use Edit Startup policy to \"Start and stop manually\" and\nclick \"OK\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \"SSH\"} |\nSet-VMHostService -Policy Off\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \"SSH\"} |\nStop-VMHostService"
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000095-VMM-000480",
        "satisfies": [
          "SRG-OS-000095-VMM-000480",
          "SRG-OS-000297-VMM-001040",
          "SRG-OS-000298-VMM-001050"
        ],
        "gid": "V-239290",
        "rid": "SV-239290r674799_rule",
        "stig_id": "ESXI-67-000035",
        "fix_id": "F-42482r674798_fix",
        "cci": [
          "CCI-000381",
          "CCI-002314",
          "CCI-002322"
        ],
        "nist": [
          "CM-7 a",
          "AC-17 (1)",
          "AC-17 (9)"
        ]
      },
      "code": "control \"ESXI-67-000035\" do\n  title \"The ESXi host must be configured to disable nonessential capabilities\nby disabling SSH.\"\n  desc  \"The ESXi Shell is an interactive command line interface (CLI)\navailable at the ESXi server console. The ESXi shell provides temporary access\nto commands essential for server maintenance. Intended primarily for use in\nbreak-fix scenarios, the ESXi shell is well suited for checking and modifying\nconfiguration details, not always generally accessible, using the vSphere\nClient.\n\n    The ESXi shell is accessible remotely using SSH by users with the\nAdministrator role. Under normal operating conditions, SSH access to the host\nmust be disabled as is the default. As with the ESXi shell, SSH is also\nintended only for temporary use during break-fix scenarios. SSH must therefore\nbe disabled under normal operating conditions and must only be enabled for\ndiagnostics or troubleshooting. Remote access to the host must therefore be\nlimited to the vSphere Client or Host Client at all other times.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Services.\n\n    Under \\\"Services\\\", select \\\"Edit\\\", view the \\\"SSH\\\" service, and verify\nit is stopped.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"SSH\\\"}\n\n    If the ESXi SSH service is running, this is a finding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Services.\n\n    Under \\\"Services\\\", select \\\"SSH\\\" service and click the \\\"Stop\\\" button to\nstop the service. Use Edit Startup policy to \\\"Start and stop manually\\\" and\nclick \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"SSH\\\"} |\nSet-VMHostService -Policy Off\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"SSH\\\"} |\nStop-VMHostService\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000095-VMM-000480'\n  tag satisfies: ['SRG-OS-000095-VMM-000480', 'SRG-OS-000297-VMM-001040',\n'SRG-OS-000298-VMM-001050']\n  tag gid: 'V-239290'\n  tag rid: 'SV-239290r674799_rule'\n  tag stig_id: 'ESXI-67-000035'\n  tag fix_id: 'F-42482r674798_fix'\n  tag cci: ['CCI-000381', 'CCI-002314', 'CCI-002322']\n  tag nist: ['CM-7 a', 'AC-17 (1)', 'AC-17 (9)']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-VMHostService | Where {$_.Label -eq 'SSH'} | Select-Object -ExpandProperty Policy\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp \"off\" }\n  end\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-VMHostService | Where {$_.Label -eq 'SSH'} | Select-Object -ExpandProperty Running\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp \"false\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000035.rb",
        "line": 1
      },
      "id": "ESXI-67-000035"
    },
    {
      "title": "The ESXi host must enable kernel core dumps.",
      "desc": "In the event of a system failure, the system must preserve any\ninformation necessary to determine cause of failure and any information\nnecessary to return to operations with least disruption to mission processes.",
      "descriptions": {
        "default": "In the event of a system failure, the system must preserve any\ninformation necessary to determine cause of failure and any information\nnecessary to return to operations with least disruption to mission processes.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi host and right-click.\n\n    If the \"Add Diagnostic Partition\" option is greyed out, core dumps are\nconfigured.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    $esxcli = Get-EsxCli -v2\n    $esxcli.system.coredump.partition.get.Invoke()\n    $esxcli.system.coredump.network.get.Invoke()\n\n    The first command prepares for the other two. The second command shows\nwhether an active core dump partition is configured. The third command shows\nwhether a network core dump collector is configured and enabled via the\n\"HostVNic\", \"NetworkServerIP\", \"NetworkServerPort\", and \"Enabled\"\nvariables.\n\n    If there is no active core dump partition or the network core dump\ncollector is not configured and enabled, this is a finding.",
        "fix": "From the vSphere Client, select the ESXi host and right-click. Select the\n\"Add Diagnostic Partition\" option to configure a core dump diagnostic\npartition.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run at\nleast one of the following sets of commands:\n\n    To configure a core dump partition:\n\n    $esxcli = Get-EsxCli -v2\n    #View available partitions to configure\n    $esxcli.system.coredump.partition.list.Invoke()\n    $arguments = $esxcli.system.coredump.partition.set.CreateArgs()\n    $arguments.partition = \"<NAA ID of target partition from output listed\npreviously>\"\n    $esxcli.system.coredump.partition.set.Invoke($arguments)\n    #You can't set the partition and enable it at the same time so now we can\nenable it\n    $arguments = $esxcli.system.coredump.partition.set.CreateArgs()\n    $arguments.enable = $true\n    $esxcli.system.coredump.partition.set.Invoke($arguments)\n\n    To configure a core dump collector:\n\n    $esxcli = Get-EsxCli -v2\n    $arguments = $esxcli.system.coredump.network.set.CreateArgs()\n    $arguments.interfacename = \"<vmkernel port to use>\"\n    $arguments.serverip = \"<collector IP>\"\n    $arguments.serverport = \"<collector port>\"\n    $arguments = $esxcli.system.coredump.network.set.Invoke($arguments)\n    $arguments = $esxcli.system.coredump.network.set.CreateArgs()\n    $arguments.enable = $true\n    $arguments = $esxcli.system.coredump.network.set.Invoke($arguments)"
      },
      "impact": 0.3,
      "refs": [],
      "tags": {
        "severity": "low",
        "gtitle": "SRG-OS-000269-VMM-000950",
        "gid": "V-239299",
        "rid": "SV-239299r674826_rule",
        "stig_id": "ESXI-67-000044",
        "fix_id": "F-42491r674825_fix",
        "cci": [
          "CCI-001665"
        ],
        "nist": [
          "SC-24"
        ]
      },
      "code": "control \"ESXI-67-000044\" do\n  title 'The ESXi host must enable kernel core dumps.'\n  desc  \"In the event of a system failure, the system must preserve any\ninformation necessary to determine cause of failure and any information\nnecessary to return to operations with least disruption to mission processes.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi host and right-click.\n\n    If the \\\"Add Diagnostic Partition\\\" option is greyed out, core dumps are\nconfigured.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    $esxcli = Get-EsxCli -v2\n    $esxcli.system.coredump.partition.get.Invoke()\n    $esxcli.system.coredump.network.get.Invoke()\n\n    The first command prepares for the other two. The second command shows\nwhether an active core dump partition is configured. The third command shows\nwhether a network core dump collector is configured and enabled via the\n\\\"HostVNic\\\", \\\"NetworkServerIP\\\", \\\"NetworkServerPort\\\", and \\\"Enabled\\\"\nvariables.\n\n    If there is no active core dump partition or the network core dump\ncollector is not configured and enabled, this is a finding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi host and right-click. Select the\n\\\"Add Diagnostic Partition\\\" option to configure a core dump diagnostic\npartition.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run at\nleast one of the following sets of commands:\n\n    To configure a core dump partition:\n\n    $esxcli = Get-EsxCli -v2\n    #View available partitions to configure\n    $esxcli.system.coredump.partition.list.Invoke()\n    $arguments = $esxcli.system.coredump.partition.set.CreateArgs()\n    $arguments.partition = \\\"<NAA ID of target partition from output listed\npreviously>\\\"\n    $esxcli.system.coredump.partition.set.Invoke($arguments)\n    #You can't set the partition and enable it at the same time so now we can\nenable it\n    $arguments = $esxcli.system.coredump.partition.set.CreateArgs()\n    $arguments.enable = $true\n    $esxcli.system.coredump.partition.set.Invoke($arguments)\n\n    To configure a core dump collector:\n\n    $esxcli = Get-EsxCli -v2\n    $arguments = $esxcli.system.coredump.network.set.CreateArgs()\n    $arguments.interfacename = \\\"<vmkernel port to use>\\\"\n    $arguments.serverip = \\\"<collector IP>\\\"\n    $arguments.serverport = \\\"<collector port>\\\"\n    $arguments = $esxcli.system.coredump.network.set.Invoke($arguments)\n    $arguments = $esxcli.system.coredump.network.set.CreateArgs()\n    $arguments.enable = $true\n    $arguments = $esxcli.system.coredump.network.set.Invoke($arguments)\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000269-VMM-000950'\n  tag gid: 'V-239299'\n  tag rid: 'SV-239299r674826_rule'\n  tag stig_id: 'ESXI-67-000044'\n  tag fix_id: 'F-42491r674825_fix'\n  tag cci: ['CCI-001665']\n  tag nist: ['SC-24']\n  \n  describe.one do\n    \n    command = \"$vmhost = Get-VMHost -Name #{input('vmhostName')}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.coredump.partition.get.Invoke() | Select-Object -ExpandProperty Active\"\n    describe powercli_command(command) do\n      its('stdout.strip') { should_not cmp \"\" }\n    end\n    \n    command = \"$vmhost = Get-VMHost -Name #{input('vmhostName')}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.coredump.network.get.Invoke() | Select-Object -ExpandProperty Enabled\"\n    describe powercli_command(command) do\n      its('stdout.strip') { should cmp \"true\" }\n    end\n\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000044.rb",
        "line": 1
      },
      "id": "ESXI-67-000044"
    },
    {
      "title": "The ESXi Image Profile and vSphere Installation Bundle (VIB)\nAcceptance Levels must be verified.",
      "desc": "Verify the ESXi Image Profile to only allow signed VIBs. An unsigned\nVIB represents untested code installed on an ESXi host. The ESXi Image profile\nsupports four acceptance levels:\n\n    1. VMwareCertified - VIBs created, tested, and signed by VMware\n    2. VMwareAccepted - VIBs created by a VMware partner but tested and signed\nby VMware\n    3. PartnerSupported - VIBs created, tested, and signed by a certified\nVMware partner\n    4. CommunitySupported - VIBs that have not been tested by VMware or a\nVMware partner\n\n    CommunitySupported VIBs are not supported and do not have a digital\nsignature. To protect the security and integrity of ESXi hosts, do not allow\nunsigned (CommunitySupported) VIBs to be installed on hosts.",
      "descriptions": {
        "default": "Verify the ESXi Image Profile to only allow signed VIBs. An unsigned\nVIB represents untested code installed on an ESXi host. The ESXi Image profile\nsupports four acceptance levels:\n\n    1. VMwareCertified - VIBs created, tested, and signed by VMware\n    2. VMwareAccepted - VIBs created by a VMware partner but tested and signed\nby VMware\n    3. PartnerSupported - VIBs created, tested, and signed by a certified\nVMware partner\n    4. CommunitySupported - VIBs that have not been tested by VMware or a\nVMware partner\n\n    CommunitySupported VIBs are not supported and do not have a digital\nsignature. To protect the security and integrity of ESXi hosts, do not allow\nunsigned (CommunitySupported) VIBs to be installed on hosts.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Security Profile.\n\n    Under \"Host Image Profile Acceptance Level\", view the acceptance level.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    $esxcli = Get-EsxCli -v2\n    $esxcli.software.acceptance.get.Invoke()\n\n    If the acceptance level is \"CommunitySupported\", this is a finding.",
        "fix": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Security Profile.\n\n    Under \"Host Image Profile Acceptance Level\", click \"Edit\".\n\n    Using the pull-down selection, set the acceptance level to be\n\"VMwareCertified\", \"VMwareAccepted\", or \"PartnerSupported\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    $esxcli = Get-EsxCli -v2\n    $arguments = $esxcli.software.acceptance.set.CreateArgs()\n    $arguments.level = \"PartnerSupported\"\n    $esxcli.software.acceptance.set.Invoke($arguments)\n\n    Note: \"VMwareCertified\" or \"VMwareAccepted\" may be substituted for\n\"PartnerSupported\", depending on local requirements. These are also case\nsensitive."
      },
      "impact": 0.7,
      "refs": [],
      "tags": {
        "severity": "high",
        "gtitle": "SRG-OS-000366-VMM-001430",
        "satisfies": [
          "SRG-OS-000366-VMM-001430",
          "SRG-OS-000370-VMM-001460",
          "SRG-OS-000404-VMM-001650"
        ],
        "gid": "V-239302",
        "rid": "SV-239302r674835_rule",
        "stig_id": "ESXI-67-000047",
        "fix_id": "F-42494r674834_fix",
        "cci": [
          "CCI-001749",
          "CCI-001774",
          "CCI-002475"
        ],
        "nist": [
          "CM-5 (3)",
          "CM-7 (5) (b)",
          "SC-28 (1)"
        ]
      },
      "code": "control \"ESXI-67-000047\" do\n  title \"The ESXi Image Profile and vSphere Installation Bundle (VIB)\nAcceptance Levels must be verified.\"\n  desc  \"Verify the ESXi Image Profile to only allow signed VIBs. An unsigned\nVIB represents untested code installed on an ESXi host. The ESXi Image profile\nsupports four acceptance levels:\n\n    1. VMwareCertified - VIBs created, tested, and signed by VMware\n    2. VMwareAccepted - VIBs created by a VMware partner but tested and signed\nby VMware\n    3. PartnerSupported - VIBs created, tested, and signed by a certified\nVMware partner\n    4. CommunitySupported - VIBs that have not been tested by VMware or a\nVMware partner\n\n    CommunitySupported VIBs are not supported and do not have a digital\nsignature. To protect the security and integrity of ESXi hosts, do not allow\nunsigned (CommunitySupported) VIBs to be installed on hosts.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Security Profile.\n\n    Under \\\"Host Image Profile Acceptance Level\\\", view the acceptance level.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    $esxcli = Get-EsxCli -v2\n    $esxcli.software.acceptance.get.Invoke()\n\n    If the acceptance level is \\\"CommunitySupported\\\", this is a finding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Security Profile.\n\n    Under \\\"Host Image Profile Acceptance Level\\\", click \\\"Edit\\\".\n\n    Using the pull-down selection, set the acceptance level to be\n\\\"VMwareCertified\\\", \\\"VMwareAccepted\\\", or \\\"PartnerSupported\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    $esxcli = Get-EsxCli -v2\n    $arguments = $esxcli.software.acceptance.set.CreateArgs()\n    $arguments.level = \\\"PartnerSupported\\\"\n    $esxcli.software.acceptance.set.Invoke($arguments)\n\n    Note: \\\"VMwareCertified\\\" or \\\"VMwareAccepted\\\" may be substituted for\n\\\"PartnerSupported\\\", depending on local requirements. These are also case\nsensitive.\n  \"\n  impact 0.7\n  tag severity: 'high'\n  tag gtitle: 'SRG-OS-000366-VMM-001430'\n  tag satisfies: ['SRG-OS-000366-VMM-001430', 'SRG-OS-000370-VMM-001460',\n'SRG-OS-000404-VMM-001650']\n  tag gid: 'V-239302'\n  tag rid: 'SV-239302r674835_rule'\n  tag stig_id: 'ESXI-67-000047'\n  tag fix_id: 'F-42494r674834_fix'\n  tag cci: ['CCI-001749', 'CCI-001774', 'CCI-002475']\n  tag nist: ['CM-5 (3)', 'CM-7 (5) (b)', 'SC-28 (1)']\n\n  command = \"$vmhost = Get-VMHost -Name #{input('vmhostName')}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.software.acceptance.get.Invoke()\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should_not cmp \"CommunitySupported\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000047.rb",
        "line": 1
      },
      "id": "ESXI-67-000047"
    },
    {
      "title": "The ESXi host must enforce the limit of three consecutive invalid\nlogon attempts by a user.",
      "desc": "By limiting the number of failed logon attempts, the risk of\nunauthorized access via user password guessing, otherwise known as brute\nforcing, is reduced. Once the configured number of attempts is reached, the\naccount is locked by the ESXi host.",
      "descriptions": {
        "default": "By limiting the number of failed logon attempts, the risk of\nunauthorized access via user password guessing, otherwise known as brute\nforcing, is reduced. Once the configured number of attempts is reached, the\naccount is locked by the ESXi host.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \"Security.AccountLockFailures\" value and verify it is set to\n\"3\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.AccountLockFailures\n\n    If \"Security.AccountLockFailures\" is set to a value other than \"3\",\nthis is a finding.",
        "fix": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \"Edit\", select the \"Security.AccountLockFailures\" value, and\nconfigure it to \"3\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.AccountLockFailures |\nSet-AdvancedSetting -Value 3"
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000021-VMM-000050",
        "gid": "V-239262",
        "rid": "SV-239262r674715_rule",
        "stig_id": "ESXI-67-000005",
        "fix_id": "F-42454r674714_fix",
        "cci": [
          "CCI-000044"
        ],
        "nist": [
          "AC-7 a"
        ]
      },
      "code": "control \"ESXI-67-000005\" do\n  title \"The ESXi host must enforce the limit of three consecutive invalid\nlogon attempts by a user.\"\n  desc  \"By limiting the number of failed logon attempts, the risk of\nunauthorized access via user password guessing, otherwise known as brute\nforcing, is reduced. Once the configured number of attempts is reached, the\naccount is locked by the ESXi host.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \\\"Security.AccountLockFailures\\\" value and verify it is set to\n\\\"3\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.AccountLockFailures\n\n    If \\\"Security.AccountLockFailures\\\" is set to a value other than \\\"3\\\",\nthis is a finding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \\\"Edit\\\", select the \\\"Security.AccountLockFailures\\\" value, and\nconfigure it to \\\"3\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.AccountLockFailures |\nSet-AdvancedSetting -Value 3\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000021-VMM-000050'\n  tag gid: 'V-239262'\n  tag rid: 'SV-239262r674715_rule'\n  tag stig_id: 'ESXI-67-000005'\n  tag fix_id: 'F-42454r674714_fix'\n  tag cci: ['CCI-000044']\n  tag nist: ['AC-7 a']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-AdvancedSetting -Name Security.AccountLockFailures | Select-Object -ExpandProperty Value\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp \"3\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000005.rb",
        "line": 1
      },
      "id": "ESXI-67-000005"
    },
    {
      "title": "The ESXi host SSH daemon must perform strict mode checking of home\ndirectory configuration files.",
      "desc": "If other users have access to modify user-specific SSH configuration\nfiles, they may be able to log on to the system as another user.",
      "descriptions": {
        "default": "If other users have access to modify user-specific SSH configuration\nfiles, they may be able to log on to the system as another user.",
        "rationale": "",
        "check": "From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \"^StrictModes\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \"StrictModes yes\",\nthis is a finding.",
        "fix": "From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \"/etc/ssh/sshd_config\":\n\n    StrictModes yes"
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239275",
        "rid": "SV-239275r674754_rule",
        "stig_id": "ESXI-67-000020",
        "fix_id": "F-42467r674753_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000020\" do\n  title \"The ESXi host SSH daemon must perform strict mode checking of home\ndirectory configuration files.\"\n  desc  \"If other users have access to modify user-specific SSH configuration\nfiles, they may be able to log on to the system as another user.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \\\"^StrictModes\\\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \\\"StrictModes yes\\\",\nthis is a finding.\n  \"\n  desc  'fix', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    StrictModes yes\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239275'\n  tag rid: 'SV-239275r674754_rule'\n  tag stig_id: 'ESXI-67-000020'\n  tag fix_id: 'F-42467r674753_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"$vmhost = Get-VMHost -Name #{input('vmhostName')}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.software.vib.list.Invoke() | Where {$_.Name -eq '#{input('dodStigVibRootEnabled')}' -or $_.Name -eq '#{input('dodStigVibRootDisabled')}'}\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should_not cmp \"\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000020.rb",
        "line": 1
      },
      "id": "ESXI-67-000020"
    },
    {
      "title": "The ESXi host must disable ESXi Shell unless needed for diagnostics or\ntroubleshooting.",
      "desc": "The ESXi Shell is an interactive command line environment available\nlocally from the DCUI or remotely via SSH. Activities performed from the ESXi\nShell bypass vCenter RBAC and audit controls.\n\n    The ESXi shell should only be turned on when needed to troubleshoot/resolve\nproblems that cannot be fixed through the vSphere client.",
      "descriptions": {
        "default": "The ESXi Shell is an interactive command line environment available\nlocally from the DCUI or remotely via SSH. Activities performed from the ESXi\nShell bypass vCenter RBAC and audit controls.\n\n    The ESXi shell should only be turned on when needed to troubleshoot/resolve\nproblems that cannot be fixed through the vSphere client.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Services.\n\n    Under \"Services\", select \"Edit\", view the \"ESXi Shell\" service, and\nverify it is stopped.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \"ESXi Shell\"}\n\n    If the ESXi Shell service is running, this is a finding.",
        "fix": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Services.\n\n    Under \"Services\", select \"ESXi Shell\" service and click the \"Stop\"\nbutton to stop the service. Use Edit Startup policy to \"Start and stop\nmanually\" and click \"OK\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \"ESXi Shell\"} |\nSet-VMHostService -Policy Off\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \"ESXi Shell\"} |\nStop-VMHostService"
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000095-VMM-000480",
        "gid": "V-239291",
        "rid": "SV-239291r674802_rule",
        "stig_id": "ESXI-67-000036",
        "fix_id": "F-42483r674801_fix",
        "cci": [
          "CCI-000381"
        ],
        "nist": [
          "CM-7 a"
        ]
      },
      "code": "control \"ESXI-67-000036\" do\n  title \"The ESXi host must disable ESXi Shell unless needed for diagnostics or\ntroubleshooting.\"\n  desc  \"The ESXi Shell is an interactive command line environment available\nlocally from the DCUI or remotely via SSH. Activities performed from the ESXi\nShell bypass vCenter RBAC and audit controls.\n\n    The ESXi shell should only be turned on when needed to troubleshoot/resolve\nproblems that cannot be fixed through the vSphere client.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Services.\n\n    Under \\\"Services\\\", select \\\"Edit\\\", view the \\\"ESXi Shell\\\" service, and\nverify it is stopped.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"ESXi Shell\\\"}\n\n    If the ESXi Shell service is running, this is a finding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Services.\n\n    Under \\\"Services\\\", select \\\"ESXi Shell\\\" service and click the \\\"Stop\\\"\nbutton to stop the service. Use Edit Startup policy to \\\"Start and stop\nmanually\\\" and click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"ESXi Shell\\\"} |\nSet-VMHostService -Policy Off\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"ESXi Shell\\\"} |\nStop-VMHostService\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000095-VMM-000480'\n  tag gid: 'V-239291'\n  tag rid: 'SV-239291r674802_rule'\n  tag stig_id: 'ESXI-67-000036'\n  tag fix_id: 'F-42483r674801_fix'\n  tag cci: ['CCI-000381']\n  tag nist: ['CM-7 a']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-VMHostService | Where {$_.Label -eq 'ESXi Shell'} | Select-Object -ExpandProperty Policy\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp \"off\" }\n  end\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-VMHostService | Where {$_.Label -eq 'ESXi Shell'} | Select-Object -ExpandProperty Running\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp \"false\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000036.rb",
        "line": 1
      },
      "id": "ESXI-67-000036"
    },
    {
      "title": "The ESXi host must protect the confidentiality and integrity of\ntransmitted information by isolating IP-based storage traffic.",
      "desc": "Virtual machines might share virtual switches and VLANs with the\nIP-based storage configurations. IP-based storage includes vSAN, iSCSI, and\nNFS. This configuration might expose IP-based storage traffic to unauthorized\nvirtual machine users. IP-based storage frequently is not encrypted. It can be\nviewed by anyone with access to this network.\n\n    To restrict unauthorized users from viewing the IP-based storage traffic,\nthe IP-based storage network must be logically separated from the production\ntraffic. Configuring the IP-based storage adaptors on separate VLANs or network\nsegments from other VMkernels and virtual machines will limit unauthorized\nusers from viewing the traffic.",
      "descriptions": {
        "default": "Virtual machines might share virtual switches and VLANs with the\nIP-based storage configurations. IP-based storage includes vSAN, iSCSI, and\nNFS. This configuration might expose IP-based storage traffic to unauthorized\nvirtual machine users. IP-based storage frequently is not encrypted. It can be\nviewed by anyone with access to this network.\n\n    To restrict unauthorized users from viewing the IP-based storage traffic,\nthe IP-based storage network must be logically separated from the production\ntraffic. Configuring the IP-based storage adaptors on separate VLANs or network\nsegments from other VMkernels and virtual machines will limit unauthorized\nusers from viewing the traffic.",
        "rationale": "",
        "check": "If IP-based storage is not used, this is Not Applicable.\n\n    Verify that IP-based storage (iSCSI, NFS, vSAN) VMkernel port groups are in\na dedicated VLAN, which can be on a standard or distributed virtual switch that\nis logically separated from other traffic types. The check for this will be\nunique per environment.\n\n    From the vSphere Client, select the ESXi Host and go to Configure >>\nNetworking >> VMkernel adapters.\n\n    Review the VLANs associated with any IP-based storage VMkernels and verify\nit is dedicated for that purpose and logically separated from other functions.\n\n    If any IP-based storage networks are not isolated from other traffic types,\nthis is a finding.",
        "fix": "Configuration of an IP-Based VMkernel will be unique to each environment.\nHowever, as an example, to modify the IP address and VLAN information to the\ncorrect network on a standard switch for an iSCSI VMkernel, do the following:\n\n    vSAN Example:\n    From the vSphere Client, select the ESXi host and go to Configure >>\nNetworking >> VMkernel adapters.\n\n    Select the dedicated vSAN VMkernel adapter and click Edit settings.\n\n    On the Port properties tab, uncheck everything but \"vSAN.”\n\n    On the IP Settings tab, enter the appropriate IP address and subnet\ninformation and click \"OK\".\n\n    Set the appropriate VLAN ID by navigating to Configure >> Networking >>\nVirtual switches.\n\n    Select the appropriate portgroup (iSCSI, NFS, vSAN) and click Edit settings.\n\n    On the properties tab, enter the appropriate VLAN ID and click \"OK\"."
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000423-VMM-001700",
        "gid": "V-239305",
        "rid": "SV-239305r674844_rule",
        "stig_id": "ESXI-67-000050",
        "fix_id": "F-42497r674843_fix",
        "cci": [
          "CCI-002418"
        ],
        "nist": [
          "SC-8"
        ]
      },
      "code": "control \"ESXI-67-000050\" do\n  title \"The ESXi host must protect the confidentiality and integrity of\ntransmitted information by isolating IP-based storage traffic.\"\n  desc  \"Virtual machines might share virtual switches and VLANs with the\nIP-based storage configurations. IP-based storage includes vSAN, iSCSI, and\nNFS. This configuration might expose IP-based storage traffic to unauthorized\nvirtual machine users. IP-based storage frequently is not encrypted. It can be\nviewed by anyone with access to this network.\n\n    To restrict unauthorized users from viewing the IP-based storage traffic,\nthe IP-based storage network must be logically separated from the production\ntraffic. Configuring the IP-based storage adaptors on separate VLANs or network\nsegments from other VMkernels and virtual machines will limit unauthorized\nusers from viewing the traffic.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If IP-based storage is not used, this is Not Applicable.\n\n    Verify that IP-based storage (iSCSI, NFS, vSAN) VMkernel port groups are in\na dedicated VLAN, which can be on a standard or distributed virtual switch that\nis logically separated from other traffic types. The check for this will be\nunique per environment.\n\n    From the vSphere Client, select the ESXi Host and go to Configure >>\nNetworking >> VMkernel adapters.\n\n    Review the VLANs associated with any IP-based storage VMkernels and verify\nit is dedicated for that purpose and logically separated from other functions.\n\n    If any IP-based storage networks are not isolated from other traffic types,\nthis is a finding.\n  \"\n  desc  'fix', \"\n    Configuration of an IP-Based VMkernel will be unique to each environment.\nHowever, as an example, to modify the IP address and VLAN information to the\ncorrect network on a standard switch for an iSCSI VMkernel, do the following:\n\n    vSAN Example:\n    From the vSphere Client, select the ESXi host and go to Configure >>\nNetworking >> VMkernel adapters.\n\n    Select the dedicated vSAN VMkernel adapter and click Edit settings.\n\n    On the Port properties tab, uncheck everything but \\\"vSAN.”\n\n    On the IP Settings tab, enter the appropriate IP address and subnet\ninformation and click \\\"OK\\\".\n\n    Set the appropriate VLAN ID by navigating to Configure >> Networking >>\nVirtual switches.\n\n    Select the appropriate portgroup (iSCSI, NFS, vSAN) and click Edit settings.\n\n    On the properties tab, enter the appropriate VLAN ID and click \\\"OK\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000423-VMM-001700'\n  tag gid: 'V-239305'\n  tag rid: 'SV-239305r674844_rule'\n  tag stig_id: 'ESXI-67-000050'\n  tag fix_id: 'F-42497r674843_fix'\n  tag cci: ['CCI-002418']\n  tag nist: ['SC-8']\n\n  describe \"This check is a manual or policy based check\" do\n    skip \"This must be reviewed manually\"\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000050.rb",
        "line": 1
      },
      "id": "ESXI-67-000050"
    },
    {
      "title": "Remote logging for ESXi hosts must be configured.",
      "desc": "Remote logging to a central log host provides a secure, centralized\nstore for ESXi logs. By gathering host log files onto a central host, it can\nmore easily monitor all hosts with a single tool. It can also do aggregate\nanalysis and searching to look for such things as coordinated attacks on\nmultiple hosts. Logging to a secure, centralized log server also helps prevent\nlog tampering and also provides a long-term audit record.",
      "descriptions": {
        "default": "Remote logging to a central log host provides a secure, centralized\nstore for ESXi logs. By gathering host log files onto a central host, it can\nmore easily monitor all hosts with a single tool. It can also do aggregate\nanalysis and searching to look for such things as coordinated attacks on\nmultiple hosts. Logging to a secure, centralized log server also helps prevent\nlog tampering and also provides a long-term audit record.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \"Syslog.global.logHost\" value and verify it is set to a\nsite-specific syslog server hostname.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.logHost\n\n    If the \"Syslog.global.logHost\" setting is not set to a site-specific\nsyslog server, this is a finding.",
        "fix": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \"Edit\", select the \"Syslog.global.logHost\" value, and configure\nit to a site-specific syslog server.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.logHost |\nSet-AdvancedSetting -Value \"<syslog server hostname>\""
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000032-VMM-000130",
        "satisfies": [
          "SRG-OS-000032-VMM-000130",
          "SRG-OS-000342-VMM-001230",
          "SRG-OS-000479-VMM-001990"
        ],
        "gid": "V-239261",
        "rid": "SV-239261r674712_rule",
        "stig_id": "ESXI-67-000004",
        "fix_id": "F-42453r674711_fix",
        "cci": [
          "CCI-000067",
          "CCI-001851"
        ],
        "nist": [
          "AC-17 (1)",
          "AU-4 (1)"
        ]
      },
      "code": "control \"ESXI-67-000004\" do\n  title 'Remote logging for ESXi hosts must be configured.'\n  desc  \"Remote logging to a central log host provides a secure, centralized\nstore for ESXi logs. By gathering host log files onto a central host, it can\nmore easily monitor all hosts with a single tool. It can also do aggregate\nanalysis and searching to look for such things as coordinated attacks on\nmultiple hosts. Logging to a secure, centralized log server also helps prevent\nlog tampering and also provides a long-term audit record.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \\\"Syslog.global.logHost\\\" value and verify it is set to a\nsite-specific syslog server hostname.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.logHost\n\n    If the \\\"Syslog.global.logHost\\\" setting is not set to a site-specific\nsyslog server, this is a finding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \\\"Edit\\\", select the \\\"Syslog.global.logHost\\\" value, and configure\nit to a site-specific syslog server.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.logHost |\nSet-AdvancedSetting -Value \\\"<syslog server hostname>\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000032-VMM-000130'\n  tag satisfies: ['SRG-OS-000032-VMM-000130', 'SRG-OS-000342-VMM-001230',\n'SRG-OS-000479-VMM-001990']\n  tag gid: 'V-239261'\n  tag rid: 'SV-239261r674712_rule'\n  tag stig_id: 'ESXI-67-000004'\n  tag fix_id: 'F-42453r674711_fix'\n  tag cci: ['CCI-000067', 'CCI-001851']\n  tag nist: ['AC-17 (1)', 'AU-4 (1)']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-AdvancedSetting -Name Syslog.global.logHost | Select-Object -ExpandProperty Value\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp \"#{input('syslogServer')}\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000004.rb",
        "line": 1
      },
      "id": "ESXI-67-000004"
    },
    {
      "title": "For the ESXi host, all port groups must be configured to a value other\nthan that of the native VLAN.",
      "desc": "ESXi does not use the concept of native VLAN. Frames with VLAN\nspecified in the port group will have a tag, but frames with VLAN not specified\nin the port group are not tagged and therefore will end up as belonging to the\nnative VLAN of the physical switch.\n\n    For example, frames on VLAN 1 from a Cisco physical switch will be\nuntagged, because this is considered as the native VLAN. However, frames from\nESXi specified as VLAN 1 will be tagged with a \"1\"; therefore, traffic from\nESXi that is destined for the native VLAN will not be correctly routed (because\nit is tagged with a \"1\" instead of being untagged), and traffic from the\nphysical switch coming from the native VLAN will not be visible (because it is\nnot tagged).\n\n    If the ESXi virtual switch port group uses the native VLAN ID, traffic from\nthose VMs will not be visible to the native VLAN on the switch because the\nswitch is expecting untagged traffic.",
      "descriptions": {
        "default": "ESXi does not use the concept of native VLAN. Frames with VLAN\nspecified in the port group will have a tag, but frames with VLAN not specified\nin the port group are not tagged and therefore will end up as belonging to the\nnative VLAN of the physical switch.\n\n    For example, frames on VLAN 1 from a Cisco physical switch will be\nuntagged, because this is considered as the native VLAN. However, frames from\nESXi specified as VLAN 1 will be tagged with a \"1\"; therefore, traffic from\nESXi that is destined for the native VLAN will not be correctly routed (because\nit is tagged with a \"1\" instead of being untagged), and traffic from the\nphysical switch coming from the native VLAN will not be visible (because it is\nnot tagged).\n\n    If the ESXi virtual switch port group uses the native VLAN ID, traffic from\nthose VMs will not be visible to the native VLAN on the switch because the\nswitch is expecting untagged traffic.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi host and go to Configure >>\nNetworking >> Virtual switches.\n\n    For each virtual switch, review the port group VLAN tags and verify they\nare not set to the native VLAN ID of the attached physical switch.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VirtualPortGroup | Select Name, VLanId\n\n    If any port group is configured with the native VLAN of the attached\nphysical switch, this is a finding.",
        "fix": "From the vSphere Client, select the ESXi host and go to Configure >>\nNetworking >> Virtual switches.\n\n    Highlight the port group where VLAN ID is set to native VLAN ID and click\nEdit settings (dots).\n\n    Change the VLAN ID to a non-native VLAN and click \"OK\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VirtualPortGroup -Name \"portgroup name\" | Set-VirtualPortGroup\n-VLanId \"New VLAN#\""
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239317",
        "rid": "SV-239317r674880_rule",
        "stig_id": "ESXI-67-000063",
        "fix_id": "F-42509r674879_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000063\" do\n  title \"For the ESXi host, all port groups must be configured to a value other\nthan that of the native VLAN.\"\n  desc  \"ESXi does not use the concept of native VLAN. Frames with VLAN\nspecified in the port group will have a tag, but frames with VLAN not specified\nin the port group are not tagged and therefore will end up as belonging to the\nnative VLAN of the physical switch.\n\n    For example, frames on VLAN 1 from a Cisco physical switch will be\nuntagged, because this is considered as the native VLAN. However, frames from\nESXi specified as VLAN 1 will be tagged with a \\\"1\\\"; therefore, traffic from\nESXi that is destined for the native VLAN will not be correctly routed (because\nit is tagged with a \\\"1\\\" instead of being untagged), and traffic from the\nphysical switch coming from the native VLAN will not be visible (because it is\nnot tagged).\n\n    If the ESXi virtual switch port group uses the native VLAN ID, traffic from\nthose VMs will not be visible to the native VLAN on the switch because the\nswitch is expecting untagged traffic.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi host and go to Configure >>\nNetworking >> Virtual switches.\n\n    For each virtual switch, review the port group VLAN tags and verify they\nare not set to the native VLAN ID of the attached physical switch.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VirtualPortGroup | Select Name, VLanId\n\n    If any port group is configured with the native VLAN of the attached\nphysical switch, this is a finding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi host and go to Configure >>\nNetworking >> Virtual switches.\n\n    Highlight the port group where VLAN ID is set to native VLAN ID and click\nEdit settings (dots).\n\n    Change the VLAN ID to a non-native VLAN and click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VirtualPortGroup -Name \\\"portgroup name\\\" | Set-VirtualPortGroup\n-VLanId \\\"New VLAN#\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239317'\n  tag rid: 'SV-239317r674880_rule'\n  tag stig_id: 'ESXI-67-000063'\n  tag fix_id: 'F-42509r674879_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-VirtualPortGroup | Select-Object -ExpandProperty VlanId\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should_not match \"1\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000063.rb",
        "line": 1
      },
      "id": "ESXI-67-000063"
    },
    {
      "title": "SNMP must be configured properly on the ESXi host.",
      "desc": "If SNMP is not being used, it must remain disabled. If it is being\nused, the proper trap destination must be configured. If SNMP is not properly\nconfigured, monitoring information can be sent to a malicious host that can\nthen use this information to plan an attack.",
      "descriptions": {
        "default": "If SNMP is not being used, it must remain disabled. If it is being\nused, the proper trap destination must be configured. If SNMP is not properly\nconfigured, monitoring information can be sent to a malicious host that can\nthen use this information to plan an attack.",
        "rationale": "",
        "check": "From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHostSnmp | Select *\n\n    or\n\n    From an console or ssh session, run the follow command:\n\n    esxcli system snmp get\n\n    If SNMP is not in use and is enabled, this is a finding.\n\n    If SNMP is enabled and read-only communities is set to \"public\", this is\na finding.\n\n    If SNMP is enabled and is not using v3 targets, this is a finding.\n\n    Note: SNMP v3 targets can only be viewed and configured from the esxcli\ncommand.",
        "fix": "To disable SNMP, run the following command from a PowerCLI command prompt\nwhile connected to the ESXi Host:\n\n    Get-VMHostSnmp | Set-VMHostSnmp -Enabled $false\n\n    or\n\n    From a console or ssh session, run the follow command:\n\n    esxcli system snmp set -e no\n\n    To configure SNMP for v3 targets, use the \"esxcli system snmp set\"\ncommand set."
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239307",
        "rid": "SV-239307r674850_rule",
        "stig_id": "ESXI-67-000053",
        "fix_id": "F-42499r674849_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000053\" do\n  title 'SNMP must be configured properly on the ESXi host.'\n  desc  \"If SNMP is not being used, it must remain disabled. If it is being\nused, the proper trap destination must be configured. If SNMP is not properly\nconfigured, monitoring information can be sent to a malicious host that can\nthen use this information to plan an attack.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHostSnmp | Select *\n\n    or\n\n    From an console or ssh session, run the follow command:\n\n    esxcli system snmp get\n\n    If SNMP is not in use and is enabled, this is a finding.\n\n    If SNMP is enabled and read-only communities is set to \\\"public\\\", this is\na finding.\n\n    If SNMP is enabled and is not using v3 targets, this is a finding.\n\n    Note: SNMP v3 targets can only be viewed and configured from the esxcli\ncommand.\n  \"\n  desc  'fix', \"\n    To disable SNMP, run the following command from a PowerCLI command prompt\nwhile connected to the ESXi Host:\n\n    Get-VMHostSnmp | Set-VMHostSnmp -Enabled $false\n\n    or\n\n    From a console or ssh session, run the follow command:\n\n    esxcli system snmp set -e no\n\n    To configure SNMP for v3 targets, use the \\\"esxcli system snmp set\\\"\ncommand set.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239307'\n  tag rid: 'SV-239307r674850_rule'\n  tag stig_id: 'ESXI-67-000053'\n  tag fix_id: 'F-42499r674849_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  if \"#{input('snmpEnabled')}\" == \"false\" \n    command = \"$vmhost = Get-VMHost -Name #{input('vmhostName')}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.snmp.get.Invoke() | Select-Object -ExpandProperty enable\"\n    describe powercli_command(command) do\n      its ('stdout.strip') { should cmp \"false\" }\n    end\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000053.rb",
        "line": 1
      },
      "id": "ESXI-67-000053"
    },
    {
      "title": "The ESXi host must log out of the console UI after two minutes.",
      "desc": "When the direct console user interface (DCUI) is enabled and logged\nin, it should be automatically logged out if left logged in to avoid access by\nunauthorized persons. The \"DcuiTimeOut\" setting defines a window of time\nafter which the DCUI will be logged out.",
      "descriptions": {
        "default": "When the direct console user interface (DCUI) is enabled and logged\nin, it should be automatically logged out if left logged in to avoid access by\nunauthorized persons. The \"DcuiTimeOut\" setting defines a window of time\nafter which the DCUI will be logged out.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \"UserVars.DcuiTimeOut\" value and verify it is set to \"120\"\n(2 minutes).\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.DcuiTimeOut\n\n    If the \"UserVars.DcuiTimeOut\" setting is not set to \"120\", this is a\nfinding.",
        "fix": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \"Edit\", select the \"UserVars.DcuiTimeOut\" value, and configure it\nto \"120\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.DcuiTimeOut |\nSet-AdvancedSetting -Value 120"
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000163-VMM-000700",
        "satisfies": [
          "SRG-OS-000163-VMM-000700",
          "SRG-OS-000279-VMM-001010"
        ],
        "gid": "V-239298",
        "rid": "SV-239298r674823_rule",
        "stig_id": "ESXI-67-000043",
        "fix_id": "F-42490r674822_fix",
        "cci": [
          "CCI-001133",
          "CCI-002361"
        ],
        "nist": [
          "SC-10",
          "AC-12"
        ]
      },
      "code": "control \"ESXI-67-000043\" do\n  title 'The ESXi host must log out of the console UI after two minutes.'\n  desc  \"When the direct console user interface (DCUI) is enabled and logged\nin, it should be automatically logged out if left logged in to avoid access by\nunauthorized persons. The \\\"DcuiTimeOut\\\" setting defines a window of time\nafter which the DCUI will be logged out.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \\\"UserVars.DcuiTimeOut\\\" value and verify it is set to \\\"120\\\"\n(2 minutes).\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.DcuiTimeOut\n\n    If the \\\"UserVars.DcuiTimeOut\\\" setting is not set to \\\"120\\\", this is a\nfinding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \\\"Edit\\\", select the \\\"UserVars.DcuiTimeOut\\\" value, and configure it\nto \\\"120\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.DcuiTimeOut |\nSet-AdvancedSetting -Value 120\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000163-VMM-000700'\n  tag satisfies: ['SRG-OS-000163-VMM-000700', 'SRG-OS-000279-VMM-001010']\n  tag gid: 'V-239298'\n  tag rid: 'SV-239298r674823_rule'\n  tag stig_id: 'ESXI-67-000043'\n  tag fix_id: 'F-42490r674822_fix'\n  tag cci: ['CCI-001133', 'CCI-002361']\n  tag nist: ['SC-10', 'AC-12']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-AdvancedSetting -Name UserVars.DcuiTimeOut | Select-Object -ExpandProperty Value\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp \"120\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000043.rb",
        "line": 1
      },
      "id": "ESXI-67-000043"
    },
    {
      "title": "The virtual switch Forged Transmits policy must be set to reject on\nthe ESXi host.",
      "desc": "If the virtual machine operating system changes the MAC address, the\noperating system can send frames with an impersonated source MAC address at any\ntime. This allows an operating system to stage malicious attacks on the devices\nin a network by impersonating a network adaptor authorized by the receiving\nnetwork.\n\n    This means the virtual switch does not compare the source and effective MAC\naddresses.\n\n    To protect against MAC address impersonation, all virtual switches should\nhave forged transmissions set to reject. Reject Forged Transmit can be set at\nthe vSwitch and/or the Portgroup level. Switch-level settings can be overridden\nat the Portgroup level.",
      "descriptions": {
        "default": "If the virtual machine operating system changes the MAC address, the\noperating system can send frames with an impersonated source MAC address at any\ntime. This allows an operating system to stage malicious attacks on the devices\nin a network by impersonating a network adaptor authorized by the receiving\nnetwork.\n\n    This means the virtual switch does not compare the source and effective MAC\naddresses.\n\n    To protect against MAC address impersonation, all virtual switches should\nhave forged transmissions set to reject. Reject Forged Transmit can be set at\nthe vSwitch and/or the Portgroup level. Switch-level settings can be overridden\nat the Portgroup level.",
        "rationale": "",
        "check": "From the vSphere Client, go to Configure >> Networking >> Virtual Switches.\n\n    View the properties on each virtual switch and port group and verify\n\"Forged Transmits\" is set to reject.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VirtualSwitch | Get-SecurityPolicy\n    Get-VirtualPortGroup | Get-SecurityPolicy\n\n    If the \"Forged Transmits\" policy is set to accept (or true, via\nPowerCLI), this is a finding.",
        "fix": "From the vSphere Client, go to Configure >> Networking >> Virtual Switches.\n\n    For each virtual switch and port group, click Edit settings (dots) and\nchange \"Forged Transmits\" to reject.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VirtualSwitch | Get-SecurityPolicy | Set-SecurityPolicy\n-ForgedTransmits $false\n    Get-VirtualPortGroup | Get-SecurityPolicy | Set-SecurityPolicy\n-ForgedTransmitsInherited $true"
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239313",
        "rid": "SV-239313r674868_rule",
        "stig_id": "ESXI-67-000059",
        "fix_id": "F-42505r674867_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000059\" do\n  title \"The virtual switch Forged Transmits policy must be set to reject on\nthe ESXi host.\"\n  desc  \"If the virtual machine operating system changes the MAC address, the\noperating system can send frames with an impersonated source MAC address at any\ntime. This allows an operating system to stage malicious attacks on the devices\nin a network by impersonating a network adaptor authorized by the receiving\nnetwork.\n\n    This means the virtual switch does not compare the source and effective MAC\naddresses.\n\n    To protect against MAC address impersonation, all virtual switches should\nhave forged transmissions set to reject. Reject Forged Transmit can be set at\nthe vSwitch and/or the Portgroup level. Switch-level settings can be overridden\nat the Portgroup level.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Configure >> Networking >> Virtual Switches.\n\n    View the properties on each virtual switch and port group and verify\n\\\"Forged Transmits\\\" is set to reject.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VirtualSwitch | Get-SecurityPolicy\n    Get-VirtualPortGroup | Get-SecurityPolicy\n\n    If the \\\"Forged Transmits\\\" policy is set to accept (or true, via\nPowerCLI), this is a finding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, go to Configure >> Networking >> Virtual Switches.\n\n    For each virtual switch and port group, click Edit settings (dots) and\nchange \\\"Forged Transmits\\\" to reject.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VirtualSwitch | Get-SecurityPolicy | Set-SecurityPolicy\n-ForgedTransmits $false\n    Get-VirtualPortGroup | Get-SecurityPolicy | Set-SecurityPolicy\n-ForgedTransmitsInherited $true\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239313'\n  tag rid: 'SV-239313r674868_rule'\n  tag stig_id: 'ESXI-67-000059'\n  tag fix_id: 'F-42505r674867_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-VirtualSwitch | Get-SecurityPolicy | Select-Object -ExpandProperty ForgedTransmits\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should_not match \"True\" }\n  end\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-VirtualPortGroup | Get-SecurityPolicy | Select-Object -ExpandProperty ForgedTransmits\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should_not match \"True\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000059.rb",
        "line": 1
      },
      "id": "ESXI-67-000059"
    },
    {
      "title": "The ESXi host must disable Inter-VM transparent page sharing.",
      "desc": "Published academic papers have demonstrated that by forcing a flush\nand reload of cache memory, it is possible to measure memory timings to try to\ndetermine an AES encryption key in use on another virtual machine running on\nthe same physical processor of the host server if Transparent Page Sharing is\nenabled between the two virtual machines. This technique works only in a highly\ncontrolled system configured in a non-standard way that VMware believes would\nnot be recreated in a production environment.\n\n    Although VMware believes information being disclosed in real-world\nconditions is unrealistic, out of an abundance of caution, upcoming ESXi update\nreleases will no longer enable TPS between virtual machines by default (TPS\nwill still be used within individual VMs).",
      "descriptions": {
        "default": "Published academic papers have demonstrated that by forcing a flush\nand reload of cache memory, it is possible to measure memory timings to try to\ndetermine an AES encryption key in use on another virtual machine running on\nthe same physical processor of the host server if Transparent Page Sharing is\nenabled between the two virtual machines. This technique works only in a highly\ncontrolled system configured in a non-standard way that VMware believes would\nnot be recreated in a production environment.\n\n    Although VMware believes information being disclosed in real-world\nconditions is unrealistic, out of an abundance of caution, upcoming ESXi update\nreleases will no longer enable TPS between virtual machines by default (TPS\nwill still be used within individual VMs).",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \"Mem.ShareForceSalting\" value and verify it is set to \"2\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Mem.ShareForceSalting\n\n    If the \"Mem.ShareForceSalting\" setting is not set to \"2\", this is a\nfinding.",
        "fix": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \"Edit\", select the \"Mem.ShareForceSalting\" value, and configure\nit to \"2\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VMHost | Get-AdvancedSetting -Name Mem.ShareForceSalting |\nSet-AdvancedSetting -Value 2"
      },
      "impact": 0.3,
      "refs": [],
      "tags": {
        "severity": "low",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239309",
        "rid": "SV-239309r674856_rule",
        "stig_id": "ESXI-67-000055",
        "fix_id": "F-42501r674855_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000055\" do\n  title 'The ESXi host must disable Inter-VM transparent page sharing.'\n  desc  \"Published academic papers have demonstrated that by forcing a flush\nand reload of cache memory, it is possible to measure memory timings to try to\ndetermine an AES encryption key in use on another virtual machine running on\nthe same physical processor of the host server if Transparent Page Sharing is\nenabled between the two virtual machines. This technique works only in a highly\ncontrolled system configured in a non-standard way that VMware believes would\nnot be recreated in a production environment.\n\n    Although VMware believes information being disclosed in real-world\nconditions is unrealistic, out of an abundance of caution, upcoming ESXi update\nreleases will no longer enable TPS between virtual machines by default (TPS\nwill still be used within individual VMs).\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \\\"Mem.ShareForceSalting\\\" value and verify it is set to \\\"2\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Mem.ShareForceSalting\n\n    If the \\\"Mem.ShareForceSalting\\\" setting is not set to \\\"2\\\", this is a\nfinding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \\\"Edit\\\", select the \\\"Mem.ShareForceSalting\\\" value, and configure\nit to \\\"2\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VMHost | Get-AdvancedSetting -Name Mem.ShareForceSalting |\nSet-AdvancedSetting -Value 2\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239309'\n  tag rid: 'SV-239309r674856_rule'\n  tag stig_id: 'ESXI-67-000055'\n  tag fix_id: 'F-42501r674855_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-AdvancedSetting -Name Mem.ShareForceSalting | Select-Object -ExpandProperty Value\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp \"2\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000055.rb",
        "line": 1
      },
      "id": "ESXI-67-000055"
    },
    {
      "title": "The ESXi host SSH daemon must be configured to not allow gateway\nports.",
      "desc": "SSH TCP connection forwarding provides a mechanism to establish TCP\nconnections proxied by the SSH server. This function can provide similar\nconvenience to a Virtual Private Network (VPN) with the similar risk of\nproviding a path to circumvent firewalls and network Access Control Lists\n(ACLs). Gateway ports allow remote forwarded ports to bind to non-loopback\naddresses on the server.",
      "descriptions": {
        "default": "SSH TCP connection forwarding provides a mechanism to establish TCP\nconnections proxied by the SSH server. This function can provide similar\nconvenience to a Virtual Private Network (VPN) with the similar risk of\nproviding a path to circumvent firewalls and network Access Control Lists\n(ACLs). Gateway ports allow remote forwarded ports to bind to non-loopback\naddresses on the server.",
        "rationale": "",
        "check": "From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \"^GatewayPorts\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \"GatewayPorts no\",\nthis is a finding.",
        "fix": "From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \"/etc/ssh/sshd_config\":\n\n    GatewayPorts no"
      },
      "impact": 0.3,
      "refs": [],
      "tags": {
        "severity": "low",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239277",
        "rid": "SV-239277r674760_rule",
        "stig_id": "ESXI-67-000022",
        "fix_id": "F-42469r674759_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000022\" do\n  title \"The ESXi host SSH daemon must be configured to not allow gateway\nports.\"\n  desc  \"SSH TCP connection forwarding provides a mechanism to establish TCP\nconnections proxied by the SSH server. This function can provide similar\nconvenience to a Virtual Private Network (VPN) with the similar risk of\nproviding a path to circumvent firewalls and network Access Control Lists\n(ACLs). Gateway ports allow remote forwarded ports to bind to non-loopback\naddresses on the server.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \\\"^GatewayPorts\\\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \\\"GatewayPorts no\\\",\nthis is a finding.\n  \"\n  desc  'fix', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    GatewayPorts no\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239277'\n  tag rid: 'SV-239277r674760_rule'\n  tag stig_id: 'ESXI-67-000022'\n  tag fix_id: 'F-42469r674759_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"$vmhost = Get-VMHost -Name #{input('vmhostName')}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.software.vib.list.Invoke() | Where {$_.Name -eq '#{input('dodStigVibRootEnabled')}' -or $_.Name -eq '#{input('dodStigVibRootDisabled')}'}\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should_not cmp \"\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000022.rb",
        "line": 1
      },
      "id": "ESXI-67-000022"
    },
    {
      "title": "The ESXi host must remove keys from the SSH authorized_keys file.",
      "desc": "ESXi hosts come with SSH, which can be enabled to allow remote access\nwithout requiring user authentication. To enable password-free access, copy the\nremote user's public key into the \"/etc/ssh/keys-root/authorized_keys\" file\non the ESXi host.\n\n    The presence of the remote user's public key in the \"authorized_keys\"\nfile identifies the user as trusted, meaning the user is granted access to the\nhost without providing a password.\n\n    If using Lockdown Mode and SSH is disabled, then logon with authorized keys\nwill have the same restrictions as username/password.",
      "descriptions": {
        "default": "ESXi hosts come with SSH, which can be enabled to allow remote access\nwithout requiring user authentication. To enable password-free access, copy the\nremote user's public key into the \"/etc/ssh/keys-root/authorized_keys\" file\non the ESXi host.\n\n    The presence of the remote user's public key in the \"authorized_keys\"\nfile identifies the user as trusted, meaning the user is granted access to the\nhost without providing a password.\n\n    If using Lockdown Mode and SSH is disabled, then logon with authorized keys\nwill have the same restrictions as username/password.",
        "rationale": "",
        "check": "From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # ls -la /etc/ssh/keys-root/authorized_keys\n\n    or\n\n    # cat /etc/ssh/keys-root/authorized_keys\n\n    If the \"authorized_keys\" file exists and is not empty, this is a finding.",
        "fix": "From an SSH session connected to the ESXi host, or from the ESXi shell,\nzero out or remove the /etc/ssh/keys-root/authorized_keys file:\n\n    # >/etc/ssh/keys-root/authorized_keys\n\n    or\n\n    # rm /etc/ssh/keys-root/authorized_keys"
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239284",
        "rid": "SV-239284r674781_rule",
        "stig_id": "ESXI-67-000029",
        "fix_id": "F-42476r674780_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000029\" do\n  title 'The ESXi host must remove keys from the SSH authorized_keys file.'\n  desc  \"ESXi hosts come with SSH, which can be enabled to allow remote access\nwithout requiring user authentication. To enable password-free access, copy the\nremote user's public key into the \\\"/etc/ssh/keys-root/authorized_keys\\\" file\non the ESXi host.\n\n    The presence of the remote user's public key in the \\\"authorized_keys\\\"\nfile identifies the user as trusted, meaning the user is granted access to the\nhost without providing a password.\n\n    If using Lockdown Mode and SSH is disabled, then logon with authorized keys\nwill have the same restrictions as username/password.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # ls -la /etc/ssh/keys-root/authorized_keys\n\n    or\n\n    # cat /etc/ssh/keys-root/authorized_keys\n\n    If the \\\"authorized_keys\\\" file exists and is not empty, this is a finding.\n  \"\n  desc  'fix', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell,\nzero out or remove the /etc/ssh/keys-root/authorized_keys file:\n\n    # >/etc/ssh/keys-root/authorized_keys\n\n    or\n\n    # rm /etc/ssh/keys-root/authorized_keys\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239284'\n  tag rid: 'SV-239284r674781_rule'\n  tag stig_id: 'ESXI-67-000029'\n  tag fix_id: 'F-42476r674780_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe \"This check is a manual or policy based check\" do\n    skip \"This must be reviewed manually\"\n  end\n\n#This is the powershell way to check this...not sure how to handle this yet in Inspec\n\n#$results = Invoke-WebRequest -uri \"https://$($vmhost.name)/host/ssh_root_authorized_keys\" -Method Get -Credential $esxicred\n#            If($results.Content.length -gt 1)\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000029.rb",
        "line": 1
      },
      "id": "ESXI-67-000029"
    },
    {
      "title": "For physical switch ports connected to the ESXi host, the\nnon-negotiate option must be configured for trunk links between external\nphysical switches and virtual switches in Virtual Switch Tagging (VST) mode.",
      "desc": "To communicate with virtual switches in VST mode, external switch\nports must be configured as trunk ports. VST mode does not support Dynamic\nTrunking Protocol (DTP), so the trunk must be static and unconditional. The\nauto or desirable physical switch settings do not work with the ESXi Server\nbecause the physical switch communicates with the ESXi Server using DTP.\n\n    The non-negotiate and on options unconditionally enable VLAN trunking on\nthe physical switch and create a VLAN trunk link between the ESXi Server and\nthe physical switch. The difference between non-negotiate and on options is\nthat on mode still sends out DTP frames, whereas the non-negotiate option does\nnot. The non-negotiate option should be used for all VLAN trunks to minimize\nunnecessary network traffic for virtual switches in VST mode.",
      "descriptions": {
        "default": "To communicate with virtual switches in VST mode, external switch\nports must be configured as trunk ports. VST mode does not support Dynamic\nTrunking Protocol (DTP), so the trunk must be static and unconditional. The\nauto or desirable physical switch settings do not work with the ESXi Server\nbecause the physical switch communicates with the ESXi Server using DTP.\n\n    The non-negotiate and on options unconditionally enable VLAN trunking on\nthe physical switch and create a VLAN trunk link between the ESXi Server and\nthe physical switch. The difference between non-negotiate and on options is\nthat on mode still sends out DTP frames, whereas the non-negotiate option does\nnot. The non-negotiate option should be used for all VLAN trunks to minimize\nunnecessary network traffic for virtual switches in VST mode.",
        "rationale": "",
        "check": "Note that this check refers to an entity outside the physical scope of the\nESXi server system. The configuration of external switch ports as trunk ports\nmust be documented. VST mode does not support DTP, so the trunk must be static\nand unconditional.\n\n    Inspect the documentation and verify that it is correct and updated\naccording to an organization-defined frequency and/or whenever modifications\nare made to either ESXi hosts or the upstream external switch ports.\n\n    If DTP is enabled on the physical switch ports connected to the ESXi host,\nthis is a finding.",
        "fix": "Note that this check refers to an entity outside the physical scope of the\nESXi server system.\n\n    Document the configuration of external switch ports as trunk ports.\n\n    Log in to the vendor-specific physical switch and disable DTP on the\nphysical switch ports connected to the ESXi host.\n\n    Update the documentation according to an organization-defined frequency or\nwhenever modifications are made to either ESXi hosts or the upstream external\nswitch ports."
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239320",
        "rid": "SV-239320r674889_rule",
        "stig_id": "ESXI-67-000066",
        "fix_id": "F-42512r674888_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000066\" do\n  title \"For physical switch ports connected to the ESXi host, the\nnon-negotiate option must be configured for trunk links between external\nphysical switches and virtual switches in Virtual Switch Tagging (VST) mode.\"\n  desc  \"To communicate with virtual switches in VST mode, external switch\nports must be configured as trunk ports. VST mode does not support Dynamic\nTrunking Protocol (DTP), so the trunk must be static and unconditional. The\nauto or desirable physical switch settings do not work with the ESXi Server\nbecause the physical switch communicates with the ESXi Server using DTP.\n\n    The non-negotiate and on options unconditionally enable VLAN trunking on\nthe physical switch and create a VLAN trunk link between the ESXi Server and\nthe physical switch. The difference between non-negotiate and on options is\nthat on mode still sends out DTP frames, whereas the non-negotiate option does\nnot. The non-negotiate option should be used for all VLAN trunks to minimize\nunnecessary network traffic for virtual switches in VST mode.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    Note that this check refers to an entity outside the physical scope of the\nESXi server system. The configuration of external switch ports as trunk ports\nmust be documented. VST mode does not support DTP, so the trunk must be static\nand unconditional.\n\n    Inspect the documentation and verify that it is correct and updated\naccording to an organization-defined frequency and/or whenever modifications\nare made to either ESXi hosts or the upstream external switch ports.\n\n    If DTP is enabled on the physical switch ports connected to the ESXi host,\nthis is a finding.\n  \"\n  desc  'fix', \"\n    Note that this check refers to an entity outside the physical scope of the\nESXi server system.\n\n    Document the configuration of external switch ports as trunk ports.\n\n    Log in to the vendor-specific physical switch and disable DTP on the\nphysical switch ports connected to the ESXi host.\n\n    Update the documentation according to an organization-defined frequency or\nwhenever modifications are made to either ESXi hosts or the upstream external\nswitch ports.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239320'\n  tag rid: 'SV-239320r674889_rule'\n  tag stig_id: 'ESXI-67-000066'\n  tag fix_id: 'F-42512r674888_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe \"This check is a manual or policy based check\" do\n    skip \"This must be reviewed manually\"\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000066.rb",
        "line": 1
      },
      "id": "ESXI-67-000066"
    },
    {
      "title": "The ESXi host must enable a persistent log location for all locally\nstored logs.",
      "desc": "ESXi can be configured to store log files on an in-memory file system.\nThis occurs when the host's \"/scratch\" directory is linked to\n\"/tmp/scratch\". When this is done, only a single day's worth of logs is\nstored at any time. In addition, log files will be reinitialized upon each\nreboot. This presents a security risk as user activity logged on the host is\nonly stored temporarily and will not persist across reboots. This can also\ncomplicate auditing and make it harder to monitor events and diagnose issues.\nESXi host logging should always be configured to a persistent datastore.\n\n    Note: Scratch space is configured automatically during installation or\nfirst boot of an ESXi host and does not usually need to be manually configured.\nESXi Installable creates a 4 GB Fat16 partition on the target device during\ninstallation if there is sufficient space and if the device is considered\n\"local\".\n\n    If ESXi is installed on an SD card or USB device, a persistent log location\nmay not be configured upon install as normal.",
      "descriptions": {
        "default": "ESXi can be configured to store log files on an in-memory file system.\nThis occurs when the host's \"/scratch\" directory is linked to\n\"/tmp/scratch\". When this is done, only a single day's worth of logs is\nstored at any time. In addition, log files will be reinitialized upon each\nreboot. This presents a security risk as user activity logged on the host is\nonly stored temporarily and will not persist across reboots. This can also\ncomplicate auditing and make it harder to monitor events and diagnose issues.\nESXi host logging should always be configured to a persistent datastore.\n\n    Note: Scratch space is configured automatically during installation or\nfirst boot of an ESXi host and does not usually need to be manually configured.\nESXi Installable creates a 4 GB Fat16 partition on the target device during\ninstallation if there is sufficient space and if the device is considered\n\"local\".\n\n    If ESXi is installed on an SD card or USB device, a persistent log location\nmay not be configured upon install as normal.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \"Syslog.global.logDir\" value and verify it is set to a\npersistent location.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    $esxcli = Get-EsxCli -v2\n    $esxcli.system.syslog.config.get.Invoke() | Select\nLocalLogOutput,LocalLogOutputIsPersistent\n\n    If the \"LocalLogOutputIsPersistent\" value is not true, this is a finding.",
        "fix": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \"Edit\" and select the \"Syslog.global.logDir\" value and set it to\na known persistent location.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.logDir |\nSet-AdvancedSetting -Value \"New Log Location\""
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000341-VMM-001220",
        "gid": "V-239300",
        "rid": "SV-239300r674829_rule",
        "stig_id": "ESXI-67-000045",
        "fix_id": "F-42492r674828_fix",
        "cci": [
          "CCI-001849"
        ],
        "nist": [
          "AU-4"
        ]
      },
      "code": "control \"ESXI-67-000045\" do\n  title \"The ESXi host must enable a persistent log location for all locally\nstored logs.\"\n  desc  \"ESXi can be configured to store log files on an in-memory file system.\nThis occurs when the host's \\\"/scratch\\\" directory is linked to\n\\\"/tmp/scratch\\\". When this is done, only a single day's worth of logs is\nstored at any time. In addition, log files will be reinitialized upon each\nreboot. This presents a security risk as user activity logged on the host is\nonly stored temporarily and will not persist across reboots. This can also\ncomplicate auditing and make it harder to monitor events and diagnose issues.\nESXi host logging should always be configured to a persistent datastore.\n\n    Note: Scratch space is configured automatically during installation or\nfirst boot of an ESXi host and does not usually need to be manually configured.\nESXi Installable creates a 4 GB Fat16 partition on the target device during\ninstallation if there is sufficient space and if the device is considered\n\\\"local\\\".\n\n    If ESXi is installed on an SD card or USB device, a persistent log location\nmay not be configured upon install as normal.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \\\"Syslog.global.logDir\\\" value and verify it is set to a\npersistent location.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    $esxcli = Get-EsxCli -v2\n    $esxcli.system.syslog.config.get.Invoke() | Select\nLocalLogOutput,LocalLogOutputIsPersistent\n\n    If the \\\"LocalLogOutputIsPersistent\\\" value is not true, this is a finding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \\\"Edit\\\" and select the \\\"Syslog.global.logDir\\\" value and set it to\na known persistent location.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.logDir |\nSet-AdvancedSetting -Value \\\"New Log Location\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000341-VMM-001220'\n  tag gid: 'V-239300'\n  tag rid: 'SV-239300r674829_rule'\n  tag stig_id: 'ESXI-67-000045'\n  tag fix_id: 'F-42492r674828_fix'\n  tag cci: ['CCI-001849']\n  tag nist: ['AU-4']\n\n  command = \"$vmhost = Get-VMHost -Name #{input('vmhostName')}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.syslog.config.get.Invoke() | Select-Object -ExpandProperty LocalLogOutputIsPersistent\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp \"true\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000045.rb",
        "line": 1
      },
      "id": "ESXI-67-000045"
    },
    {
      "title": "The ESXi host must exclusively enable TLS 1.2 for all endpoints.",
      "desc": "TLS 1.0 and 1.1 are deprecated protocols with well-published\nshortcomings and vulnerabilities. TLS 1.2 should be enabled on all interfaces\nand SSLv3, TL 1.1, and 1.0 disabled where supported.\n\n    Mandating TLS 1.2 may break third-party integrations and add-ons to\nvSphere. Test these integrations carefully after implementing TLS 1.2 and roll\nback where appropriate.\n\n    On interfaces where required functionality is broken with TLS 1.2 this\nfinding is not applicable until the third-party software supports TLS 1.2.\n\n    Be sure to modify TLS settings in the following order:\n\n    1. Platform Services Controllers (if applicable)\n    2. vCenter\n    3. ESXi",
      "descriptions": {
        "default": "TLS 1.0 and 1.1 are deprecated protocols with well-published\nshortcomings and vulnerabilities. TLS 1.2 should be enabled on all interfaces\nand SSLv3, TL 1.1, and 1.0 disabled where supported.\n\n    Mandating TLS 1.2 may break third-party integrations and add-ons to\nvSphere. Test these integrations carefully after implementing TLS 1.2 and roll\nback where appropriate.\n\n    On interfaces where required functionality is broken with TLS 1.2 this\nfinding is not applicable until the third-party software supports TLS 1.2.\n\n    Be sure to modify TLS settings in the following order:\n\n    1. Platform Services Controllers (if applicable)\n    2. vCenter\n    3. ESXi",
        "rationale": "",
        "check": "From the vSphere Web Client, select the host and click Configure >> System\n>> Advanced System Settings.\n\n    Find the \"UserVars.ESXiVPsDisabledProtocols\" value and verify that it is\nset to the following:\n\n    tlsv1,tlsv1.1,sslv3\n\n    If the value is not set as above or it does not exist, this is a finding.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.ESXiVPsDisabledProtocols\n\n    If the value returned is not \"tlsv1,tlsv1.1,sslv3\" or the setting does\nnot exist, this is a finding.",
        "fix": "From the vSphere Web Client, select the host and click Configure >> System\n>> Advanced System Settings.\n\n    Find the \"UserVars.ESXiVPsDisabledProtocols\" value and set it to the\nfollowing:\n\n    tlsv1,tlsv1.1,sslv3\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.ESXiVPsDisabledProtocols |\nSet-AdvancedSetting -Value \"tlsv1,tlsv1.1,sslv3\"\n\n    A host reboot is required for changes to take effect."
      },
      "impact": 0.7,
      "refs": [],
      "tags": {
        "severity": "high",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239326",
        "rid": "SV-239326r674907_rule",
        "stig_id": "ESXI-67-000074",
        "fix_id": "F-42518r674906_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000074\" do\n  title 'The ESXi host must exclusively enable TLS 1.2 for all endpoints.'\n  desc  \"TLS 1.0 and 1.1 are deprecated protocols with well-published\nshortcomings and vulnerabilities. TLS 1.2 should be enabled on all interfaces\nand SSLv3, TL 1.1, and 1.0 disabled where supported.\n\n    Mandating TLS 1.2 may break third-party integrations and add-ons to\nvSphere. Test these integrations carefully after implementing TLS 1.2 and roll\nback where appropriate.\n\n    On interfaces where required functionality is broken with TLS 1.2 this\nfinding is not applicable until the third-party software supports TLS 1.2.\n\n    Be sure to modify TLS settings in the following order:\n\n    1. Platform Services Controllers (if applicable)\n    2. vCenter\n    3. ESXi\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Web Client, select the host and click Configure >> System\n>> Advanced System Settings.\n\n    Find the \\\"UserVars.ESXiVPsDisabledProtocols\\\" value and verify that it is\nset to the following:\n\n    tlsv1,tlsv1.1,sslv3\n\n    If the value is not set as above or it does not exist, this is a finding.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.ESXiVPsDisabledProtocols\n\n    If the value returned is not \\\"tlsv1,tlsv1.1,sslv3\\\" or the setting does\nnot exist, this is a finding.\n  \"\n  desc  'fix', \"\n    From the vSphere Web Client, select the host and click Configure >> System\n>> Advanced System Settings.\n\n    Find the \\\"UserVars.ESXiVPsDisabledProtocols\\\" value and set it to the\nfollowing:\n\n    tlsv1,tlsv1.1,sslv3\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.ESXiVPsDisabledProtocols |\nSet-AdvancedSetting -Value \\\"tlsv1,tlsv1.1,sslv3\\\"\n\n    A host reboot is required for changes to take effect.\n  \"\n  impact 0.7\n  tag severity: 'high'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239326'\n  tag rid: 'SV-239326r674907_rule'\n  tag stig_id: 'ESXI-67-000074'\n  tag fix_id: 'F-42518r674906_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-AdvancedSetting -Name UserVars.ESXiVPsDisabledProtocols | Select-Object -ExpandProperty Value\"\n  \n  describe.one do\n\n    describe powercli_command(command) do\n      its('stdout.strip') { should cmp \"tlsv1,tlsv1.1,sslv3\" }\n    end\n\n    describe powercli_command(command) do\n      its('stdout.strip') { should cmp \"sslv3,tlsv1,tlsv1.1\" }\n    end\n    \n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000074.rb",
        "line": 1
      },
      "id": "ESXI-67-000074"
    },
    {
      "title": "The ESXi host must display the Standard Mandatory DoD Notice and\nConsent Banner before granting access to the system via SSH.",
      "desc": "Failure to display the DoD logon banner prior to a logon attempt will\nnegate legal proceedings resulting from unauthorized access to system\nresources.",
      "descriptions": {
        "default": "Failure to display the DoD logon banner prior to a logon attempt will\nnegate legal proceedings resulting from unauthorized access to system\nresources.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \"Config.Etc.issue\" value and verify it is set to the DoD logon\nbanner below.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Config.Etc.issue\n\n    If the \"Config.Etc.issue\" setting (/etc/issue file) does not contain the\nlogon banner exactly as shown below, this is a finding.\n\n    \"You are accessing a U.S. Government (USG) Information System (IS) that is\nprovided for USG-authorized use only. By using this IS (which includes any\ndevice attached to this IS), you consent to the following conditions: -The USG\nroutinely intercepts and monitors communications on this IS for purposes\nincluding, but not limited to, penetration testing, COMSEC monitoring, network\noperations and defense, personnel misconduct (PM), law enforcement (LE), and\ncounterintelligence (CI) investigations. -At any time, the USG may inspect and\nseize data stored on this IS. -Communications using, or data stored on, this IS\nare not private, are subject to routine monitoring, interception, and search,\nand may be disclosed or used for any USG-authorized purpose. -This IS includes\nsecurity measures (e.g., authentication and access controls) to protect USG\ninterests--not for your personal benefit or privacy. -Notwithstanding the\nabove, using this IS does not constitute consent to PM, LE or CI investigative\nsearching or monitoring of the content of privileged communications, or work\nproduct, related to personal representation or services by attorneys,\npsychotherapists, or clergy, and their assistants. Such communications and work\nproduct are private and confidential. See User Agreement for details.\"",
        "fix": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \"Edit\", select the \"Config.Etc.issue\" value, and set it to the\nfollowing:\n\n    \"You are accessing a U.S. Government (USG) Information System (IS) that is\nprovided for USG-authorized use only. By using this IS (which includes any\ndevice attached to this IS), you consent to the following conditions: -The USG\nroutinely intercepts and monitors communications on this IS for purposes\nincluding, but not limited to, penetration testing, COMSEC monitoring, network\noperations and defense, personnel misconduct (PM), law enforcement (LE), and\ncounterintelligence (CI) investigations. -At any time, the USG may inspect and\nseize data stored on this IS. -Communications using, or data stored on, this IS\nare not private, are subject to routine monitoring, interception, and search,\nand may be disclosed or used for any USG-authorized purpose. -This IS includes\nsecurity measures (e.g., authentication and access controls) to protect USG\ninterests--not for your personal benefit or privacy. -Notwithstanding the\nabove, using this IS does not constitute consent to PM, LE or CI investigative\nsearching or monitoring of the content of privileged communications, or work\nproduct, related to personal representation or services by attorneys,\npsychotherapists, or clergy, and their assistants. Such communications and work\nproduct are private and confidential. See User Agreement for details.\"\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VMHost | Get-AdvancedSetting -Name Config.Etc.issue |\nSet-AdvancedSetting -Value \"<insert logon banner>\""
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000023-VMM-000060",
        "gid": "V-239265",
        "rid": "SV-239265r674724_rule",
        "stig_id": "ESXI-67-000008",
        "fix_id": "F-42457r674723_fix",
        "cci": [
          "CCI-000048"
        ],
        "nist": [
          "AC-8 a"
        ]
      },
      "code": "control \"ESXI-67-000008\" do\n  title \"The ESXi host must display the Standard Mandatory DoD Notice and\nConsent Banner before granting access to the system via SSH.\"\n  desc  \"Failure to display the DoD logon banner prior to a logon attempt will\nnegate legal proceedings resulting from unauthorized access to system\nresources.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \\\"Config.Etc.issue\\\" value and verify it is set to the DoD logon\nbanner below.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Config.Etc.issue\n\n    If the \\\"Config.Etc.issue\\\" setting (/etc/issue file) does not contain the\nlogon banner exactly as shown below, this is a finding.\n\n    \\\"You are accessing a U.S. Government (USG) Information System (IS) that is\nprovided for USG-authorized use only. By using this IS (which includes any\ndevice attached to this IS), you consent to the following conditions: -The USG\nroutinely intercepts and monitors communications on this IS for purposes\nincluding, but not limited to, penetration testing, COMSEC monitoring, network\noperations and defense, personnel misconduct (PM), law enforcement (LE), and\ncounterintelligence (CI) investigations. -At any time, the USG may inspect and\nseize data stored on this IS. -Communications using, or data stored on, this IS\nare not private, are subject to routine monitoring, interception, and search,\nand may be disclosed or used for any USG-authorized purpose. -This IS includes\nsecurity measures (e.g., authentication and access controls) to protect USG\ninterests--not for your personal benefit or privacy. -Notwithstanding the\nabove, using this IS does not constitute consent to PM, LE or CI investigative\nsearching or monitoring of the content of privileged communications, or work\nproduct, related to personal representation or services by attorneys,\npsychotherapists, or clergy, and their assistants. Such communications and work\nproduct are private and confidential. See User Agreement for details.\\\"\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \\\"Edit\\\", select the \\\"Config.Etc.issue\\\" value, and set it to the\nfollowing:\n\n    \\\"You are accessing a U.S. Government (USG) Information System (IS) that is\nprovided for USG-authorized use only. By using this IS (which includes any\ndevice attached to this IS), you consent to the following conditions: -The USG\nroutinely intercepts and monitors communications on this IS for purposes\nincluding, but not limited to, penetration testing, COMSEC monitoring, network\noperations and defense, personnel misconduct (PM), law enforcement (LE), and\ncounterintelligence (CI) investigations. -At any time, the USG may inspect and\nseize data stored on this IS. -Communications using, or data stored on, this IS\nare not private, are subject to routine monitoring, interception, and search,\nand may be disclosed or used for any USG-authorized purpose. -This IS includes\nsecurity measures (e.g., authentication and access controls) to protect USG\ninterests--not for your personal benefit or privacy. -Notwithstanding the\nabove, using this IS does not constitute consent to PM, LE or CI investigative\nsearching or monitoring of the content of privileged communications, or work\nproduct, related to personal representation or services by attorneys,\npsychotherapists, or clergy, and their assistants. Such communications and work\nproduct are private and confidential. See User Agreement for details.\\\"\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VMHost | Get-AdvancedSetting -Name Config.Etc.issue |\nSet-AdvancedSetting -Value \\\"<insert logon banner>\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000023-VMM-000060'\n  tag gid: 'V-239265'\n  tag rid: 'SV-239265r674724_rule'\n  tag stig_id: 'ESXI-67-000008'\n  tag fix_id: 'F-42457r674723_fix'\n  tag cci: ['CCI-000048']\n  tag nist: ['AC-8 a']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-AdvancedSetting -Name Config.Etc.issue | Select-Object -ExpandProperty Value\"\n  \n  describe.one do\n    describe powercli_command(command) do\n      its('stdout.strip') { should match \"You are accessing a U.S. Government\" }\n    end\n    describe powercli_command(command) do\n    its('stdout.strip') { should match \"I've read & consent to terms in IS user agreem't\" }\n    end\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000008.rb",
        "line": 1
      },
      "id": "ESXI-67-000008"
    },
    {
      "title": "The SA must verify the integrity of the installation media before\ninstalling ESXi.",
      "desc": "Always check the SHA1 or MD5 hash after downloading an ISO, offline\nbundle, or patch to ensure integrity and authenticity of the downloaded files.",
      "descriptions": {
        "default": "Always check the SHA1 or MD5 hash after downloading an ISO, offline\nbundle, or patch to ensure integrity and authenticity of the downloaded files.",
        "rationale": "",
        "check": "The downloaded ISO, offline bundle, or patch hash must be verified against\nthe vendor's checksum to ensure the integrity and authenticity of the files.\n\n    See some typical command line example(s) for both the md5 and sha1 hash\ncheck(s) below:\n\n    # md5sum <filename>.iso\n    # sha1sum <filename>.iso\n\n    If any of the system's downloaded ISO, offline bundle, or system patch\nhashes cannot be verified against the vendor's checksum, this is a finding.",
        "fix": "If the hash returned from the \"md5sum\" or \"sha1sum\" commands do not\nmatch the vendor's hash, the downloaded software must be discarded.\n\n    If the physical media is obtained from VMware and the security seal is\nbroken, the software must be returned to VMware for replacement."
      },
      "impact": 0.7,
      "refs": [],
      "tags": {
        "severity": "high",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239324",
        "rid": "SV-239324r674901_rule",
        "stig_id": "ESXI-67-000071",
        "fix_id": "F-42516r674900_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000071\" do\n  title \"The SA must verify the integrity of the installation media before\ninstalling ESXi.\"\n  desc  \"Always check the SHA1 or MD5 hash after downloading an ISO, offline\nbundle, or patch to ensure integrity and authenticity of the downloaded files.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    The downloaded ISO, offline bundle, or patch hash must be verified against\nthe vendor's checksum to ensure the integrity and authenticity of the files.\n\n    See some typical command line example(s) for both the md5 and sha1 hash\ncheck(s) below:\n\n    # md5sum <filename>.iso\n    # sha1sum <filename>.iso\n\n    If any of the system's downloaded ISO, offline bundle, or system patch\nhashes cannot be verified against the vendor's checksum, this is a finding.\n  \"\n  desc  'fix', \"\n    If the hash returned from the \\\"md5sum\\\" or \\\"sha1sum\\\" commands do not\nmatch the vendor's hash, the downloaded software must be discarded.\n\n    If the physical media is obtained from VMware and the security seal is\nbroken, the software must be returned to VMware for replacement.\n  \"\n  impact 0.7\n  tag severity: 'high'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239324'\n  tag rid: 'SV-239324r674901_rule'\n  tag stig_id: 'ESXI-67-000071'\n  tag fix_id: 'F-42516r674900_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe \"This check is a manual or policy based check\" do\n    skip \"This must be reviewed manually\"\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000071.rb",
        "line": 1
      },
      "id": "ESXI-67-000071"
    },
    {
      "title": "The ESXi host must verify the DCUI.Access list.",
      "desc": "Lockdown mode disables direct host access, requiring that\nadministrators manage hosts from vCenter Server. However, if a host becomes\nisolated from vCenter Server, the administrator is locked out and can no longer\nmanage the host. If using normal Lockdown Mode, avoid becoming locked out of an\nESXi host that is running in Lockdown Mode by setting DCUI.Access to a list of\nhighly trusted users who can override Lockdown Mode and access the DCUI. The\nDCUI is not running in strict Lockdown Mode.",
      "descriptions": {
        "default": "Lockdown mode disables direct host access, requiring that\nadministrators manage hosts from vCenter Server. However, if a host becomes\nisolated from vCenter Server, the administrator is locked out and can no longer\nmanage the host. If using normal Lockdown Mode, avoid becoming locked out of an\nESXi host that is running in Lockdown Mode by setting DCUI.Access to a list of\nhighly trusted users who can override Lockdown Mode and access the DCUI. The\nDCUI is not running in strict Lockdown Mode.",
        "rationale": "",
        "check": "For environments that do not use vCenter server to manage ESXi, this is Not\nApplicable.\n\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \"DCUI.Access\" value and verify that only the root user is\nlisted.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name DCUI.Access and verify it is set to\nroot.\n\n    If the DCUI.Access is not restricted to root, this is a finding.\n\n    Note: This list is only for local user accounts and should only contain the\nroot user.",
        "fix": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \"Edit\", select the \"DCUI.Access\" value, and configure it to root.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name DCUI.Access | Set-AdvancedSetting\n-Value \"root\""
      },
      "impact": 0.3,
      "refs": [],
      "tags": {
        "severity": "low",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239259",
        "rid": "SV-239259r674706_rule",
        "stig_id": "ESXI-67-000002",
        "fix_id": "F-42451r674705_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000002\" do\n  title 'The ESXi host must verify the DCUI.Access list.'\n  desc  \"Lockdown mode disables direct host access, requiring that\nadministrators manage hosts from vCenter Server. However, if a host becomes\nisolated from vCenter Server, the administrator is locked out and can no longer\nmanage the host. If using normal Lockdown Mode, avoid becoming locked out of an\nESXi host that is running in Lockdown Mode by setting DCUI.Access to a list of\nhighly trusted users who can override Lockdown Mode and access the DCUI. The\nDCUI is not running in strict Lockdown Mode.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    For environments that do not use vCenter server to manage ESXi, this is Not\nApplicable.\n\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \\\"DCUI.Access\\\" value and verify that only the root user is\nlisted.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name DCUI.Access and verify it is set to\nroot.\n\n    If the DCUI.Access is not restricted to root, this is a finding.\n\n    Note: This list is only for local user accounts and should only contain the\nroot user.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \\\"Edit\\\", select the \\\"DCUI.Access\\\" value, and configure it to root.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name DCUI.Access | Set-AdvancedSetting\n-Value \\\"root\\\"\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239259'\n  tag rid: 'SV-239259r674706_rule'\n  tag stig_id: 'ESXI-67-000002'\n  tag fix_id: 'F-42451r674705_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-AdvancedSetting -Name DCUI.Access | Select-Object -ExpandProperty Value\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should match \"root\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000002.rb",
        "line": 1
      },
      "id": "ESXI-67-000002"
    },
    {
      "title": "The ESXi host must not provide root/administrator-level access to\nCIM-based hardware monitoring tools or other third-party applications.",
      "desc": "The CIM system provides an interface that enables hardware-level\nmanagement from remote applications via a set of standard APIs. Create a\nlimited-privilege, read-only service account for CIM. Grant this role to the\nuser on the ESXi server. Place this user in the Exception Users list.\nWhen/where write access is required, create/enable a limited-privilege service\naccount and grant only the minimum required privileges.",
      "descriptions": {
        "default": "The CIM system provides an interface that enables hardware-level\nmanagement from remote applications via a set of standard APIs. Create a\nlimited-privilege, read-only service account for CIM. Grant this role to the\nuser on the ESXi server. Place this user in the Exception Users list.\nWhen/where write access is required, create/enable a limited-privilege service\naccount and grant only the minimum required privileges.",
        "rationale": "",
        "check": "From the Host Client, select the ESXi host, right-click and go to\n\"Permissions\".\n\n    Verify the CIM account user role is limited to read only and CIM\npermissions.\n\n    If there is no dedicated CIM account and the root is used for CIM\nmonitoring, this is a finding.\n\n    If write access is not required and the access level is not \"read-only\",\nthis is a finding.",
        "fix": "Create a role for the CIM account:\n\n    From the Host Client, go to Manage >> Security & Users.\n\n    Select \"Roles\" and click \"Add Role\".\n\n    Provide a name for the new role and select Host >> Cim >> Ciminteraction\nand click \"Add\".\n\n    Add a CIM user account:\n\n    From the Host Client, go to Manage >> Security & Users.\n\n    Select \"Users\" and click \"Add User\".\n\n    Provide a name, description, and password for the new user and click\n\"Add\".\n\n    Assign the CIM account permissions to the host with the new role.\n\n    From the Host Client, select the ESXi host, right-click, and go to\n\"Permissions\".\n\n    Click \"Add User\", select the CIM account from the drop-down list, select\nthe new CIM role from the drop-down list, and click \"Add User\"."
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239323",
        "rid": "SV-239323r674898_rule",
        "stig_id": "ESXI-67-000070",
        "fix_id": "F-42515r674897_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000070\" do\n  title \"The ESXi host must not provide root/administrator-level access to\nCIM-based hardware monitoring tools or other third-party applications.\"\n  desc  \"The CIM system provides an interface that enables hardware-level\nmanagement from remote applications via a set of standard APIs. Create a\nlimited-privilege, read-only service account for CIM. Grant this role to the\nuser on the ESXi server. Place this user in the Exception Users list.\nWhen/where write access is required, create/enable a limited-privilege service\naccount and grant only the minimum required privileges.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the Host Client, select the ESXi host, right-click and go to\n\\\"Permissions\\\".\n\n    Verify the CIM account user role is limited to read only and CIM\npermissions.\n\n    If there is no dedicated CIM account and the root is used for CIM\nmonitoring, this is a finding.\n\n    If write access is not required and the access level is not \\\"read-only\\\",\nthis is a finding.\n  \"\n  desc  'fix', \"\n    Create a role for the CIM account:\n\n    From the Host Client, go to Manage >> Security & Users.\n\n    Select \\\"Roles\\\" and click \\\"Add Role\\\".\n\n    Provide a name for the new role and select Host >> Cim >> Ciminteraction\nand click \\\"Add\\\".\n\n    Add a CIM user account:\n\n    From the Host Client, go to Manage >> Security & Users.\n\n    Select \\\"Users\\\" and click \\\"Add User\\\".\n\n    Provide a name, description, and password for the new user and click\n\\\"Add\\\".\n\n    Assign the CIM account permissions to the host with the new role.\n\n    From the Host Client, select the ESXi host, right-click, and go to\n\\\"Permissions\\\".\n\n    Click \\\"Add User\\\", select the CIM account from the drop-down list, select\nthe new CIM role from the drop-down list, and click \\\"Add User\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239323'\n  tag rid: 'SV-239323r674898_rule'\n  tag stig_id: 'ESXI-67-000070'\n  tag fix_id: 'F-42515r674897_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe \"This check is a manual or policy based check\" do\n    skip \"This must be reviewed manually\"\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000070.rb",
        "line": 1
      },
      "id": "ESXI-67-000070"
    },
    {
      "title": "The ESXi host must enforce password complexity by requiring that at\nleast one uppercase character be used.",
      "desc": "To enforce the use of complex passwords, minimum numbers of characters\nof different classes are mandated. The use of complex passwords reduces the\nability of attackers to successfully obtain valid passwords using guessing or\nexhaustive search techniques. Complexity requirements increase the password\nsearch space by requiring users to construct passwords from a larger character\nset than they may otherwise use.",
      "descriptions": {
        "default": "To enforce the use of complex passwords, minimum numbers of characters\nof different classes are mandated. The use of complex passwords reduces the\nability of attackers to successfully obtain valid passwords using guessing or\nexhaustive search techniques. Complexity requirements increase the password\nsearch space by requiring users to construct passwords from a larger character\nset than they may otherwise use.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \"Security.PasswordQualityControl\" value and verify it is set\nto \"similar=deny retry=3 min=disabled,disabled,disabled,disabled,15\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.PasswordQualityControl\n\n    If the \"Security.PasswordQualityControl\" setting is not set to\n\"similar=deny retry=3 min=disabled,disabled,disabled,disabled,15\", this is a\nfinding.",
        "fix": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \"Edit\", select the \"Security.PasswordQualityControl\" value, and\nconfigure it to \"similar=deny retry=3\nmin=disabled,disabled,disabled,disabled,15\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.PasswordQualityControl |\nSet-AdvancedSetting -Value \"similar=deny retry=3\nmin=disabled,disabled,disabled,disabled,15\""
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000069-VMM-000360",
        "satisfies": [
          "SRG-OS-000069-VMM-000360",
          "SRG-OS-000070-VMM-000370",
          "SRG-OS-000071-VMM-000380",
          "SRG-OS-000078-VMM-000450",
          "SRG-OS-000072-VMM-000390",
          "SRG-OS-000266-VMM-000940"
        ],
        "gid": "V-239286",
        "rid": "SV-239286r674787_rule",
        "stig_id": "ESXI-67-000031",
        "fix_id": "F-42478r674786_fix",
        "cci": [
          "CCI-000192",
          "CCI-000193",
          "CCI-000194",
          "CCI-000195",
          "CCI-000205",
          "CCI-001619"
        ],
        "nist": [
          "IA-5 (1) (a)",
          "IA-5 (1) (a)",
          "IA-5 (1) (a)",
          "IA-5 (1) (b)",
          "IA-5 (1) (a)",
          "IA-5 (1) (a)"
        ]
      },
      "code": "control \"ESXI-67-000031\" do\n  title \"The ESXi host must enforce password complexity by requiring that at\nleast one uppercase character be used.\"\n  desc  \"To enforce the use of complex passwords, minimum numbers of characters\nof different classes are mandated. The use of complex passwords reduces the\nability of attackers to successfully obtain valid passwords using guessing or\nexhaustive search techniques. Complexity requirements increase the password\nsearch space by requiring users to construct passwords from a larger character\nset than they may otherwise use.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \\\"Security.PasswordQualityControl\\\" value and verify it is set\nto \\\"similar=deny retry=3 min=disabled,disabled,disabled,disabled,15\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.PasswordQualityControl\n\n    If the \\\"Security.PasswordQualityControl\\\" setting is not set to\n\\\"similar=deny retry=3 min=disabled,disabled,disabled,disabled,15\\\", this is a\nfinding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \\\"Edit\\\", select the \\\"Security.PasswordQualityControl\\\" value, and\nconfigure it to \\\"similar=deny retry=3\nmin=disabled,disabled,disabled,disabled,15\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.PasswordQualityControl |\nSet-AdvancedSetting -Value \\\"similar=deny retry=3\nmin=disabled,disabled,disabled,disabled,15\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000069-VMM-000360'\n  tag satisfies: ['SRG-OS-000069-VMM-000360', 'SRG-OS-000070-VMM-000370',\n'SRG-OS-000071-VMM-000380', 'SRG-OS-000078-VMM-000450',\n'SRG-OS-000072-VMM-000390', 'SRG-OS-000266-VMM-000940']\n  tag gid: 'V-239286'\n  tag rid: 'SV-239286r674787_rule'\n  tag stig_id: 'ESXI-67-000031'\n  tag fix_id: 'F-42478r674786_fix'\n  tag cci: ['CCI-000192', 'CCI-000193', 'CCI-000194', 'CCI-000195',\n'CCI-000205', 'CCI-001619']\n  tag nist: ['IA-5 (1) (a)', 'IA-5 (1) (a)', 'IA-5 (1) (a)', 'IA-5 (1) (b)',\n'IA-5 (1) (a)', 'IA-5 (1) (a)']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-AdvancedSetting -Name Security.PasswordQualityControl | Select-Object -ExpandProperty Value\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should match \"similar=deny retry=3 min=disabled,disabled,disabled,disabled,15\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000031.rb",
        "line": 1
      },
      "id": "ESXI-67-000031"
    },
    {
      "title": "The ESXi host must protect the confidentiality and integrity of\ntransmitted information by using different TCP/IP stacks where possible.",
      "desc": "Three different TCP/IP stacks are available by default on ESXi:\nDefault, Provisioning, and vMotion.\n\n    To better protect and isolate sensitive network traffic within ESXi,\nadministrators must configure each of these stacks. Additional custom TCP/IP\nstacks can be created if desired.",
      "descriptions": {
        "default": "Three different TCP/IP stacks are available by default on ESXi:\nDefault, Provisioning, and vMotion.\n\n    To better protect and isolate sensitive network traffic within ESXi,\nadministrators must configure each of these stacks. Additional custom TCP/IP\nstacks can be created if desired.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi host and go to Configure >>\nNetworking >> TCP/IP configuration.\n\n    Review the default system TCP/IP stacks and verify they are configured with\nthe appropriate IP address information.\n\n    If vMotion and Provisioning VMKernels are in use and are not using their\nown TCP/IP stack, this is a finding.",
        "fix": "From the vSphere Client, select the ESXi host and go to Configure >>\nNetworking >> TCP/IP configuration.\n\n    Select a TCP/IP stack and click \"Edit\".\n\n    Enter the appropriate site-specific IP address information for the\nparticular TCP/IP stack and click \"OK\"."
      },
      "impact": 0.3,
      "refs": [],
      "tags": {
        "severity": "low",
        "gtitle": "SRG-OS-000423-VMM-001700",
        "gid": "V-239306",
        "rid": "SV-239306r674847_rule",
        "stig_id": "ESXI-67-000052",
        "fix_id": "F-42498r674846_fix",
        "cci": [
          "CCI-002418"
        ],
        "nist": [
          "SC-8"
        ]
      },
      "code": "control \"ESXI-67-000052\" do\n  title \"The ESXi host must protect the confidentiality and integrity of\ntransmitted information by using different TCP/IP stacks where possible.\"\n  desc  \"Three different TCP/IP stacks are available by default on ESXi:\nDefault, Provisioning, and vMotion.\n\n    To better protect and isolate sensitive network traffic within ESXi,\nadministrators must configure each of these stacks. Additional custom TCP/IP\nstacks can be created if desired.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi host and go to Configure >>\nNetworking >> TCP/IP configuration.\n\n    Review the default system TCP/IP stacks and verify they are configured with\nthe appropriate IP address information.\n\n    If vMotion and Provisioning VMKernels are in use and are not using their\nown TCP/IP stack, this is a finding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi host and go to Configure >>\nNetworking >> TCP/IP configuration.\n\n    Select a TCP/IP stack and click \\\"Edit\\\".\n\n    Enter the appropriate site-specific IP address information for the\nparticular TCP/IP stack and click \\\"OK\\\".\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000423-VMM-001700'\n  tag gid: 'V-239306'\n  tag rid: 'SV-239306r674847_rule'\n  tag stig_id: 'ESXI-67-000052'\n  tag fix_id: 'F-42498r674846_fix'\n  tag cci: ['CCI-002418']\n  tag nist: ['SC-8']\n\n  describe \"This check is a manual or policy based check\" do\n    skip \"This must be reviewed manually\"\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000052.rb",
        "line": 1
      },
      "id": "ESXI-67-000052"
    },
    {
      "title": "For the ESXi host, all port groups must not be configured to VLAN 4095\nunless Virtual Guest Tagging (VGT) is required.",
      "desc": "When a port group is set to VLAN 4095, this activates VGT mode. In\nthis mode, the vSwitch passes all network frames to the guest VM without\nmodifying the VLAN tags, leaving it up to the guest to deal with them. VLAN\n4095 should be used only if the guest has been specifically configured to\nmanage VLAN tags itself. If VGT is enabled inappropriately, it might cause\ndenial of service or allow a guest VM to interact with traffic on an\nunauthorized VLAN.",
      "descriptions": {
        "default": "When a port group is set to VLAN 4095, this activates VGT mode. In\nthis mode, the vSwitch passes all network frames to the guest VM without\nmodifying the VLAN tags, leaving it up to the guest to deal with them. VLAN\n4095 should be used only if the guest has been specifically configured to\nmanage VLAN tags itself. If VGT is enabled inappropriately, it might cause\ndenial of service or allow a guest VM to interact with traffic on an\nunauthorized VLAN.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi host and go to Configure >>\nNetworking >> Virtual switches.\n\n    For each virtual switch, review the port group VLAN tags and verify they\nare not set to 4095.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VirtualPortGroup | Select Name, VLanID\n\n    If any port group is configured with VLAN 4095 and is not documented as a\nneeded exception, this is a finding.",
        "fix": "From the vSphere Client, select the ESXi host and go to Configure >>\nNetworking >> Virtual switches.\n\n    Highlight a port group where VLAN ID is set to 4095 and click Edit settings\n(dots).\n\n    Change the VLAN ID to an appropriate VLAN and click \"OK\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VirtualPortGroup -Name \"portgroup name\" | Set-VirtualPortGroup\n-VLanId \"New VLAN#\""
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000480-VMM-002000",
        "gid": "V-239318",
        "rid": "SV-239318r674883_rule",
        "stig_id": "ESXI-67-000064",
        "fix_id": "F-42510r674882_fix",
        "cci": [
          "CCI-000366"
        ],
        "nist": [
          "CM-6 b"
        ]
      },
      "code": "control \"ESXI-67-000064\" do\n  title \"For the ESXi host, all port groups must not be configured to VLAN 4095\nunless Virtual Guest Tagging (VGT) is required.\"\n  desc  \"When a port group is set to VLAN 4095, this activates VGT mode. In\nthis mode, the vSwitch passes all network frames to the guest VM without\nmodifying the VLAN tags, leaving it up to the guest to deal with them. VLAN\n4095 should be used only if the guest has been specifically configured to\nmanage VLAN tags itself. If VGT is enabled inappropriately, it might cause\ndenial of service or allow a guest VM to interact with traffic on an\nunauthorized VLAN.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi host and go to Configure >>\nNetworking >> Virtual switches.\n\n    For each virtual switch, review the port group VLAN tags and verify they\nare not set to 4095.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VirtualPortGroup | Select Name, VLanID\n\n    If any port group is configured with VLAN 4095 and is not documented as a\nneeded exception, this is a finding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi host and go to Configure >>\nNetworking >> Virtual switches.\n\n    Highlight a port group where VLAN ID is set to 4095 and click Edit settings\n(dots).\n\n    Change the VLAN ID to an appropriate VLAN and click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VirtualPortGroup -Name \\\"portgroup name\\\" | Set-VirtualPortGroup\n-VLanId \\\"New VLAN#\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-239318'\n  tag rid: 'SV-239318r674883_rule'\n  tag stig_id: 'ESXI-67-000064'\n  tag fix_id: 'F-42510r674882_fix'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-VirtualPortGroup | Select-Object -ExpandProperty VlanId\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should_not match \"4095\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000064.rb",
        "line": 1
      },
      "id": "ESXI-67-000064"
    },
    {
      "title": "The ESXi host SSH daemon must be configured with the DoD logon banner.",
      "desc": "The warning message reinforces policy awareness during the logon\nprocess and facilitates possible legal action against attackers. Alternatively,\nsystems whose ownership should not be obvious should ensure usage of a banner\nthat does not provide easy attribution.",
      "descriptions": {
        "default": "The warning message reinforces policy awareness during the logon\nprocess and facilitates possible legal action against attackers. Alternatively,\nsystems whose ownership should not be obvious should ensure usage of a banner\nthat does not provide easy attribution.",
        "rationale": "",
        "check": "From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \"^Banner\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \"Banner /etc/issue\",\nthis is a finding.",
        "fix": "From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \"/etc/ssh/sshd_config\":\n\n    Banner /etc/issue"
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000023-VMM-000060",
        "gid": "V-239266",
        "rid": "SV-239266r674727_rule",
        "stig_id": "ESXI-67-000009",
        "fix_id": "F-42458r674726_fix",
        "cci": [
          "CCI-000048"
        ],
        "nist": [
          "AC-8 a"
        ]
      },
      "code": "control \"ESXI-67-000009\" do\n  title 'The ESXi host SSH daemon must be configured with the DoD logon banner.'\n  desc  \"The warning message reinforces policy awareness during the logon\nprocess and facilitates possible legal action against attackers. Alternatively,\nsystems whose ownership should not be obvious should ensure usage of a banner\nthat does not provide easy attribution.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, run\nthe following command:\n\n    # grep -i \\\"^Banner\\\" /etc/ssh/sshd_config\n\n    If there is no output or the output is not exactly \\\"Banner /etc/issue\\\",\nthis is a finding.\n  \"\n  desc  'fix', \"\n    From an SSH session connected to the ESXi host, or from the ESXi shell, add\nor correct the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    Banner /etc/issue\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000023-VMM-000060'\n  tag gid: 'V-239266'\n  tag rid: 'SV-239266r674727_rule'\n  tag stig_id: 'ESXI-67-000009'\n  tag fix_id: 'F-42458r674726_fix'\n  tag cci: ['CCI-000048']\n  tag nist: ['AC-8 a']\n\n  command = \"$vmhost = Get-VMHost -Name #{input('vmhostName')}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.software.vib.list.Invoke() | Where {$_.Name -eq '#{input('dodStigVibRootEnabled')}' -or $_.Name -eq '#{input('dodStigVibRootDisabled')}'}\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should_not cmp \"\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000009.rb",
        "line": 1
      },
      "id": "ESXI-67-000009"
    },
    {
      "title": "Active Directory ESX Admin group membership must not be used when\nadding ESXi hosts to Active Directory.",
      "desc": "When adding ESXi hosts to Active Directory (AD), all user/group\naccounts assigned to the AD group \"ESX Admins\" will have full administrative\naccess to the host. If this group is not controlled or known to the System\nAdministrators, it may be used for inappropriate access to the host. Therefore,\nthe default group must be changed to a site-specific AD group and membership\ntherein must be severely restricted.",
      "descriptions": {
        "default": "When adding ESXi hosts to Active Directory (AD), all user/group\naccounts assigned to the AD group \"ESX Admins\" will have full administrative\naccess to the host. If this group is not controlled or known to the System\nAdministrators, it may be used for inappropriate access to the host. Therefore,\nthe default group must be changed to a site-specific AD group and membership\ntherein must be severely restricted.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi host and go to Configuration >>\nSystem >> Advanced System Settings.\n\n    Click \"Edit\" and select the\n\"Config.HostAgent.plugins.hostsvc.esxAdminsGroup\" value and verify it is not\nset to \"ESX Admins\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name\nConfig.HostAgent.plugins.hostsvc.esxAdminsGroup\n\n    For systems that do not use Active Directory, this is Not Applicable.\n\n    If the \"Config.HostAgent.plugins.hostsvc.esxAdminsGroup\" key is set to\n\"ESX Admins\", this is a finding.",
        "fix": "From the vSphere Client, select the ESXi host and go to Configuration >>\nSystem >> Advanced System Settings.\n\n    Click \"Edit\" and select the\n\"Config.HostAgent.plugins.hostsvc.esxAdminsGroup\" key and configure its value\nto an appropriate Active Directory group other than \"ESX Admins\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VMHost | Get-AdvancedSetting -Name\nConfig.HostAgent.plugins.hostsvc.esxAdminsGroup | Set-AdvancedSetting -Value\n<AD Group>"
      },
      "impact": 0.3,
      "refs": [],
      "tags": {
        "severity": "low",
        "gtitle": "SRG-OS-000104-VMM-000500",
        "satisfies": [
          "SRG-OS-000104-VMM-000500",
          "SRG-OS-000109-VMM-000550",
          "SRG-OS-000112-VMM-000560",
          "SRG-OS-000113-VMM-000570"
        ],
        "gid": "V-239294",
        "rid": "SV-239294r674811_rule",
        "stig_id": "ESXI-67-000039",
        "fix_id": "F-42486r674810_fix",
        "cci": [
          "CCI-000764",
          "CCI-000770",
          "CCI-001941",
          "CCI-001942"
        ],
        "nist": [
          "IA-2",
          "IA-2 (5)",
          "IA-2 (8)",
          "IA-2 (9)"
        ]
      },
      "code": "control \"ESXI-67-000039\" do\n  title \"Active Directory ESX Admin group membership must not be used when\nadding ESXi hosts to Active Directory.\"\n  desc  \"When adding ESXi hosts to Active Directory (AD), all user/group\naccounts assigned to the AD group \\\"ESX Admins\\\" will have full administrative\naccess to the host. If this group is not controlled or known to the System\nAdministrators, it may be used for inappropriate access to the host. Therefore,\nthe default group must be changed to a site-specific AD group and membership\ntherein must be severely restricted.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi host and go to Configuration >>\nSystem >> Advanced System Settings.\n\n    Click \\\"Edit\\\" and select the\n\\\"Config.HostAgent.plugins.hostsvc.esxAdminsGroup\\\" value and verify it is not\nset to \\\"ESX Admins\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name\nConfig.HostAgent.plugins.hostsvc.esxAdminsGroup\n\n    For systems that do not use Active Directory, this is Not Applicable.\n\n    If the \\\"Config.HostAgent.plugins.hostsvc.esxAdminsGroup\\\" key is set to\n\\\"ESX Admins\\\", this is a finding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi host and go to Configuration >>\nSystem >> Advanced System Settings.\n\n    Click \\\"Edit\\\" and select the\n\\\"Config.HostAgent.plugins.hostsvc.esxAdminsGroup\\\" key and configure its value\nto an appropriate Active Directory group other than \\\"ESX Admins\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VMHost | Get-AdvancedSetting -Name\nConfig.HostAgent.plugins.hostsvc.esxAdminsGroup | Set-AdvancedSetting -Value\n<AD Group>\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000104-VMM-000500'\n  tag satisfies: ['SRG-OS-000104-VMM-000500', 'SRG-OS-000109-VMM-000550',\n'SRG-OS-000112-VMM-000560', 'SRG-OS-000113-VMM-000570']\n  tag gid: 'V-239294'\n  tag rid: 'SV-239294r674811_rule'\n  tag stig_id: 'ESXI-67-000039'\n  tag fix_id: 'F-42486r674810_fix'\n  tag cci: ['CCI-000764', 'CCI-000770', 'CCI-001941', 'CCI-001942']\n  tag nist: ['IA-2', 'IA-2 (5)', 'IA-2 (8)', 'IA-2 (9)']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-AdvancedSetting -Name Config.HostAgent.plugins.hostsvc.esxAdminsGroup | Select-Object -ExpandProperty Value\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should_not cmp \"ESX Admins\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000039.rb",
        "line": 1
      },
      "id": "ESXI-67-000039"
    },
    {
      "title": "The ESXi host must terminate shell services after 10 minutes.",
      "desc": "When the ESXi Shell or SSH services are enabled on a host, they will\nrun indefinitely. To avoid having these services left running, set the\n\"ESXiShellTimeOut\". The \"ESXiShellTimeOut\" defines a window of time after\nwhich the ESXi Shell and SSH services will be stopped automatically.",
      "descriptions": {
        "default": "When the ESXi Shell or SSH services are enabled on a host, they will\nrun indefinitely. To avoid having these services left running, set the\n\"ESXiShellTimeOut\". The \"ESXiShellTimeOut\" defines a window of time after\nwhich the ESXi Shell and SSH services will be stopped automatically.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi Host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \"UserVars.ESXiShellTimeOut\" value and verify it is set to\n\"600\" (10 Minutes).\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.ESXiShellTimeOut\n\n    If the \"UserVars.ESXiShellTimeOut\" setting is not set to \"600\", this is\na finding.",
        "fix": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \"Edit\", select the \"UserVars.ESXiShellTimeOut\" value, and\nconfigure it to \"600\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.ESXiShellTimeOut |\nSet-AdvancedSetting -Value 600"
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000163-VMM-000700",
        "satisfies": [
          "SRG-OS-000163-VMM-000700",
          "SRG-OS-000279-VMM-001010"
        ],
        "gid": "V-239297",
        "rid": "SV-239297r674820_rule",
        "stig_id": "ESXI-67-000042",
        "fix_id": "F-42489r674819_fix",
        "cci": [
          "CCI-001133",
          "CCI-002361"
        ],
        "nist": [
          "SC-10",
          "AC-12"
        ]
      },
      "code": "control \"ESXI-67-000042\" do\n  title 'The ESXi host must terminate shell services after 10 minutes.'\n  desc  \"When the ESXi Shell or SSH services are enabled on a host, they will\nrun indefinitely. To avoid having these services left running, set the\n\\\"ESXiShellTimeOut\\\". The \\\"ESXiShellTimeOut\\\" defines a window of time after\nwhich the ESXi Shell and SSH services will be stopped automatically.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi Host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \\\"UserVars.ESXiShellTimeOut\\\" value and verify it is set to\n\\\"600\\\" (10 Minutes).\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.ESXiShellTimeOut\n\n    If the \\\"UserVars.ESXiShellTimeOut\\\" setting is not set to \\\"600\\\", this is\na finding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \\\"Edit\\\", select the \\\"UserVars.ESXiShellTimeOut\\\" value, and\nconfigure it to \\\"600\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.ESXiShellTimeOut |\nSet-AdvancedSetting -Value 600\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000163-VMM-000700'\n  tag satisfies: ['SRG-OS-000163-VMM-000700', 'SRG-OS-000279-VMM-001010']\n  tag gid: 'V-239297'\n  tag rid: 'SV-239297r674820_rule'\n  tag stig_id: 'ESXI-67-000042'\n  tag fix_id: 'F-42489r674819_fix'\n  tag cci: ['CCI-001133', 'CCI-002361']\n  tag nist: ['SC-10', 'AC-12']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-AdvancedSetting -Name UserVars.ESXiShellTimeOut | Select-Object -ExpandProperty Value\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp \"600\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000042.rb",
        "line": 1
      },
      "id": "ESXI-67-000042"
    },
    {
      "title": "The ESXi host must set a timeout to automatically disable idle shell\nsessions after two minutes.",
      "desc": "If a user forgets to log out of their local or remote ESXi Shell\nsession, the idle connection will remain open indefinitely and increase the\nlikelihood of inappropriate host access via session hijacking. The\n\"ESXiShellInteractiveTimeOut\" allows the automatic termination of idle shell\nsessions.",
      "descriptions": {
        "default": "If a user forgets to log out of their local or remote ESXi Shell\nsession, the idle connection will remain open indefinitely and increase the\nlikelihood of inappropriate host access via session hijacking. The\n\"ESXiShellInteractiveTimeOut\" allows the automatic termination of idle shell\nsessions.",
        "rationale": "",
        "check": "From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \"UserVars.ESXiShellInteractiveTimeOut\" value and verify it is\nset to \"120\" (2 Minutes).\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.ESXiShellInteractiveTimeOut\n\n    If the \"UserVars.ESXiShellInteractiveTimeOut\" setting is not set to\n\"120\", this is a finding.",
        "fix": "From the vSphere Client, select the ESXi Host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \"Edit\", select the \"UserVars.ESXiShellInteractiveTimeOut\" value,\nand configure it to \"120\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.ESXiShellInteractiveTimeOut\n| Set-AdvancedSetting -Value 120"
      },
      "impact": 0.5,
      "refs": [],
      "tags": {
        "severity": "medium",
        "gtitle": "SRG-OS-000163-VMM-000700",
        "satisfies": [
          "SRG-OS-000163-VMM-000700",
          "SRG-OS-000279-VMM-001010"
        ],
        "gid": "V-239296",
        "rid": "SV-239296r674817_rule",
        "stig_id": "ESXI-67-000041",
        "fix_id": "F-42488r674816_fix",
        "cci": [
          "CCI-001133",
          "CCI-002361"
        ],
        "nist": [
          "SC-10",
          "AC-12"
        ]
      },
      "code": "control \"ESXI-67-000041\" do\n  title \"The ESXi host must set a timeout to automatically disable idle shell\nsessions after two minutes.\"\n  desc  \"If a user forgets to log out of their local or remote ESXi Shell\nsession, the idle connection will remain open indefinitely and increase the\nlikelihood of inappropriate host access via session hijacking. The\n\\\"ESXiShellInteractiveTimeOut\\\" allows the automatic termination of idle shell\nsessions.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, select the ESXi host and go to Configure >> System\n>> Advanced System Settings.\n\n    Select the \\\"UserVars.ESXiShellInteractiveTimeOut\\\" value and verify it is\nset to \\\"120\\\" (2 Minutes).\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.ESXiShellInteractiveTimeOut\n\n    If the \\\"UserVars.ESXiShellInteractiveTimeOut\\\" setting is not set to\n\\\"120\\\", this is a finding.\n  \"\n  desc  'fix', \"\n    From the vSphere Client, select the ESXi Host and go to Configure >> System\n>> Advanced System Settings.\n\n    Click \\\"Edit\\\", select the \\\"UserVars.ESXiShellInteractiveTimeOut\\\" value,\nand configure it to \\\"120\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the\nfollowing commands:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.ESXiShellInteractiveTimeOut\n| Set-AdvancedSetting -Value 120\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000163-VMM-000700'\n  tag satisfies: ['SRG-OS-000163-VMM-000700', 'SRG-OS-000279-VMM-001010']\n  tag gid: 'V-239296'\n  tag rid: 'SV-239296r674817_rule'\n  tag stig_id: 'ESXI-67-000041'\n  tag fix_id: 'F-42488r674816_fix'\n  tag cci: ['CCI-001133', 'CCI-002361']\n  tag nist: ['SC-10', 'AC-12']\n\n  command = \"(Get-VMHost -Name #{input('vmhostName')}) | Get-AdvancedSetting -Name UserVars.ESXiShellInteractiveTimeOut | Select-Object -ExpandProperty Value\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp \"120\" }\n  end\n\nend\n",
      "source_location": {
        "ref": "./vmware/vsphere/6.7/vsphere/inspec/vmware-esxi-6.7-stig-baseline/controls/ESXI-67-000041.rb",
        "line": 1
      },
      "id": "ESXI-67-000041"
    }
  ],
  "groups": [
    {
      "title": null,
      "controls": [
        "ESXI-67-000030"
      ],
      "id": "controls/ESXI-67-000030.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000061"
      ],
      "id": "controls/ESXI-67-000061.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000054"
      ],
      "id": "controls/ESXI-67-000054.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000032"
      ],
      "id": "controls/ESXI-67-000032.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000013"
      ],
      "id": "controls/ESXI-67-000013.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000037"
      ],
      "id": "controls/ESXI-67-000037.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000026"
      ],
      "id": "controls/ESXI-67-000026.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000015"
      ],
      "id": "controls/ESXI-67-000015.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000014"
      ],
      "id": "controls/ESXI-67-000014.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000028"
      ],
      "id": "controls/ESXI-67-000028.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000016"
      ],
      "id": "controls/ESXI-67-000016.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000065"
      ],
      "id": "controls/ESXI-67-000065.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000021"
      ],
      "id": "controls/ESXI-67-000021.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000038"
      ],
      "id": "controls/ESXI-67-000038.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000049"
      ],
      "id": "controls/ESXI-67-000049.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000057"
      ],
      "id": "controls/ESXI-67-000057.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000072"
      ],
      "id": "controls/ESXI-67-000072.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000046"
      ],
      "id": "controls/ESXI-67-000046.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000062"
      ],
      "id": "controls/ESXI-67-000062.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000034"
      ],
      "id": "controls/ESXI-67-000034.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000067"
      ],
      "id": "controls/ESXI-67-000067.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000056"
      ],
      "id": "controls/ESXI-67-000056.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000058"
      ],
      "id": "controls/ESXI-67-000058.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000018"
      ],
      "id": "controls/ESXI-67-000018.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000006"
      ],
      "id": "controls/ESXI-67-000006.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000078"
      ],
      "id": "controls/ESXI-67-000078.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000040"
      ],
      "id": "controls/ESXI-67-000040.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000012"
      ],
      "id": "controls/ESXI-67-000012.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000003"
      ],
      "id": "controls/ESXI-67-000003.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000076"
      ],
      "id": "controls/ESXI-67-000076.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000048"
      ],
      "id": "controls/ESXI-67-000048.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000068"
      ],
      "id": "controls/ESXI-67-000068.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000079"
      ],
      "id": "controls/ESXI-67-000079.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000025"
      ],
      "id": "controls/ESXI-67-000025.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000010"
      ],
      "id": "controls/ESXI-67-000010.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000007"
      ],
      "id": "controls/ESXI-67-000007.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000023"
      ],
      "id": "controls/ESXI-67-000023.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000027"
      ],
      "id": "controls/ESXI-67-000027.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000024"
      ],
      "id": "controls/ESXI-67-000024.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000033"
      ],
      "id": "controls/ESXI-67-000033.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000001"
      ],
      "id": "controls/ESXI-67-000001.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000019"
      ],
      "id": "controls/ESXI-67-000019.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000060"
      ],
      "id": "controls/ESXI-67-000060.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000035"
      ],
      "id": "controls/ESXI-67-000035.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000044"
      ],
      "id": "controls/ESXI-67-000044.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000047"
      ],
      "id": "controls/ESXI-67-000047.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000005"
      ],
      "id": "controls/ESXI-67-000005.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000020"
      ],
      "id": "controls/ESXI-67-000020.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000036"
      ],
      "id": "controls/ESXI-67-000036.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000050"
      ],
      "id": "controls/ESXI-67-000050.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000004"
      ],
      "id": "controls/ESXI-67-000004.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000063"
      ],
      "id": "controls/ESXI-67-000063.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000053"
      ],
      "id": "controls/ESXI-67-000053.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000043"
      ],
      "id": "controls/ESXI-67-000043.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000059"
      ],
      "id": "controls/ESXI-67-000059.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000055"
      ],
      "id": "controls/ESXI-67-000055.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000022"
      ],
      "id": "controls/ESXI-67-000022.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000029"
      ],
      "id": "controls/ESXI-67-000029.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000066"
      ],
      "id": "controls/ESXI-67-000066.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000045"
      ],
      "id": "controls/ESXI-67-000045.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000074"
      ],
      "id": "controls/ESXI-67-000074.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000008"
      ],
      "id": "controls/ESXI-67-000008.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000071"
      ],
      "id": "controls/ESXI-67-000071.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000002"
      ],
      "id": "controls/ESXI-67-000002.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000070"
      ],
      "id": "controls/ESXI-67-000070.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000031"
      ],
      "id": "controls/ESXI-67-000031.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000052"
      ],
      "id": "controls/ESXI-67-000052.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000064"
      ],
      "id": "controls/ESXI-67-000064.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000009"
      ],
      "id": "controls/ESXI-67-000009.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000039"
      ],
      "id": "controls/ESXI-67-000039.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000042"
      ],
      "id": "controls/ESXI-67-000042.rb"
    },
    {
      "title": null,
      "controls": [
        "ESXI-67-000041"
      ],
      "id": "controls/ESXI-67-000041.rb"
    }
  ],
  "sha256": "f0960f458e0e8a5b56bd3b6852b05d457d8a71d9c98cf83a0a1dbdd378244b6b",
  "status_message": "",
  "status": "loaded",
  "generator": {
    "name": "inspec",
    "version": "4.33.1"
  }
}